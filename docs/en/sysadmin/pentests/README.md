# Safety tests

The security of the WebJET CMS is dependent on its correct configuration and correct access rights settings. The information on this page must be set up prior to going into production operation and then checked at least quarterly and always prior to performing security tests.

## Setting up the system

### Groups of rights

It is also possible to modify program files via WebJET CMS, so it is necessary to set permission restrictions before penetration testing. We recommend to create the following [groups of rights](../../admin/users/perm-groups.md). **Other user groups, or users directly, should not be allowed the below unit rights**.

**User management**

The group contains permissions that allow you to modify permissions. A user with such a group of rights must be cautious enough to know that he has the highest privilege options (because he can set rights for himself or for other users).

A user with this privilege can compromise the entire system (e.g., he can set permissions so that he can delete all web pages or all files).

Set the following rights for the rights group:
- administrators management - the right allows to set permissions for users in the administration
- Rights groups - the right allows you to set permissions on groups

**Programmer**

The default setting should be that users (editors) cannot upload and modify program files. However, the programmer often needs to make a quick change (`hotfix`) of the program code and thus needs to modify the program files as well. At the same time, it has added rights to modify all configuration variables and edit all translation texts.

A user with this privilege can compromise the entire system (e.g., upload malicious code that can perform any operation on the server, including deleting files on the server or completely wiping the database).

- Unlimited file uploads (extensions and sizes)
- Configuration - view all variables
- Text editing - view all texts

Note: the list of conf. variables without the "Configuration - display all variables" permission is set in the conf. variable `configEnabledKeys`, list of translation keys without the "Text editing - display all texts" permission in the conf. variable `propertiesEnabledKeys`. HTML code is also filtered in the translation keys, the rules are described below in the section `Stored XSS cez úpravu prekladových kľúčov`.

In addition to permissions, you must allow write access to the file system directories:
- `/apps` - contains application code
- `/components` - contains application code
- `/templates` - includes design templates

If the environment is deployed directly from the GIT repository and you do not expect to execute `hot-fixov` directly via WebJET CMS you do not need to set the above rights for writing to the file system. Additionally, for this case, we recommend setting write permissions on the file system for directories only (other directories and files have read-only permissions):
- `/images` - contains images uploaded by CMS editors
- `/files` - contains files uploaded by CMS editors
- `/shared` - contains images and files uploaded by CMS editors and shared between domains
- `/WEB-INF/tmp` - contains temporary CMS files
- `/WEB-INF/imgcache` - contains generated image thumbnails and cutouts for use via `/thumb` prefix
- `/WEB-INF/formfiles` - contains files uploaded via forms on the website created via the Forms application

### Configuration

Set and check the following configuration variables (in Settings->Configuration administration):
- `defaultDisableUpload=true` - activates a mode in which the user has file system rights only for the configured directories. If no directories are set he will not have write permissions to any directory.
- `fbrowserShowOnlyWritableFolders` - after setting to `true` only files that the user has rights to will be displayed in the explorer, other files will not even be displayed. By default, files that the user does not have rights to are also displayed, but cannot be modified.
- `emailProtectionSenderEmail` - set a suitable email address type `noreply@domena.sk`, which is used as the email address of the sent emails (the original value is set to `Reply-To` email headers).
- `adminEnabledIPs` - contains a comma-separated list of IP addresses from which access to `/admin` parts.
- `multidomainAdminHost` - allows you to set a separate domain address for access to `/admin` parts, e.g. `cms.domena.sk`. After setting up, the call will be `/admin` addresses on other domains return a 404 error - Page does not exist.
- `serverBeyoundProxy` - if the application server is behind a Load Balancer / proxy you need to set the value to `true` (otherwise set the value `false`). The Load Balancer must then send the following in the HTTP header `x-forwarded-for` the IP address of the visitor to the website and in the header `x-forwarded-proto` protocol (`http` or `https`). Verify in an audit (e.g. after filling in a form on the website) that the IP address of the website visitor is correctly recorded.
- `serverName` - default `unknown` - sets the HTTP header value `Server` for HTTP response. If you have an application server behind the Load Balancer/proxy, verify the value of this header in the HTTP response and possibly set it to a suitable unknown value on the Load Balancer/proxy.

Restrictions for uploaded files by editors in the administration:
- `FCKConfig.UploadMaxSize[Default][image]` - default 0 - size limit in kB for uploading **Images**, we recommend to set it to 10000 for uploading max 10 MB image
- `FCKConfig.UploadMaxSize[Basic][image]` - default 2048 - size limit in kB for uploading **Images** for users who **do not have the right Complete menu in the editor**
- `FCKConfig.UploadMaxSize[Default][file]` - default 0 - size limit in kB for uploading **files**, we recommend to set it to 50000 for uploading max 50 MB file
- `FCKConfig.UploadMaxSize[Basic][file]` - default 2048 - size limit in kB for uploading **files** for users who **do not have the right Complete menu in the editor**
- `FCKConfig.UploadFileTypes[Default][image]` - default empty = no limits - type limits **Images**, we recommend setting to `jpg,jpeg,png,gif,svg,mp3,mp4`. The possibility of allowing the SVG suffix needs to be considered, see potential risk below in the block `Stored XSS cez SVG obrázok`.
- `FCKConfig.UploadFileTypes[Basic][image]` - default `jpg,jpeg,png,gif,mp4` - type limits **Images** for users who **do not have the right Complete menu in the editor**
- `FCKConfig.UploadFileTypes[Default][file]` - default empty = no limits - type limits **files**, we recommend setting to `pdf,docx,xlsx,pptx,ppsx,zip,rtf`
- `FCKConfig.UploadFileTypes[Basic][file]` - default `doc,docx,xls,xlsx,pdf,zip,rtf` - type limits **files** for users who **do not have the right Complete menu in the editor**

You can also check the following conf. variables:
- `overviewJsonUrl` - defines the URL from which the list of news in WebJET is read. If users do not have internet access from a browser, you can set this to `/admin/v9/json/` for reading from a local instance. But users will not see the news in new versions of WebJET CMS.
- `springSecurityAllowedAuths` - list of allowed authorization methods for REST services, by default `basic,api-token`. Set to blank if the project does not need other than a standard form login. You must restart the application server after changing the value.

### HTTP headers

In the Configuration application, you can set the values of the security headers:
- `contentSecurityPolicy` - header setting `Content-Security-Policy`. Restrictions on how the page should load different resources. If you have an httpS certificate you can set it to: `default-src 'none'; script-src https: blob: data: 'unsafe-inline' 'unsafe-eval'; worker-src https: blob:; child-src https: blob:; style-src https: data: 'unsafe-inline' 'unsafe-eval'; img-src https: data: 'unsafe-inline'; font-src https: data:; object-src blob: 'self'; base-uri 'none'; frame-ancestors 'self'; connect-src blob: 'self'; frame-src 'self'`. Blank by default (header is not set).
- `contentSecurityPolicySvg` - specific limitation for SVG images due to their different processing in Internet Explorer.
- `featurePolicyHeader` - HTTP header value `Feature-Policy/Permissions-Policy` (e.g.: `microphone 'none'; geolocation 'none'`), more at: https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature\_Policy. Empty by default.
- `refererPolicy` - HTTP header settings `Referrer-Policy`, we recommend setting to `same-origin`. Default `same-origin`.
- `serverName` - header value `Server` in HTTP responses. Default `unknown`. It is not possible to set it to an empty value, because then the application server puts the header there.
- `strictTransportSecurity` - empty by default - sets the HTTP header [Strict-Transport-Security](https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security) in HTTP responses, which ensures HTTP requests are redirected to secure httpS, we recommend setting to: `max-age=31536000 ; includeSubDomains`. It requires that the application server is accessible via the secure httpS protocol.
- `xContentTypeOptions` - header value `X-Content-Type-Options` to set the determination of file types by content (ignoring suffixes). Default `nosniff`.
- `xFrameOptions` - header value `X-Frame-Options` for protection against CSRF attack. Default `SAMEORIGIN`.
- `xRobotsTagValue` - header value `X-Robots-Tag` for URLs set in the variable `xRobotsTagUrls`. Default `noindex, nofollow`.
- `xRobotsTagUrls` - comma-separated list of URL beginnings for setting the header `X-Robots-Tag`. If the list contains a value `NOT_SEARCHABLE_PAGE` the header is set even for pages that have search disabled. Default `/components/,NOT_SEARCHABLE_PAGE`.
- `xXssProtection` - header value `X-XSS-Protection` for protection against XSS attack. Default `1; mode=block`.

Setting the header `Access-Control` to access REST services from other servers:
- `accessControlAllowOriginValue` - header value `Access-Control-Allow-Origin` for URL set in variable `accessControlAllowOriginUrls`. You can use a macro in the value (see below). By default set to `{HTTP_PROTOCOL}://{SERVER_NAME}:{HTTP_PORT}`.
- `accessControlAllowOriginUrls` - comma-separated list of URL beginnings for setting the header `Access-Control-Allow-Origin`. Default set to `/rest/,/private/rest/,/admin/rest/`.
- `accessControlAllowHeaders` - header setting value `Access-Control-Allow-Headers`, is set only when generating the header `Access-Control-Allow-Origin`. Default `Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers, x-csrf-token`.
- `accessControlAllowMethods` - header setting value `Access-Control-Allow-Methods`, is set only when generating the header `Access-Control-Allow-Origin`. Default `HEAD,POST,GET,OPTIONS,PUT`.
- `accessControlMaxAge` - header setting value `Access-Control-Max-Age`, is set only when generating the header `Access-Control-Allow-Origin`. Default `1800`.
- `accessControlAllowedOrigins` - if not empty, requires a header in the request `origin` whose value must be in this list (comma/newline separated list). It is set only when generating the header `Access-Control-Allow-Origin`. Blank by default.

If you need to set a different HTTP header you can use the application [HTTP headers](../../admin/settings/response-header/README.md) in the Settings section.

You can use a macro in the value `{HTTP_PROTOCOL}, {SERVER_NAME}/{DOMAIN_NAME}/{DOMAIN_ALIAS}, {HTTP_PORT}`, which will be replaced by the value obtained on the server. `SERVER_NAME` is a domain name from `request.getServerName()`, `DOMAIN_NAME` a `DOMAIN_ALIAS` are the domain or alias values set in the website. The value of `{INSTALL_NAME}` represents the name of the installation. Value `{HEADER_ORIGIN}` contains the HTTP header value `origin`.

In older installations it was also possible to set HTTP headers via conf. variable `responseHeaders` in which you can set the header for the URL prefix (the beginning of the URL). On each line you enter a value in the format: `url-prefix:hlavička:hodnota`, for example:

```
/admin:X-Accel-Buffering:no
/rest/calculators/:Access-Control-Allow-Origin:*
/rest/calculators/:Access-Control-Allow-Headers:origin,x-requested-with,access-control-request-headers,content-type,access-control-request-method,accept,x-csrf-token
/rest/calculators/:Access-Control-Allow-Methods:GET,OPTIONS
```

Values set via conf. variable `responseHeaders` are global regardless of the current domain.

### Password rules

Password rules can be set via the following configuration variables (the default value is given in brackets next to the variable):
- `passwordAdminMinLength` - Specifies the minimum length of the password for the administrator (5).
- `passwordAdminMinCountOfSpecialSigns` - Specifies the minimum number of occurrences of special characters in the administrator password (0).
- `passwordAdminMinUpperCaseLetters` - Specifies the minimum number of occurrences of uppercase letters in an administrator password (1).
- `passwordAdminMinLowerCaseLetters` - Specifies the minimum number of occurrences of lowercase letters in the password for the administrator (0).
- `passwordAdminMinCountOfDigits` - Specifies the minimum number of occurrences of numbers in the password for the administrator (1).
- `passwordAdminExpiryDays` - Specifies the number of days the password is valid for the administrator. After the time expires, the user will be prompted to change the password. A value of 0 means that the password expiration (0) is not checked.

Similarly, password rules can be set for logging into the secure area of the website (not the administration), the variables are the same, but do not contain the expression `Admin`. So the variable name is e.g. `passwordMinUpperCaseLetters`.

By setting the configuration variable `isGoogleAuthRequiredForAdmin` at `true` will be for access to `/admin` parts required two-factor verification. Each user must set it up in advance in the administration by clicking on their name in the top right and selecting the option **Two-step verification**, or by opening the page `/admin/2factorauth.jsp`.

We recommend that you set up two-factor authentication for at least all accounts that can be used to manage user accounts and privileges and set system configuration.

WebJET checks the history when changing the password and does not allow the same password to be used again. This is affected by the following conf. variables:
- `passwordHistoryLength` - the number of used user passwords that are remembered in the history (by default 6).
- `passwordHistoryEnabled` - if set to `true` the password history is checked in the database and it is not allowed to change the password that was used in the past (by default `true`).

The following variables are used when requesting a password change:
- `passwordResetValidityInMinutes` - time validity in minutes for the sent password change link (default 30).
- `changePasswordPageUrl` - address of the password change page (default `/components/user/change_password.jsp`).

### Blocking login

After an incorrect combination of username and password, WebJET blocks further logins from the same IP address. It is possible to set the following conf. variables:
- `logonBlockedDelay` - Time in seconds during which it will not be possible to log in again after entering the wrong name/password (default 10).
- `logonBlockedAfterUnsuccessCount` - the number of unsuccessful logins after which the delay defined in `logonLoginBlockedDelay` (default 5).
- `logonLoginBlockedDelay` - the time in seconds during which it will not be possible to log in again after entering a bad password; and `logonBlockedAfterUnsuccessCount` the number of failed logins for the specified login name (default 60).

Thus, a value of 10 seconds is applied by default (`logonBlockedDelay`), if entered more than 5 times in a row (`logonBlockedAfterUnsuccessCount`), a delay of 60 seconds is applied (`logonLoginBlockedDelay`).

During the login lockout time, the failed attempts counter is still not incremented and the time is not extended, since no login code is called at all.

### Password hashing algorithm

From version `2022.40` the BCrypt algorithm is used to hash passwords in the implementation `org.springframework.security.crypto.bcrypt.BCrypt`.

Possible settings:
- `bcryptSaltRounds` (default 12) - log2 number of flipping repetitions
- `passwordHashAlgorithm` (default `bcrypt`) - name of the hashing algorithm, possible values `bcrypt` or `sha-512`.

Earlier versions used the algorithm `SHA-512` with 100 repetitions. Legacy password hash values are changed to the bcrypt algorithm when the user's password is changed. To force the algorithm change you can set the conf. variable `passwordAdminExpiryDays` to a non-zero value, which will prompt the user to change the password after logging in.

### Logging into administration

Logging into the administration is also affected by the configuration variables mentioned above:
- `adminEnabledIPs` - contains a comma-separated list of IP addresses from which access to `/admin` parts.
- `multidomainAdminHost` - allows you to set a separate domain address for access to `/admin` parts, e.g. `cms.domena.sk`. After setting up, the call will be `/admin` addresses on other domains return a 404 error - Page does not exist.
- `isGoogleAuthRequiredForAdmin` - enabling two-factor authentication when logging into the administration `/admin`.
- `clusterMyNodeType` - in the case of a cluster sets the node mode, only nodes set to `full` include administration and allow you to log in.
- `auditDontLogUsrlogon` - after setting to `true` normal (non-administrator) user logins will not be audited. Suitable for a highly loaded intranet where it unnecessarily overwhelms the audit (by default `false`).

In addition, a user who successfully authorises must meet the following criteria:
- `Schválený používateľ` - the account must have that option selected.
- `Začiatok platnosti` - if the value entered must be older than the current date.
- `Koniec platnosti` - if the value entered must be greater than the current date.
- `Povoliť vstup do admin sekcie (správa web sídla)` - account must have this option enabled, otherwise access to the administration is not possible.

In case of special requirements for user login/authentication, it is possible to implement a custom Java login class and set it via a conf. variable `adminLogonMethod`. The specified Java class is then used instead of the default login.

When logging in with incorrect details [blocks login](#blocking-login).

### Authentication against LDAP server

The following conf. variables can be set when authenticating a user against an LDAP server:
- `ldapProviderUrl` - LDAP server URL for LDAP login in the form `ldap://ldap.local:389/DC=firma,DC=com??base`.
- `ldapPassword` - the login name of the technical user for retrieving LDAP data.
- `ldapUsername` - the login password of the technical user to retrieve LDAP data.
- `ldapUseSslProtocol` - uses SSL when communicating with the LDAP server. You must have SSL enabled on port 636 of the LDAP server. If ldapS:// is used, leave the value at false.
- `NTLMForbiddenURL` - URL of the access denied (by default `/500.jsp`).
- `NTLMDomainController` - the name of the domain controller.
- `ldapDomainAppend` - if it is necessary to log in with the whole domain, it is possible to specify its addition to the specified user login name.
- `ldapSecurityPrincipalDn` - sets a special `SECURITY_PRINCIPAL` e.g. `cn=!USERNAME!,dc=ad,dc=interway,dc=sk` with the understanding that `!USERNAME!` is replaced by the login name. If it is empty it is used `ldapUsername+ldapDomainAppend`.
- `ldapFilter` - login filter for LDAP login with which account lookup is performed (default `(&(objectClass=Person) (&(sAMAccountName=!USERNAME!)))`).
- `basicNtlmLogonAttrs` - A list of attributes to read from the LDAP server when logging in. If empty, only the login is verified and the user is not updated with the values in the LDAP server. Default `mail,title,givenName,sn,streetAddress,l,postalCode,co,company,telephoneNumber,mobile,description,memberOf,distinguishedName,thumbnailPhoto`.
- `ntlmDefaultUserPhoto` - if set to a non-empty value and the user does not have a photo in LDAP sets the photo to the specified URL.

Rights settings:

After logging in, the user group name and group rights are automatically checked against the groups in LDAP (attribute `memberOf`). If the name matches a group in WebJET, the user is assigned. In addition, it is possible to set:
- `NTLMAdminGroupName` - The name of the group in LDAP that identifies that the account has administrative access (e.g. WebJETAdmins).
- `passwordProtectedAutoId` - A comma-separated list of user group IDs that will be assigned automatically to a user after a successful login.

### Configuring a Tomcat Application Server

We assume that the website/application will be accessible via secure httpS protocol. Therefore, it is necessary to set the attribute `secure="true"`, [HTTP/AJP connector](https://tomcat.apache.org/tomcat-9.0-doc/config/http.html) so that the session cookie is only accessible via the secure httpS protocol. You make the setting in the file `tomcat/conf/server.xml`. Attribute `useBodyEncodingForURI="true"` sets the same character encoding for the URL as is used for the page body.

```xml
<Connector
    ...
    secure="true"
    useBodyEncodingForURI="true"
    ...
/>
```

if you use an insecure HTTP protocol, the session cookie will not be accepted by the browser and the session will not be held (this will be shown by a repeated display of the login window as soon as you enter the correct credentials).

To avoid displaying the application server version when an error is displayed `Tomcat` a `Stack Trace` is required in server.xml to `<Host` element add configuration [ErrorReportValve](https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Error_Report_Valve):

```xml
<Host ...>
    <Valve className="org.apache.catalina.valves.ErrorReportValve"
        showReport="false"
        showServerInfo="false" />
</Host>
```

if necessary you can also create a static html page in coding `utf-8` with an error message and configure it as:

```xml
<Valve className="org.apache.catalina.valves.ErrorReportValve"
    errorCode.400="webapps/error400.html"
    errorCode.0="webapps/errorOthers.html"
    showReport="false"
    showServerInfo="false" />
```

In the configuration file `server.xml` we recommend to set the option correctly `defaultHost`. Attackers can modify the header `Host` and thus direct the request from the Internet, e.g. to an administration host that might not be accessible from the Internet (if both the administration and public nodes of the cluster are running on the same application server). An example is the use of `localhost` that can be assigned to the administration server and thus the modified request can end up on the administration node.

Value `defaultHost` we recommend to direct to the non-existent `<Host` element, in which case the application server will declare an error that such `host` he doesn't know. Thus, the application server does not handle unknown domains. The disadvantage of this solution is that after adding a new domain, it must be added as `<Alias` also to the application server.

If you use Load Balancer you need to ensure that it only sends known (whitelist) domains to the application servers. For unknown domains it must respond with an error.

```xml
<Engine name="Catalina" defaultHost="localhost">

    <Host name="localhost"...>
        <Alias>admin.domain.eu</Alias>
    </Host>
```

### Change notifications

We recommend setting up notifications sent to the security engineer for the following types of events:
- `CONF_UPDATE` a `CONF_DELETE` - change/delete configuration variable
- `PROP_UPDATE` a `PROP_DELETE` - changing/deleting the translation key (JavaScript code can also be inserted via the translation key)

You can set up notifications in the administration under Audit->Notifications. The security engineer will be aware of these changes and can react if an attack is suspected.

### Server security

The security of the server itself and the software used is also important. Update the software to the latest supported versions. It is also advisable to install an antivirus on the server, which will check the uploaded files and, if a virus is detected in a file, will prevent access to that file.

## Load Balancer settings

If Load Balancer is preloaded in front of the application servers, it is necessary to ensure:
- Route only defined domains to application servers so that an attack cannot occur by modifying `Host` headers. Load Balancer must not allow sending an unknown domain to the application server.
- WebJET takes the IP address setting from the HTTP header `X-Forwarded-For` when setting the configuration variable `serverBeyoundProxy=true`. So it is necessary to ensure that such HTTP header is not coming from the Internet, but Load Balancer always rewrites it to the correct value - the IP address of the visitor. The same applies to the HTTP header `x-forwarded-proto`. Incorrect header settings can lead to accessing parts that are only allowed for specific IP addresses. such as administration.

## WAF settings

If the application server is predefined `Web Application Firewall/WAF` need to be set **exceptions for administration**. Some HTTP requests in the administration can be detected as an XSS/SQL Injection attack because the HTTP request can send JavaScript code or an SQL statement. An example is saving a web page where the necessary JavaScript code may be inserted in the HTML code field in the header, or saving records in the Scripts application where JavaScript code is directly inserted.

The ideal solution is to use a clustered solution with a dedicated CMS node on the local network that is inaccessible from the external environment. For this case, the WAF for the CMS node can be omitted.

The administration uses REST services starting at the URL `/admin/rest`, see recommendations for [URL rules](../../custom-apps/spring/rest-url.md#url-address-rules). On WAF you need to set exceptions for URLs starting with:
- `/admin/rest/web-pages` - storage of web pages
- `/admin/rest/components/insert-script` - Application Scripts
- `/admin/v9/settings/translation-keys` - translation keys - in some cases it may be necessary to insert HTML code into the translation key
- `/admin/rest/settings/configuration` - configuration, applies similar to the translation keys
- `/admin/searchall.jsp` - search in the administration, it may be necessary to search for HTML/JavaScript expression
- `/admin/replaceall.jsp` - replacing an expression in the administration, similar to the search
- `/admin/updatedb.jsp` - execution of the specified SQL statement

Other URLs should be set based on the applications you use.

## Resolving security findings

- `Sensitive Data Exposure`

The type and version of the web server used was detected through the error responses from the server.

Solution: verify HTTP header settings `Server`, in WebJET can be rebuilt in the configuration variable `serverName`, see above.

- `RCE via uploaded JSP file`

WebJET CMS allows uploading of arbitrary files, including JSP files, which allow the execution of arbitrary commands on the running server.

The error can be prevented by setting the file upload rights, or by preventing the writing of program files altogether.

Solution: edit the rights setting for file upload via configuration variables `FCKConfig.Upload*`, see above.

- `MaliciousFileUpload`

The server lacks virus scanning, so it is possible to upload malicious files to the server.

Solution: install an antivirus on the server.

- `Missing Secure cookie flag`

Session cookie (`JSESSIONID`) does not have the security attribute set `Secure`.

Solution: check and adjust `secure` attribute in the file [server.xml](https://tomcat.apache.org/tomcat-9.0-doc/config/http.html) Tomcat application server, see above.
- `Missing HTTP Strict Transport Security policy`

The application does not set the HTTP header `Strict Transport Security`.

Solution: value [Strict Transport Security headers](https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security) can be set in the configuration variable `strictTransportSecurity=max-age=31536000 ; includeSubDomains`, see. above.
- `Stored XSS cez SVG obrázok`

SVG file allows to embed JavaScript code in the body, in case of direct display of such file in the browser the JavaScript code is executed (in case of standard embedding via `img` the code is not executed and the display is safe).

Solution: restrict the ability to upload SVG files, see rights settings above. As protection WebJET CMS generates HTTP header for SVG files `Content-Security-Policy` with value `default-src 'self'` which [prevents javascript code execution](https://github.com/digininja/svg_xss) when the image is displayed directly. The value is configurable via the configuration variable `contentSecurityPolicySvg`.

To verify the behavior, create an SVG file with the following content, upload it to the WebJET CMS and insert it into the test page and verify its views and (non-)execution of the XSS attack:

```xml
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg"> <polygon id="triangle" points="0,0 0,100 100,0" fill="#3e70b7"
stroke="#004400"/>
<script type="text/javascript">
alert("SVG XSS");
</script>
</svg>
```
- `Stored XSS` via modification of translation keys

Through the translation texts the editor is able to perform an attack of the type `Cross Site Scripting` against other visitors to the site or other administrators.

Translation keys are also used to insert HTML code (e.g. link to terms and conditions in the calculator, bolding, setting CSS styles), so this application technically allows you to insert HTML/JavaScript code as well (this is a feature, not a bug). Note that the editor can also insert JavaScript code directly in the page editor, there is no fundamental reason to prevent him from editing translation keys as well.

Solution: minimize the number of users with access to the Text Translation application. At the same time, users who do not have the "Edit texts - view all texts" permission have limited editing options. They can only edit selected keys (set via conf. variable `propertiesEnabledKeys`) and at the same time the modified value is filtered and allows only defined HTML tags and attributes. These are set in the conf. variable `propAllowedTags` where marks are permitted by default `p,div,a,sub,sup,br,strong` and attributes in the conf. variable `propAllowedAttrs` where attributes are allowed by default `href,src,style,class,rel`. If you want to completely prevent the possibility of inserting HTML code for users without the "Edit texts - display all texts" permission, you can set the conf. variable `propAllowedTags` to an empty value (or a character `-`). By setting it to the character `*` the protection is switched off.

We also recommend setting up notifications when you change to a security engineer as an additional protection, see above.

- `Insecure Deserialization`

The web page import contains .xml documents with serialized java objects. However, these .xml documents can be modified and served with their own serialized java objects of type `<object class="java.lang.Runtime" method="getRuntime">` that execute the specified operation directly on the server.

For a successful exploit it is necessary to modify the conf. variable `XMLDecoderAllowedClasses` that contains the list of allowed deserialized objects and add there the value `java.lang.Runtime`.

Solution: a normal user must not have permissions to modify configuration variables, only a dedicated person should modify them. As an additional protection, we have added directly into the code (without the possibility to edit this list) the unauthorized object types that cannot be added (enabled) through the configuration.

- `Cookies: Set the 'SameSite' flag as a counter measure to cross-site request forgery`

For `cookies` attribute can be set [SameSite](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite) to prevent cookies from being sent in a CSRF attack (to prevent cookies from being sent to other domains).

Currently in `servlet-api` support for setting this value in version 5.x is forthcoming, which may mean a long wait for direct programming support. However, when using Apache Tomcat, it is possible to set this value in the configuration using [CookieProcessor](https://tomcat.apache.org/tomcat-8.5-doc/config/cookie-processor.html), which in the standard implementation allows the value to be set:

```xml
<Context>
    ...
    <CookieProcessor sameSiteCookies="strict"/>
</Context>
```
