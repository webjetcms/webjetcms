<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Tools.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjetcms</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm</a> &gt; <span class="el_source">Tools.java</span></div><h1>Tools.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm;

import org.apache.commons.lang.StringUtils;
import org.apache.commons.lang.time.FastDateFormat;
import org.apache.http.Header;
import org.apache.http.HttpResponse;
import org.apache.http.client.fluent.Form;
import org.apache.http.client.fluent.Request;
import org.apache.http.client.fluent.Response;
import org.apache.http.util.EntityUtils;
import org.apache.struts.util.ResponseUtils;
import org.json.JSONArray;
import org.json.JSONException;
import org.springframework.context.ApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import sk.iway.Html2Text;
import sk.iway.Password;
import sk.iway.iwcm.common.DocTools;
import sk.iway.iwcm.common.FilePathTools;
import sk.iway.iwcm.components.basket.BasketDB;
import sk.iway.iwcm.components.domainRedirects.DomainRedirectDB;
import sk.iway.iwcm.database.SimpleQuery;
import sk.iway.iwcm.doc.DocDB;
import sk.iway.iwcm.doc.DocDetails;
import sk.iway.iwcm.form.FormDB;
import sk.iway.iwcm.helpers.RequestHelper;
import sk.iway.iwcm.i18n.Prop;
import sk.iway.iwcm.io.IwcmFile;
import sk.iway.iwcm.io.IwcmFsDB;
import sk.iway.iwcm.stat.StatDB;
import sk.iway.iwcm.users.UsersDB;

import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLEngine;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509ExtendedTrustManager;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.jsp.JspWriter;
import javax.servlet.jsp.PageContext;
import javax.swing.*;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.*;
import java.math.BigDecimal;
import java.net.InetAddress;
import java.net.Socket;
import java.net.URL;
import java.net.URLConnection;
import java.nio.charset.Charset;
import java.security.Principal;
import java.security.cert.X509Certificate;
import java.text.*;
import java.util.List;
import java.util.*;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 *  Podporne metody
 *
 *@Title        WebJET
 *@Company      Interway s.r.o. (www.interway.sk)
 *@Copyright    Interway s.r.o. (c) 2001-2002
 *@author       $Author: jeeff $
 *@version      $Revision: 1.6 $
 *@created      Nedeďż˝e, 2003, december 28
 *@modified     $Date: 2004/02/19 17:21:45 $
 */
<span class="fc" id="L73">public class Tools</span>
{
	public static final DecimalFormat decimalFormat;
	private static FastDateFormat simpleDateTimeFormat;
	private static FastDateFormat simpleDateFormat;
	private static FastDateFormat simpleTimeFormat;
	public static final Collator slovakCollator;

	static
	{
<span class="fc" id="L83">		decimalFormat = new DecimalFormat(&quot;0.##&quot;);</span>
<span class="fc" id="L84">		simpleDateFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateFormat&quot;));</span>
<span class="fc" id="L85">		simpleDateTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateTimeFormat&quot;));</span>
<span class="fc" id="L86">		simpleTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;timeFormat&quot;));</span>
<span class="fc" id="L87">		slovakCollator = Collator.getInstance(new Locale(&quot;sk&quot;));</span>
<span class="fc" id="L88">		slovakCollator.setStrength(Collator.SECONDARY);</span>
<span class="fc" id="L89">	}</span>

	/**
	 * Toto potrebujeme zavolat po inicializacii Constants aby bolo mozne zmenit pattern
	 */
	public static void reinitialize()
	{
<span class="fc" id="L96">		simpleDateFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateFormat&quot;));</span>
<span class="fc" id="L97">		simpleDateTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;dateTimeFormat&quot;));</span>
<span class="fc" id="L98">		simpleTimeFormat = FastDateFormat.getInstance(Constants.getString(&quot;timeFormat&quot;));</span>
<span class="fc" id="L99">	}</span>

	public static String formatDate(long date)
	{
<span class="pc bpc" id="L103" title="1 of 2 branches missed.">		if (date == 0) return &quot;&quot;;</span>
<span class="fc" id="L104">		return (formatDate(new Date(date)));</span>
	}
	public static String formatDate(Date date)
	{
<span class="fc bfc" id="L108" title="All 2 branches covered.">		if (date == null) return &quot;&quot;;</span>
<span class="fc" id="L109">		return (simpleDateFormat.format(date));</span>
	}
	public static String formatDate(Object o, String nullValue)
	{
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">		if (o == null) return nullValue;</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">		if(o instanceof Date)</span>
<span class="fc" id="L115">			return simpleDateFormat.format((Date)o);</span>
<span class="nc bnc" id="L116" title="All 2 branches missed.">		if(o instanceof java.sql.Timestamp)</span>
<span class="nc" id="L117">			return simpleDateFormat.format((java.sql.Timestamp)o);</span>
<span class="nc bnc" id="L118" title="All 2 branches missed.">		if(o instanceof java.sql.Date)</span>
<span class="nc" id="L119">			return simpleDateFormat.format((java.sql.Date)o);</span>
<span class="nc" id="L120">		return nullValue;</span>
	}
	public static String formatTime(long time)
	{
<span class="pc bpc" id="L124" title="1 of 2 branches missed.">		if (time == 0) return &quot;&quot;;</span>
<span class="fc" id="L125">		return (formatTime(new Date(time)));</span>
	}
	public static String formatTime(Date date)
	{
<span class="fc bfc" id="L129" title="All 2 branches covered.">		if (date == null) return &quot;&quot;;</span>
<span class="fc" id="L130">		return (simpleTimeFormat.format(date));</span>
	}
	public static String formatDateTime(long time)
	{
<span class="fc" id="L134">		return (formatDate(new Date(time)) + &quot; &quot; + formatTime(new Date(time)));</span>
	}
	public static String formatDateTime(Date time)
	{
<span class="fc bfc" id="L138" title="All 2 branches covered.">		if (time == null) return &quot;&quot;;</span>
<span class="fc" id="L139">		return formatDateTime(time.getTime());</span>
	}
	public static String formatDateTime(Object o, String nullValue)
	{
<span class="fc bfc" id="L143" title="All 2 branches covered.">		if (o == null) return nullValue;</span>
<span class="pc bpc" id="L144" title="1 of 2 branches missed.">		if(o instanceof Date)</span>
<span class="fc" id="L145">			return formatDateTime(((Date)o).getTime());</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">		if(o instanceof java.sql.Timestamp)</span>
<span class="nc" id="L147">			return formatDateTime(((java.sql.Timestamp)o).getTime());</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">		if(o instanceof java.sql.Date)</span>
<span class="nc" id="L149">			return formatDateTime(((java.sql.Date)o).getTime());</span>
<span class="nc" id="L150">		return nullValue;</span>
	}

	public static String formatDateTimeSeconds(long time)
	{
<span class="fc" id="L155">		return formatDateTimeSeconds(new Date(time));</span>
	}

	public static String formatDateTimeSeconds(Date time)
	{
<span class="fc bfc" id="L160" title="All 2 branches covered.">		if (time == null) return &quot;&quot;;</span>
<span class="fc" id="L161">		return simpleDateTimeFormat.format(time);</span>
	}

	/**
	 * povodne renameTo robilo problemy a to take ze niekedy sa stary subor nedal
	 * zmazat a preto nebol vytvoreny ani novy
	 * riesenie -&gt; najprv vytvorim novy subor a ak sa da potom zmazem ten stary
	 *
	 *@param  oldFilePath  Description of the Parameter
	 *@param  newFilePath  Description of the Parameter
	 *@return              Description of the Return Value
	 */
	public static boolean renameFile(String oldFilePath, String newFilePath)
	{
<span class="nc bnc" id="L175" title="All 2 branches missed.">		if (IwcmFsDB.useDBStorage(IwcmFsDB.getVirtualPath(oldFilePath)))</span>
		{
<span class="nc" id="L177">			new IwcmFile(oldFilePath).renameTo(new IwcmFile(newFilePath));</span>
<span class="nc" id="L178">			return true;</span>
		}
<span class="nc" id="L180">		boolean renamed = false;</span>

		try
		{
<span class="nc" id="L184">			File renameFile = new File(oldFilePath);</span>
<span class="nc bnc" id="L185" title="All 2 branches missed.">			if (renameFile.exists()==false)</span>
			{
<span class="nc" id="L187">				 Logger.error(Tools.class, &quot;renameFile(): zdrojovy subor &quot;+renameFile.getAbsolutePath()+&quot; neexistuje!&quot;);</span>
<span class="nc" id="L188">				 return false;</span>
			}

<span class="nc" id="L191">			renamed = renameFile.renameTo(new File(newFilePath));</span>
<span class="nc bnc" id="L192" title="All 2 branches missed.">			if (renamed == false)</span>
			{
<span class="nc" id="L194">				File newFile = new File(newFilePath);</span>
<span class="nc" id="L195">				File oldFile = new File(oldFilePath);</span>
<span class="nc" id="L196">				boolean fileCreated = newFile.createNewFile();</span>
<span class="nc bnc" id="L197" title="All 2 branches missed.">				if (!fileCreated)</span>
<span class="nc" id="L198">					throw new IllegalStateException(newFilePath+&quot; could not be created&quot;);</span>
<span class="nc" id="L199">				FileInputStream inStream = new FileInputStream(oldFile);</span>
				try
				{
<span class="nc" id="L202">					FileOutputStream out = new FileOutputStream(newFile);</span>
					try
					{
						int c;
<span class="nc" id="L206">						byte[] buff = new byte[150000];</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">						while ((c = inStream.read(buff)) != -1)</span>
						{
<span class="nc" id="L209">							out.write(buff, 0, c);</span>
						}
					}
<span class="nc" id="L212">					finally { out.close(); }</span>
				}
<span class="nc" id="L214">				finally { inStream.close(); }</span>

<span class="nc" id="L216">				renamed = true;</span>

				try
				{
					//skus ho zmazat
<span class="nc bnc" id="L221" title="All 2 branches missed.">					if(oldFile.delete() == false)</span>
<span class="nc" id="L222">						 Logger.error(Tools.class, &quot;renameFile(): zdrojovy subor &quot;+oldFile.getAbsolutePath()+&quot; sa nepodarilo vymazat!&quot;);</span>
				}
<span class="nc" id="L224">				catch (Exception ex)</span>
				{

<span class="nc" id="L227">				}</span>
			}
		}
<span class="nc" id="L230">		catch (Exception ex)</span>
		{

<span class="nc" id="L233">		}</span>

<span class="nc" id="L235">		return renamed;</span>
	}

	/**
	 * Otestuje, ci zadany string je prazdny
	 * @param s
	 * @return - true ak s je null, alebo prazdny, inak false
	 */
	public static boolean isEmpty(String s)
	{
<span class="fc" id="L245">		return StringUtils.isBlank(s);</span>
	}

	/**
	 * Otestuje, ci zadany string nie je prazdny
	 * @param s
	 * @return
	 */
	public static boolean isNotEmpty(String s)
	{
<span class="fc bfc" id="L255" title="All 2 branches covered.">		if (s==null) return false;</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">		return(!isEmpty(s));</span>
	}

	/**
	 * Otestuje, ci zadany StringBuilder je prazdny
	 * @param sb
	 * @return - true ak sb je null, alebo prazdny, inak false
	 */
	public static boolean isEmpty(StringBuilder sb)
	{
<span class="pc bpc" id="L266" title="1 of 2 branches missed.">		if(sb==null)</span>
<span class="nc" id="L267">			return true;</span>

<span class="fc" id="L269">		return isEmpty(sb.toString());</span>
	}

	/**
	 * Otestuje, ci zadana kolekcia je prazdna
	 *
	 * @param c kolekcia
	 * @return true ak je kolekcia null alebo prazdna, inak false
	 */
	public static boolean isEmpty(Collection&lt;?&gt; c)
	{
<span class="fc bfc" id="L280" title="All 2 branches covered.">		if (null == c)</span>
<span class="fc" id="L281">			return true;</span>
<span class="fc" id="L282">		return c.isEmpty();</span>
	}

	/**
	 * Otestuje, ci zadany StringBuilder nie je prazdny
	 * @param sb
	 * @return
	 */
	public static boolean isNotEmpty(StringBuilder sb)
	{
<span class="fc bfc" id="L292" title="All 2 branches covered.">		return !isEmpty(sb);</span>
	}

	/**
	 * Otestuje, ci su dane retazce rovnake, pricom empty a empty sa pocitaju za rovnake.
	 *
	 * @param a  retazec alebo null
	 * @param b  retazec alebo null
	 * @return   true ak sďż˝ oba empty, alebo oba non-empty a equal
	 */
	public static boolean areSame(String a, String b)
	{
<span class="nc bnc" id="L304" title="All 2 branches missed.">		return isEmpty(a) ? isEmpty(b) : a.equals(b);</span>
	}

	/**
	 *
	 * Otestuje, ci zadany parameter je email
	 * @param email
	 * @return
	 */
	public static boolean isEmail(String email)
	{
<span class="fc bfc" id="L315" title="All 2 branches covered.">		if (Tools.isEmpty(email)) return false;</span>

<span class="fc" id="L317">		int at = email.indexOf('@');</span>
<span class="fc bfc" id="L318" title="All 2 branches covered.">		if (at == -1) return false;</span>
<span class="fc bfc" id="L319" title="All 2 branches covered.">		if (at == 1) return email.matches(&quot;^[a-zA-Z0-9]@[a-zA-Z0-9]+[a-zA-Z0-9._-]*\\.[a-zA-Z]{2,16}$&quot;);</span>
<span class="pc bpc" id="L320" title="1 of 2 branches missed.">		if (at == 2) return email.matches(&quot;^[a-zA-Z0-9]+[a-zA-Z0-9]+@[a-zA-Z0-9]+[a-zA-Z0-9._-]*\\.[a-zA-Z]{2,16}$&quot;);</span>

<span class="fc" id="L322">		return email.matches(&quot;^[a-zA-Z0-9]+[a-zA-Z0-9._\\-+=#$%&amp;]*[a-zA-Z0-9]+@[a-zA-Z0-9]+[a-zA-Z0-9._-]*\\.[a-zA-Z]{2,16}$&quot;);</span>
	}

	/**
	 * Otestuje, ci zadany string je telefonne cislo
	 */
	public static boolean isPhoneNumber(String phoneNumber) {
<span class="nc bnc" id="L329" title="All 2 branches missed.">		if (Tools.isEmpty(phoneNumber))</span>
<span class="nc" id="L330">			return false;</span>

		try
        {
<span class="nc" id="L334">            String[] regexp = FormDB.getRegExpByType(&quot;phone&quot;);</span>
<span class="nc bnc" id="L335" title="All 6 branches missed.">            if (regexp != null &amp;&amp; regexp.length&gt;2 &amp;&amp; Tools.isNotEmpty(regexp[2]))</span>
            {
<span class="nc bnc" id="L337" title="All 2 branches missed.">                if (phoneNumber.matches(regexp[2])) return true;</span>
<span class="nc" id="L338">                else return false;</span>
            }
        }
<span class="nc" id="L341">		catch (Exception ex)</span>
        {
<span class="nc" id="L343">            sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L344">        }</span>

		//regexp nie je definovany vratime true, ze je validny
<span class="nc" id="L347">		return true;</span>
	}

	/**
	 * Vykona preklad URL na ine URL, pouziva sa ak je potrebne loopback data stahovat z ineho portu / nazvu
	 * @param url
	 * @return
	 */
	public static String natUrl(String url)
	{
<span class="fc" id="L357">		String natUrlTranslate = Constants.getString(&quot;natUrlTranslate&quot;);</span>
<span class="pc bpc" id="L358" title="1 of 2 branches missed.">		if (Tools.isEmpty(natUrlTranslate)) return url;</span>

<span class="fc" id="L360">		String urlOriginal = url;</span>
<span class="fc" id="L361">		url = Tools.replaceStrings(url, &quot;natUrlTranslate&quot;, true);</span>

<span class="fc" id="L363">		Logger.debug(Tools.class, &quot;natUrl: &quot;+urlOriginal+&quot;-&gt;&quot;+url);</span>

<span class="fc" id="L365">		return url;</span>
	}

	/**
	 * Nahradi vyrazy v texte podla konf. premennej constantName, vyrazy musia byt na novom riadku vo formate stary|novy, pouziva sa ked potrebujem nahradit viacero vyrazov
	 * @param text
	 * @param constantName
	 * @param replaceWholeLine - ak je true nahradia sa len vyrazy zhodne na novom riadku
	 * @return
	 */
	public static String replaceStrings(String text, String constantName, boolean replaceWholeLine)
	{
<span class="fc" id="L377">		String replaces = Constants.getString(constantName);</span>
<span class="fc bfc" id="L378" title="All 2 branches covered.">		if (Tools.isEmpty(replaces)) return text;</span>

		try
		{
<span class="fc" id="L382">			String[] urls = Tools.getTokens(replaces, &quot;\n&quot;);</span>
<span class="pc bpc" id="L383" title="1 of 2 branches missed.">			if (urls.length==0) return text;</span>
<span class="fc bfc" id="L384" title="All 2 branches covered.">			for (String pair : urls)</span>
			{
<span class="pc bpc" id="L386" title="1 of 2 branches missed.">				if (Tools.isEmpty(pair)) continue;</span>
<span class="fc" id="L387">				String[] pairArray = pair.split(&quot;\\|&quot;);</span>
<span class="pc bpc" id="L388" title="2 of 4 branches missed.">				if (pairArray==null || pairArray.length!=2) continue;</span>

<span class="pc bpc" id="L390" title="1 of 2 branches missed.">				if (replaceWholeLine)</span>
				{
<span class="pc bpc" id="L392" title="1 of 4 branches missed.">					if (text.startsWith(pairArray[0]) == true &amp;&amp; text.startsWith(pairArray[1]) == false)</span>
					{
<span class="fc" id="L394">						text = Tools.replace(text, pairArray[0], pairArray[1]);</span>
					}
				}
				else
				{
<span class="nc" id="L399">					text = Tools.replace(text, pairArray[0], pairArray[1]);</span>
				}
			}
		}
<span class="nc" id="L403">		catch (Exception ex)</span>
		{
<span class="fc" id="L405">		}</span>

<span class="fc" id="L407">		return text;</span>
	}

	/**
	 * Autorizuje sa pomozou tokenu, stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param token
	 * @return
	 */
	public static String authWithTokenAndDownloadUrl(String url, String token)
	{
<span class="nc" id="L418">		Map&lt;String, String&gt; headers = new HashMap&lt;&gt;();</span>
<span class="nc" id="L419">		headers.put(&quot;Authorization&quot;, &quot;Bearer &quot; + token);</span>
<span class="nc" id="L420">		return downloadUrl( url,  SetCharacterEncodingFilter.getEncoding(),  null,0, headers);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @return
	 */
	public static String downloadUrl(String url)
	{
<span class="fc" id="L430">		return(downloadUrl(url, SetCharacterEncodingFilter.getEncoding(), null));</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url url
	 * @param characterEncoding encoding
	 * @return
	 */
	public static String downloadUrl(String url, String characterEncoding)
	{
<span class="fc" id="L441">		return(downloadUrl(url, characterEncoding, null));</span>
	}


	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @return
	 */
	public static String downloadUrl(String url, javax.servlet.http.Cookie [] cookies)
	{
<span class="fc" id="L452">		return(downloadUrl(url, SetCharacterEncodingFilter.getEncoding(), cookies));</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies)
	{
<span class="fc" id="L464">		return downloadUrl( url,  defaultEncoding,  cookies,0);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @param timeOutSeconds cas v sekundach po uplynuti ktorych sa spojenie prerusi.
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies,int timeOutSeconds)
	{
<span class="fc" id="L477">		return downloadUrl( url,  defaultEncoding,  cookies, timeOutSeconds, null);</span>
	}

	/**
	 * Stiahne pozadovane URL a vrati to ako String, ak nastala chyba, vrati null
	 * @param url
	 * @param defaultEncoding - kodovanie (ak nebude nastavene v response hlavicke)
	 * @param cookies cookies ktore sa maju pouzit pri requeste
	 * @param timeOutSeconds cas v sekundach po uplynuti ktorych sa spojenie prerusi.
	 * @param headers dodatocne hlavicky ktore chceme requestu pridat
	 * @return
	 */
	public static String downloadUrl(String url, String defaultEncoding, javax.servlet.http.Cookie[] cookies,int timeOutSeconds, Map&lt;String, String&gt; headers)
	{
<span class="fc" id="L491">		String body = null;</span>
<span class="pc bpc" id="L492" title="1 of 4 branches missed.">		if (url.startsWith(&quot;http://&quot;) || url.startsWith(&quot;https://&quot;))</span>
		{
			try
			{
<span class="pc bpc" id="L496" title="2 of 4 branches missed.">				if (timeOutSeconds &lt; 1 &amp;&amp; &quot;cloud&quot;.equals(Constants.getInstallName())) timeOutSeconds = 120;</span>

<span class="fc" id="L498">				url = Tools.natUrl(url);</span>

<span class="fc" id="L500">				Logger.debug(Tools.class,&quot;DownloadUrl: &quot; + url);</span>

				//body obsahuje URL adresu, ktoru je treba stiahnut
<span class="fc" id="L503">				URLConnection conn = null;</span>
<span class="fc" id="L504">				URL urlObj = new URL(url);</span>

<span class="fc bfc" id="L506" title="All 2 branches covered.">				if (url.startsWith(&quot;https://&quot;))</span>
				{
<span class="fc" id="L508">					doNotVerifyCertificates(urlObj.getHost());</span>
				}

<span class="fc" id="L511">				conn = urlObj.openConnection();</span>

<span class="pc bpc" id="L513" title="1 of 2 branches missed.">				if(timeOutSeconds &gt; 0)</span>
				{
<span class="nc" id="L515">					conn.setConnectTimeout(timeOutSeconds*1000);</span>
<span class="nc" id="L516">					conn.setReadTimeout(timeOutSeconds*1000);</span>
				}
				/*if (conn instanceof HttpURLConnection)
				{
					HttpURLConnection urlConn = (HttpURLConnection)conn;
				}*/
<span class="fc bfc" id="L522" title="All 2 branches covered.">				if(cookies != null)</span>
				{
<span class="fc bfc" id="L524" title="All 2 branches covered.">					for (javax.servlet.http.Cookie cookie : cookies) {</span>
<span class="fc" id="L525">					    conn.addRequestProperty(&quot;Cookie&quot;, cookie.getName() + &quot;=&quot; + cookie.getValue());</span>
					}
				}

<span class="pc bpc" id="L529" title="3 of 4 branches missed.">				if(headers != null &amp;&amp; headers.keySet().size() &gt; 0)</span>
				{
<span class="nc bnc" id="L531" title="All 2 branches missed.">					for(Map.Entry&lt;String, String&gt; entry : headers.entrySet())</span>
					{
<span class="nc" id="L533">						conn.setRequestProperty(entry.getKey(), entry.getValue());</span>
<span class="nc" id="L534">					}</span>
				}

<span class="fc" id="L537">				String ua = Constants.getString(&quot;downloadUrlUserAgent&quot;);</span>
<span class="pc bpc" id="L538" title="1 of 2 branches missed.">				if(Tools.isNotEmpty(ua)) conn.addRequestProperty(&quot;User-Agent&quot;, ua);</span>

<span class="fc" id="L540">				conn.setAllowUserInteraction(false);</span>
<span class="fc" id="L541">				conn.setDoInput(true);</span>
<span class="fc" id="L542">				conn.setDoOutput(false);</span>
<span class="fc" id="L543">				conn.connect();</span>
<span class="fc" id="L544">				String location = conn.getHeaderField(&quot;Location&quot;);</span>
<span class="fc" id="L545">				String encoding = conn.getHeaderField(&quot;Content-Type&quot;);</span>

<span class="pc bpc" id="L547" title="1 of 4 branches missed.">				if (encoding==null || encoding.indexOf(&quot;charset=&quot;)==-1)</span>
				{
<span class="fc" id="L549">					encoding = defaultEncoding;</span>
				}
				else
				{
<span class="fc" id="L553">					encoding = encoding.substring(encoding.indexOf(&quot;charset=&quot;)+8).trim();</span>
				}

<span class="fc" id="L556">				Logger.debug(Tools.class,&quot;---&gt; ENCODING: &quot; + encoding);</span>

<span class="fc" id="L558">				StringBuilder sb = new StringBuilder();</span>
<span class="fc" id="L559">				BufferedInputStream is = new BufferedInputStream(conn.getInputStream());</span>
<span class="fc" id="L560">				InputStreamReader in = new InputStreamReader(is, encoding);</span>
<span class="fc" id="L561">				char[] buffer = new char[8000];</span>
<span class="fc" id="L562">				int n = 0;</span>
				while (true)
				{
<span class="fc" id="L565">					 n = in.read(buffer);</span>
<span class="fc bfc" id="L566" title="All 2 branches covered.">					 if (n &lt; 1) break;</span>
<span class="fc" id="L567">					 sb.append(buffer, 0, n);</span>
				}
<span class="fc" id="L569">				in.close();</span>
<span class="fc" id="L570">				body = sb.toString();</span>

<span class="pc bpc" id="L572" title="1 of 2 branches missed.">				if (Tools.isNotEmpty(location))</span>
				{
<span class="nc" id="L574">					body = &quot;&lt;html&gt;&lt;body&gt;\n&quot; +</span>
							&quot;&lt;a href='&quot;+location+&quot;'&gt;&quot;+location+&quot;&lt;/a&gt;\n&quot; +
							&quot;&lt;script language='JavaScript'&gt;\n&quot; +
							&quot;window.location.href='&quot;+location+&quot;';\n&quot; +
							&quot;&lt;/script&gt;\n&quot; +
							&quot;&lt;/body&gt;&lt;/html&gt;&quot;;
				}

			}
<span class="nc" id="L583">			catch (Exception ex)</span>
			{
<span class="nc bnc" id="L585" title="All 4 branches missed.">			    if (url==null || url.contains(&quot;localconf.jsp&quot;)==false)</span>
                {
<span class="nc" id="L587">                    Logger.error(Tools.class, &quot;ERROR downloadUrl(&quot; + url + &quot;)&quot;);</span>
<span class="nc" id="L588">                    sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L589">                    body = null;</span>
                }
<span class="fc" id="L591">			}</span>
		}
<span class="fc" id="L593">		return(body);</span>
	}

	/**
	 * Stiahnutie stranky s vyuzitim Jakarta HTTP Client (zvlada POST aj GET)
	 * @param basePath
	 * @param req
	 * @return
	 */
	public static String downloadUrl(String basePath, HttpServletRequest req)
	{
<span class="nc" id="L604">		String data = null;</span>

		Request request;

<span class="nc" id="L608">		basePath = Tools.natUrl(basePath);</span>
		//WebJETProxySelector.setProxyForHttpClient(client, basePath);
<span class="nc" id="L610">		Logger.debug(Tools.class, &quot;downloadUrl: basePath=&quot;+basePath);</span>
		String name;
		String value;

<span class="nc bnc" id="L614" title="All 2 branches missed.">		if (&quot;GET&quot;.equalsIgnoreCase(req.getMethod()))</span>
		{
<span class="nc bnc" id="L616" title="All 6 branches missed.">			if (basePath.indexOf('?')==-1 &amp;&amp; req.getQueryString()!=null &amp;&amp; req.getQueryString().length()&gt;1)</span>
			{
<span class="nc" id="L618">				basePath = basePath + &quot;?&quot; + req.getQueryString();</span>
			}
<span class="nc" id="L620">			Logger.println(Tools.class,&quot;JE TO GET: &quot; + basePath);</span>
<span class="nc" id="L621">			request = Request.Get(basePath);</span>
		}
		else
		{
<span class="nc" id="L625">			Logger.println(Tools.class,&quot;JE TO POST: &quot; + basePath);</span>

<span class="nc" id="L627">			request = Request.Post(basePath);</span>
<span class="nc" id="L628">			Form form = Form.form();</span>
<span class="nc" id="L629">		   Enumeration&lt;String&gt; params = req.getParameterNames();</span>
<span class="nc bnc" id="L630" title="All 2 branches missed.">			while (params.hasMoreElements())</span>
			{
<span class="nc" id="L632">				name = params.nextElement();</span>
<span class="nc" id="L633">				value = req.getParameter(name);</span>
<span class="nc" id="L634">				Logger.println(Tools.class,&quot;param: &quot; + name+&quot;=&quot;+value);</span>
<span class="nc" id="L635">				form.add(name, value);</span>
			}
<span class="nc" id="L637">			request.bodyForm(form.build());</span>
		}

      //method.setFollowRedirects(true);
      //method.setStrictMode(false);

<span class="nc" id="L643">      Enumeration&lt;String&gt; e = req.getHeaderNames();</span>
<span class="nc bnc" id="L644" title="All 2 branches missed.">		while (e.hasMoreElements())</span>
		{
<span class="nc" id="L646">			name = e.nextElement();</span>
<span class="nc" id="L647">			value = req.getHeader(name);</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">			if (&quot;host&quot;.equalsIgnoreCase(name))</span>
			{
				//value = &quot;www2.ing.cz&quot;;
				try
				{
<span class="nc" id="L653">					URL url = new URL(basePath);</span>
<span class="nc" id="L654">					value = url.getHost();</span>
				}
<span class="nc" id="L656">				catch (Exception ex)</span>
				{

<span class="nc" id="L659">				}</span>
			}
<span class="nc" id="L661">			request.addHeader(name, value);</span>
<span class="nc" id="L662">			Logger.println(Tools.class,name+&quot;: &quot;+value);</span>
		}

<span class="nc" id="L665">		String contentType = req.getContentType()+&quot;; charset=&quot;+req.getCharacterEncoding();</span>
<span class="nc" id="L666">		request.setHeader(&quot;Content-Type&quot;, contentType);</span>
<span class="nc" id="L667">		Logger.println(Tools.class,&quot;header: Content-Type: &quot; + contentType);</span>

		try {
<span class="nc" id="L670">			Response response = request.execute();</span>
<span class="nc" id="L671">			HttpResponse httpResponse = response.returnResponse();</span>

			// write out the response headers
<span class="nc" id="L674">			Logger.println(Tools.class,&quot;*** Response ***&quot;);</span>
<span class="nc" id="L675">			Logger.println(Tools.class,&quot;Status Line: &quot; + httpResponse.getStatusLine().toString());</span>
<span class="nc" id="L676">			Logger.println(Tools.class,&quot;Status Code: &quot; + httpResponse.getStatusLine().getStatusCode());</span>
<span class="nc" id="L677">			Header[] responseHeaders = httpResponse.getAllHeaders();</span>
			Header h;
<span class="nc bnc" id="L679" title="All 2 branches missed.">			for (int i=0; i&lt;responseHeaders.length; i++)</span>
			{
<span class="nc" id="L681">				h = responseHeaders[i];</span>
				//Logger.print(this,responseHeaders[i]);
<span class="nc bnc" id="L683" title="All 4 branches missed.">				if (h.getName()!=null &amp;&amp; h.getValue() != null)</span>
				{
					//Logger.debug(Tools.class,&quot;Response headers: name=&quot;+h.getName()+&quot; value=&quot;+h.getValue());
					//res.setHeader(h.getName(), h.getValue());
				}
			}

<span class="nc" id="L690">			String encoding = null;</span>
<span class="nc bnc" id="L691" title="All 2 branches missed.">			if (httpResponse.getLastHeader(&quot;Content-Type&quot;)!=null) encoding = httpResponse.getLastHeader(&quot;Content-Type&quot;).getValue();</span>
<span class="nc bnc" id="L692" title="All 4 branches missed.">			if (encoding==null || encoding.indexOf(&quot;charset=&quot;)==-1)</span>
			{
<span class="nc" id="L694">				encoding = SetCharacterEncodingFilter.getEncoding();</span>
			}
			else
			{
<span class="nc" id="L698">				encoding = encoding.substring(encoding.indexOf(&quot;charset=&quot;)+8).trim();</span>
			}

<span class="nc" id="L701">			Logger.debug(Tools.class,&quot;---&gt; ENCODING: &quot; + encoding);</span>

<span class="nc" id="L703">			data = EntityUtils.toString(httpResponse.getEntity(), Charset.forName(encoding));</span>
		}
<span class="nc" id="L705">		catch (Exception ex) {</span>
<span class="nc" id="L706">			Logger.error(Tools.class, ex);</span>
<span class="nc" id="L707">		}</span>

<span class="nc" id="L709">		return(data);</span>
	}

	/**
	 * Rozparsuje retazec, najde tam pozadovany tag a v nom hodnotu atributu, napr v retazci
	 * &lt;topurl value=&quot;hodnota&quot;&gt;: tag=topurl, param=value, navratova hodnota je hodnota
	 * @param data
	 * @param tag
	 * @param param
	 * @return
	 */
	public static String parseTagValue(String data, String tag, String param)
	{
<span class="nc bnc" id="L722" title="All 6 branches missed.">		if (data == null || tag == null || param == null)</span>
		{
<span class="nc" id="L724">			return(null);</span>
		}
<span class="nc" id="L726">		String ret = null;</span>
		try
		{
			//najdi tag
<span class="nc" id="L730">			int startIndex = data.indexOf(&quot;&lt;&quot;+tag);</span>
<span class="nc bnc" id="L731" title="All 2 branches missed.">			if (startIndex != -1)</span>
			{
				//najdi param
<span class="nc" id="L734">				startIndex = data.indexOf(&quot; &quot;+param+&quot;=&quot;, startIndex);</span>
				//najdi uvodzovky
<span class="nc" id="L736">				startIndex = data.indexOf(&quot;\&quot;&quot;, startIndex);</span>
				//najdi koncove uvodzovky
<span class="nc" id="L738">				int endIndex = data.indexOf(&quot;\&quot;&quot;, startIndex+1);</span>
<span class="nc bnc" id="L739" title="All 2 branches missed.">				if (endIndex &gt; startIndex)</span>
				{
<span class="nc" id="L741">					ret =  data.substring(startIndex+1, endIndex);</span>
				}
			}
		}
<span class="nc" id="L745">		catch (Exception ex)</span>
		{
<span class="nc" id="L747">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L748">		}</span>
<span class="nc" id="L749">		return(ret);</span>
	}

	public static String join(String[] array)
	{
<span class="nc" id="L754">		return join(array, &quot;,&quot;);</span>
	}

	public static String join(String[] array, String glue)
	{
<span class="fc" id="L759">		StringBuilder result = new StringBuilder();</span>
<span class="fc bfc" id="L760" title="All 2 branches covered.">		for(int i = 0; i &lt; array.length; i++)</span>
		{
<span class="fc" id="L762">			result.append(array[i]);</span>
<span class="pc bpc" id="L763" title="1 of 2 branches missed.">			if (i &lt; array.length - 1) result.append(glue);</span>
		}

<span class="fc" id="L766">		return result.toString();</span>
	}

	public static &lt;T&gt; String join(List&lt;T&gt; array)
	{
<span class="nc" id="L771">		return join(array, &quot;,&quot;);</span>
	}

	public static &lt;T&gt; String join(List&lt;T&gt; array, String glue) {
<span class="fc" id="L775">		StringBuilder result = new StringBuilder();</span>
<span class="pc bpc" id="L776" title="1 of 4 branches missed.">		if (array == null || array.size()&lt;1) return &quot;&quot;;</span>
<span class="fc bfc" id="L777" title="All 2 branches covered.">		for(int i = 0; i &lt; array.size(); i++)</span>
		{
<span class="fc" id="L779">			result.append(array.get(i));</span>
<span class="fc bfc" id="L780" title="All 2 branches covered.">			if (i &lt; array.size() - 1) result.append(glue);</span>
		}

<span class="fc" id="L783">		return result.toString();</span>
	}

	/**
	 * Naformatuje velkost suboru ako 1,45 KB
	 * @param lengthLong
	 * @return
	 */
	public static String formatFileSize(long lengthLong)
	{
<span class="fc" id="L793">		String length = &quot;&quot;;</span>
<span class="pc bpc" id="L794" title="1 of 2 branches missed.">		if (lengthLong &gt; (1024 * 1024))</span>
		{
<span class="nc" id="L796">			length = decimalFormat.format((lengthLong / (1024D * 1024D))) + &quot; MB&quot;;</span>
		}
<span class="pc bpc" id="L798" title="1 of 2 branches missed.">		else if (lengthLong &gt; 1024)</span>
		{
<span class="fc" id="L800">			length = decimalFormat.format((lengthLong / 1024D)) + &quot; kB&quot;;</span>
		}
		else
		{
<span class="nc" id="L804">			length = decimalFormat.format(lengthLong) + &quot; B&quot;;</span>
		}
<span class="fc" id="L806">		return(length);</span>
	}

	/**
	 * Vrati timestamp aktualneho casu
	 * @return
	 */
	public static long getNow()
	{
<span class="fc" id="L815">		return System.currentTimeMillis();</span>
	}

	/**
	 * @deprecated - use Password.generatePassword
	 * @param len
	 * @return
	 */
	@Deprecated
	public static String generatePassword(int len)
	{
<span class="nc" id="L826">		return Password.generatePassword(len);</span>
	}

	/**
	 * skonvertuje String na int, vratane vsetkych kontrol. Ak sa nepodari, vrati defaultValue
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static int getIntValue(String value, int defaultValue)
	{
<span class="fc" id="L837">		int ret = defaultValue;</span>
		try
		{
<span class="fc bfc" id="L840" title="All 2 branches covered.">			if (value!=null)</span>
			{
<span class="fc" id="L842">				ret = Integer.parseInt(value.trim());</span>
			}
		}
<span class="fc" id="L845">		catch (Exception ex)</span>
		{

<span class="fc" id="L848">		}</span>
<span class="fc" id="L849">		return(ret);</span>
	}

	public static int getIntValue(Integer value)
	{
<span class="fc" id="L854">		return(getIntValue(value, 0));</span>
	}

	/**
	 * Ziska int hodnotu z Integera, alebo vrati defaultValue (ak je null)
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static int getIntValue(Integer value, int defaultValue)
	{
<span class="fc bfc" id="L865" title="All 2 branches covered.">		if (value==null)</span>
		{
<span class="fc" id="L867">			return(defaultValue);</span>
		}
<span class="fc" id="L869">		return(value.intValue());</span>
	}

	/**
	 * ziska integer hodnoty z pola stringov a ak je null, tak prazdny zoznam
	 *
	 * @param value
	 * @return
	 */
	public static List&lt;Integer&gt; getIntegerListValue(String[] value) {
<span class="nc" id="L879">		List&lt;Integer&gt; ret = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">		if (null != value)</span>
		{
<span class="nc bnc" id="L882" title="All 2 branches missed.">			for (String v : value)</span>
			{
<span class="nc" id="L884">				Integer i = Integer.valueOf(v);</span>
<span class="nc bnc" id="L885" title="All 2 branches missed.">				if (null != i)</span>
				{
<span class="nc" id="L887">					ret.add(i);</span>
				}
			}
		}
<span class="nc" id="L891">		return ret;</span>
	}

	public static float getFloatValue(String value, float defaultValue)
	{
<span class="nc" id="L896">		float ret = defaultValue;</span>
		try
		{
<span class="nc bnc" id="L899" title="All 2 branches missed.">			if (value!=null)</span>
			{
<span class="nc" id="L901">				ret = Float.parseFloat(value.trim());</span>
			}
		}
<span class="nc" id="L904">		catch (Exception ex)</span>
		{

<span class="nc" id="L907">		}</span>
<span class="nc" id="L908">		return(ret);</span>
	}

	public static double getDoubleValue(String value, double defaultValue)
	{
<span class="nc" id="L913">		double ret = defaultValue;</span>
		try
		{
<span class="nc bnc" id="L916" title="All 2 branches missed.">			if (value!=null)</span>
			{
<span class="nc" id="L918">				ret = Double.parseDouble(value.replace(',', '.').trim());</span>
			}
		}
<span class="nc" id="L921">		catch (Exception ex)</span>
		{

<span class="nc" id="L924">		}</span>
<span class="nc" id="L925">		return(ret);</span>
	}

	public static double getDoubleValue(Object value, double defaultValue)
	{
<span class="fc" id="L930">		double ret = defaultValue;</span>
		try
		{
<span class="pc bpc" id="L933" title="1 of 2 branches missed.">			if (value!=null)</span>
			{
<span class="nc" id="L935">				ret = ((Double)value).doubleValue();</span>
			}
		}
<span class="fc" id="L938">		catch (Exception ex)</span>
		{

<span class="nc" id="L941">		}</span>
<span class="fc" id="L942">		return(ret);</span>
	}

	/**
	 * Ziska BigDecimal hodnotu zo Stringu alebo z defaultValue ak je value null.
	 * Ak &lt;code&gt;value&lt;/code&gt; alebo &lt;code&gt;defaultValue&lt;/code&gt; nie je platnou reprezentaciou BigDecimal-u vrati BigDecimal s hodnotou 0.
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static BigDecimal getBigDecimalValue(String value, String defaultValue)
	{
<span class="fc" id="L954">		BigDecimal ret = null;</span>
		try
		{
<span class="pc bpc" id="L957" title="1 of 2 branches missed.">			if (value!=null)</span>
			{
<span class="fc" id="L959">				ret = new BigDecimal(value.replace(',', '.').replace(&quot; &quot;,&quot;&quot;).trim());</span>
			}
			else
			{
<span class="nc" id="L963">				ret = new BigDecimal(defaultValue);</span>
			}
		}
<span class="fc" id="L966">		catch (Exception ex)</span>
		{
<span class="fc" id="L968">			ret = BigDecimal.valueOf(0);</span>
<span class="fc" id="L969">		}</span>
<span class="fc" id="L970">		return ret;</span>
	}

	/**
	 * Get BigDecimal value from object. If value is null or not valid BigDecimal representation, return defaultValue.
	 * @param value - BigDecimal object or value.toString() will be used to parse
	 * @param defaultValue - default value to return if parsing fails
	 */
	public static BigDecimal getBigDecimalValue(Object value, String defaultValue)
	{
		try
		{
<span class="nc bnc" id="L982" title="All 2 branches missed.">			if (value!=null)</span>
			{
<span class="nc bnc" id="L984" title="All 2 branches missed.">				if (value instanceof BigDecimal) {</span>
<span class="nc" id="L985">					return ((BigDecimal)value);</span>
				}
<span class="nc" id="L987">				return getBigDecimalValue(value.toString(), defaultValue);</span>
			}
		}
<span class="nc" id="L990">		catch (Exception ex)</span>
		{
<span class="nc" id="L992">		}</span>
<span class="nc" id="L993">		return new BigDecimal(defaultValue);</span>
	}

	/**
	 * Ziska BigDecimal hodnotu zo Stringu, ak je null, alebo ak &lt;code&gt;value&lt;/code&gt; nie je platnou reprezentaciou BigDecimal-u
	 * vrati BigDecimal s hodnotou 0.
	 * @param value
	 * @return
	 */
	public static BigDecimal getBigDecimalValue(String value)
	{
<span class="fc" id="L1004">		return getBigDecimalValue(value, &quot;0&quot;);</span>
	}

	public static long getLongValue(String value, long defaultValue)
	{
<span class="fc" id="L1009">		long ret = defaultValue;</span>
		try
		{
<span class="fc bfc" id="L1012" title="All 2 branches covered.">			if (value!=null)</span>
			{
<span class="fc" id="L1014">				ret = Long.parseLong(value.replace(',', '.').trim());</span>
			}
		}
<span class="fc" id="L1017">		catch (Exception ex)</span>
		{

<span class="fc" id="L1020">		}</span>
<span class="fc" id="L1021">		return(ret);</span>
	}

	/**
	 * Vrati hodnotu parametra z requestu, v Tomcate je bug, ak je URL ...?docid=3#kotva, tak to vrati
	 * vratane tej kotvy.
	 * EDIT 13.8.2014 : navratova hodnota je osetrena na XSS
	 * @param request
	 * @param name
	 * @return
	 */
	public static String getParameter(HttpServletRequest request, String name)
	{
<span class="fc" id="L1034">		String ret = request.getParameter(name);</span>
<span class="pc bpc" id="L1035" title="1 of 4 branches missed.">		if (ret!=null &amp;&amp; ret.indexOf('#')!=-1)</span>
		{
<span class="nc" id="L1037">			ret = ret.substring(0, ret.indexOf('#'));</span>
		}
<span class="fc" id="L1039">		return org.apache.struts.util.ResponseUtils.filter(ret);</span>
	}

	/**
	 * Ziska string hodnotu z request objektu podla mena, ak neexistuje alebo je prazdne vrati defaultValue
	 * @param request
	 * @param name
	 * @param defaultValue
	 * @return
	 */
	public static String getRequestAttribute(HttpServletRequest request, String name, String defaultValue)
	{
<span class="pc bpc" id="L1051" title="4 of 6 branches missed.">		if (request !=null &amp;&amp; request.getAttribute(name)!=null &amp;&amp; Tools.isNotEmpty((String)request.getAttribute(name)))</span>
		{
<span class="nc" id="L1053">			return (String)request.getAttribute(name);</span>
		}
<span class="fc" id="L1055">		return defaultValue;</span>
	}

	/**
	 *  Replace stringu na string
	 *
	 *@param  src     zdrojovy string
	 *@param  oldStr  co sa ma nahradit
	 *@param  newStr  za co sa ma nahradit
	 *@return         string src v ktorom je nahradene oldStr za newStr
	 */
	public static String replace(String src, String oldStr, String newStr)
	{
<span class="fc bfc" id="L1068" title="All 2 branches covered.">		if (src == null)</span>
		{
<span class="fc" id="L1070">			return (null);</span>
		}

		//nemozeme pouzit Tools.isEmpty, pretoze to nam trimne medzery aj crlf a podmienka bude zla
<span class="pc bpc" id="L1074" title="1 of 4 branches missed.">		if (oldStr == null || oldStr.length()==0) return src;</span>

<span class="fc bfc" id="L1076" title="All 2 branches covered.">		if (src.indexOf(oldStr) == -1)</span>
		{
<span class="fc" id="L1078">			return (src);</span>
		}

<span class="fc" id="L1081">		StringBuilder result = new StringBuilder(src.length() + 50);</span>
<span class="fc" id="L1082">		int startIndex = 0;</span>
<span class="fc" id="L1083">		int endIndex = src.indexOf(oldStr);</span>
<span class="fc" id="L1084">		int failsafe = 0;</span>
<span class="pc bpc" id="L1085" title="1 of 4 branches missed.">		while (endIndex != -1 &amp;&amp; failsafe++&lt;2000)</span>
		{
<span class="fc" id="L1087">			result.append(src.substring(startIndex, endIndex));</span>
<span class="fc" id="L1088">			result.append(newStr);</span>
<span class="fc" id="L1089">			startIndex = endIndex + oldStr.length();</span>
<span class="fc" id="L1090">			endIndex = src.indexOf(oldStr, startIndex);</span>
		}
<span class="fc" id="L1092">		result.append(src.substring(startIndex, src.length()));</span>
<span class="fc" id="L1093">		return result.toString();</span>
	}

	/**
	 *  Replace stringu na string
	 *
	 *@param  src     zdrojovy string
	 *@param  oldStr  co sa ma nahradit
	 *@param  newStr  za co sa ma nahradit
	 *@return         string src v ktorom je nahradene oldStr za newStr
	 */
	public static StringBuilder replace(StringBuilder src, String oldStr, String newStr)
	{
<span class="pc bpc" id="L1106" title="1 of 2 branches missed.">		if (src == null)</span>
		{
<span class="nc" id="L1108">			return (null);</span>
		}
<span class="pc bpc" id="L1110" title="1 of 4 branches missed.">		if (src.indexOf(oldStr) == -1 || newStr == null)</span>
		{
<span class="fc" id="L1112">			return (src);</span>
		}
<span class="fc" id="L1114">		int replaceIndex = src.indexOf(oldStr);</span>
<span class="fc" id="L1115">		int failsafe = 0;</span>
<span class="fc bfc" id="L1116" title="All 4 branches covered.">		while (replaceIndex != -1 &amp;&amp; failsafe++&lt;300)</span>
		{
<span class="fc" id="L1118">			src.replace(replaceIndex, replaceIndex+oldStr.length(), newStr);</span>
<span class="fc" id="L1119">			replaceIndex = src.indexOf(oldStr, replaceIndex+newStr.length());</span>
		}

<span class="fc" id="L1122">		return src;</span>
	}

	/**
	 *  Funkcia, ktora zisti pocet vyskytov vstupneho substringu v retazci
	 *
	 *	@author kmarton
	 *
	 *	@param  src     	retazec, v ktorom chceme zistit pocet vyskytov
	 *	@param  subString  co sa ma nahradit
	 *
	 *	@return         	pocet vyskytov substring v src, ak je vstupny string null vrati -1, inak stale pocet vyskytov
	 */
	public static int getNumberSubstring(String src, String subString)
	{
<span class="pc bpc" id="L1137" title="1 of 2 branches missed.">		if (src == null)</span>
<span class="nc" id="L1138">			return (-1);</span>

<span class="pc bpc" id="L1140" title="3 of 6 branches missed.">		if (src.indexOf(subString) == -1 || src.isEmpty() || subString.isEmpty())</span>
<span class="nc" id="L1141">			return (0);</span>

<span class="fc" id="L1143">	   int counter = 0;</span>
<span class="fc" id="L1144">	   Pattern p = Pattern.compile(&quot;\\b&quot; + subString + &quot;\\b&quot;); // co sa ma matchovat, \\b oznacuje hranicu slova, 'medzibankovy' nezapocita, 'iban:' zapocita</span>
<span class="fc" id="L1145">	   Matcher m = p.matcher(src); // v com sa to ma matchovat</span>

<span class="fc bfc" id="L1147" title="All 2 branches covered.">	   while(m.find())</span>
<span class="fc" id="L1148">	   	counter++;</span>

<span class="fc" id="L1150">		return (counter);</span>
	}

	/**
	 * Nahradenie retazca oldStr retazcom newStr bez ohladu na velkost pismen
	 * @param src
	 * @param oldStr
	 * @param newStr
	 * @return
	 */
	public static String replaceIgnoreCase(String src, String oldStr, String newStr)
	{
<span class="pc bpc" id="L1162" title="1 of 2 branches missed.">		if (src == null)</span>
		{
<span class="nc" id="L1164">			return (null);</span>
		}
<span class="fc" id="L1166">		String srcLC = src.toLowerCase();</span>
<span class="fc" id="L1167">		oldStr = oldStr.toLowerCase();</span>
<span class="pc bpc" id="L1168" title="1 of 2 branches missed.">		if (srcLC.indexOf(oldStr) == -1)</span>
		{
<span class="fc" id="L1170">			return (src);</span>
		}
<span class="nc" id="L1172">		StringBuilder result = new StringBuilder(src.length() + 50);</span>
<span class="nc" id="L1173">		int startIndex = 0;</span>
<span class="nc" id="L1174">		int endIndex = srcLC.indexOf(oldStr);</span>
<span class="nc bnc" id="L1175" title="All 2 branches missed.">		while (endIndex != -1)</span>
		{
<span class="nc" id="L1177">			result.append(src.substring(startIndex, endIndex));</span>
<span class="nc" id="L1178">			result.append(newStr);</span>
<span class="nc" id="L1179">			startIndex = endIndex + oldStr.length();</span>
<span class="nc" id="L1180">			endIndex = srcLC.indexOf(oldStr, startIndex);</span>
		}
<span class="nc" id="L1182">		result.append(src.substring(startIndex, src.length()));</span>
<span class="nc" id="L1183">		return result.toString();</span>
	}

	public static String URLEncode(String text) { //NOSONAR
<span class="pc bpc" id="L1187" title="1 of 2 branches missed.">		if (text == null)</span>
<span class="nc" id="L1188">			return (&quot;&quot;);</span>
		try {
<span class="fc" id="L1190">			text = java.net.URLEncoder.encode(text, SetCharacterEncodingFilter.getEncoding());</span>
<span class="fc" id="L1191">			text = sk.iway.iwcm.Tools.replace(text, &quot;+&quot;, &quot;%20&quot;);</span>
<span class="nc" id="L1192">		} catch (UnsupportedEncodingException ex) {</span>
<span class="nc" id="L1193">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L1194">		}</span>
<span class="fc" id="L1195">		return (text);</span>
	}

	public static String URLDecode(String text) { //NOSONAR
		try {
<span class="fc" id="L1200">			text = java.net.URLDecoder.decode(text, SetCharacterEncodingFilter.getEncoding());</span>
<span class="nc" id="L1201">		} catch (UnsupportedEncodingException|IllegalArgumentException ex) {</span>
<span class="nc" id="L1202">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L1203">		}</span>
<span class="fc" id="L1204">		return (text);</span>
	}

	/**
	 * Opravuje moznu chybu HTTP response splitting
	 * http://en.wikipedia.org/wiki/HTTP_response_splitting
	 * @param headerParam
	 * @return
	 */
	public static String sanitizeHttpHeaderParam(String headerParam)
	{
<span class="fc bfc" id="L1215" title="All 2 branches covered.">		if (headerParam == null) return null;</span>
<span class="fc" id="L1216">		headerParam = headerParam.replace('\n', ' ');</span>
<span class="fc" id="L1217">		headerParam = headerParam.replace('\r', ' ');</span>
<span class="fc" id="L1218">		return headerParam;</span>
	}

	/**
	 * Vrati IP adresu vzdialeneho pocitaca, vie spracovat aj poziadavky za proxy
	 * @param request
	 * @return
	 */
	public static String getRemoteIP(HttpServletRequest request)
	{
<span class="fc" id="L1228">		String ip = request.getRemoteAddr();</span>
		//priklad: x-forwarded-for: unknown, 195.168.35.4
<span class="fc" id="L1230">		String xForwardedFor = request.getHeader(&quot;x-forwarded-for&quot;);</span>
<span class="pc bpc" id="L1231" title="2 of 6 branches missed.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; xForwardedFor != null &amp;&amp; xForwardedFor.length()&gt;4)</span>
		{
<span class="pc bpc" id="L1233" title="2 of 4 branches missed.">			if (&quot;unknown&quot;.equals(xForwardedFor)==false &amp;&amp; xForwardedFor.indexOf(&quot;.&quot;)!=-1)</span>
			{
<span class="fc" id="L1235">				String[] values = Tools.getTokens(xForwardedFor, &quot;,&quot;, true);</span>
<span class="pc bpc" id="L1236" title="1 of 2 branches missed.">				for (String value : values)</span>
                {
                    //ak tam nie je bodka, je to asi unknown a to ignorujeme
<span class="pc bpc" id="L1239" title="1 of 2 branches missed.">                    if (value.indexOf(&quot;.&quot;)&lt;1) continue;</span>
                    //bereme prvu hodnotu v poradi
<span class="fc" id="L1241">                    ip = value.trim();</span>
<span class="fc" id="L1242">                    break;</span>
                }
			}
		}

<span class="fc" id="L1247">		return(ip);</span>
	}

	/**
	 * Vrati DNS meno vzdialeneho pocitaca, vie spracovat aj poziadavky za proxy
	 * @param request
	 * @return
	 */
	public static String getRemoteHost(HttpServletRequest request)
	{
<span class="fc" id="L1257">		String ip = getRemoteIP(request);</span>

<span class="pc bpc" id="L1259" title="1 of 2 branches missed.">		if (Constants.getBoolean(&quot;disableReverseDns&quot;)==true) return ip;</span>

<span class="fc" id="L1261">		String host = null;</span>

		try
		{
<span class="fc" id="L1265">			request.getSession().setAttribute(StatDB.REMOTE_IP, ip);</span>
<span class="fc" id="L1266">			host = (String) request.getSession().getAttribute(sk.iway.iwcm.stat.StatDB.REMOTE_HOST);</span>
		}
<span class="fc" id="L1268">		catch (Exception e)</span>
		{
			//uz nie je platna session
<span class="fc" id="L1271">		}</span>

<span class="fc bfc" id="L1273" title="All 2 branches covered.">		if (host == null)</span>
		{
<span class="fc" id="L1275">			host = ip;</span>

			//ip z privatnych rozsahov nepouzijem
<span class="pc bpc" id="L1278" title="2 of 4 branches missed.">			if (ip.startsWith(&quot;192.168.&quot;) || ip.startsWith(&quot;10.&quot;)) return host;</span>

			//skus zdetekovat ci je to IP adresa, alebo meno
			try
			{
<span class="pc bpc" id="L1283" title="1 of 2 branches missed.">				if (host.indexOf(',')!=-1)</span>
				{
<span class="nc" id="L1285">					host = host.substring(0, host.indexOf(',')).trim();</span>
				}
<span class="fc" id="L1287">				String domain = host.substring(host.lastIndexOf('.') + 1);</span>
<span class="fc" id="L1288">				Integer.parseInt(domain);</span>
				//ok je to cislo, inak by sa to zdrbalo
<span class="fc" id="L1290">				host = InetAddress.getByName(ip).getHostName();</span>

<span class="fc" id="L1292">				request.getSession().setAttribute(sk.iway.iwcm.stat.StatDB.REMOTE_HOST, host);</span>
			}
<span class="fc" id="L1294">			catch (Exception ex)</span>
			{

<span class="fc" id="L1297">			}</span>
		}
<span class="fc" id="L1299">		return(host);</span>
	}

	/**
	 * Vrati DNS meno vzdialeneho pocitaca na zaklade IP adresy
	 * @param ip
	 * @return
	 */
	public static String getRemoteHost(String ip)
	{
<span class="fc" id="L1309">		String host = ip;</span>
		try
		{
<span class="fc" id="L1312">			host = InetAddress.getByName(ip).getHostName();</span>
		}
<span class="nc" id="L1314">		catch (Exception e)</span>
		{

<span class="fc" id="L1317">		}</span>
<span class="fc" id="L1318">		return host;</span>
	}

	/**
	 * Vrati true, ak sa jedna o HTTPS pripojenie
	 * @param request
	 * @return
	 */
	public static boolean isSecure(HttpServletRequest request)
	{
		//tu je mozne dorobit ine detekcie, na zaklade nejakej hlavicky (ak SSL nie je riesene Tomcatom)
<span class="fc" id="L1329">		String headerName = Constants.getString(&quot;requestIsSecureHeaderName&quot;);</span>
<span class="pc bpc" id="L1330" title="2 of 4 branches missed.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; Tools.isNotEmpty(headerName))</span>
		{
<span class="fc" id="L1332">			String secureHeaderValue = request.getHeader(headerName);</span>
			//pre rezim kde je priamo http alebo https
<span class="pc bpc" id="L1334" title="1 of 2 branches missed.">			if (&quot;https&quot;.equalsIgnoreCase(secureHeaderValue)) return true;</span>
		}

<span class="fc" id="L1337">		return request.isSecure();</span>
	}

	/**
	 * Ziska hodnotu cookie daneho mena
	 * @param cookies
	 * @param name
	 * @param defaultValue
	 * @return
	 */
	public static String getCookieValue(javax.servlet.http.Cookie[] cookies, String name, String defaultValue)
	{
<span class="fc bfc" id="L1349" title="All 2 branches covered.">		if (cookies == null) return defaultValue;</span>

		int i;
<span class="fc" id="L1352">		int len = cookies.length;</span>
<span class="fc bfc" id="L1353" title="All 2 branches covered.">		for (i=0; i&lt;len; i++)</span>
		{
<span class="fc bfc" id="L1355" title="All 2 branches covered.">			if (name.equals(cookies[i].getName()))</span>
			{
<span class="fc" id="L1357">				return(cookies[i].getValue());</span>
			}
		}
<span class="fc" id="L1360">		return(defaultValue);</span>
	}


	/**
	 * Vrati pole typu String, s jednotlivymi polozkami v retazci, ak sa retazec neda rozdelit, vrati prazdne pole
	 * @param groups 	- retazec, ktory sa ma rozparsovat
	 * @param delimiter
	 * @return
	 */
	public static String[] getTokens(String groups, String delimiter)
	{
<span class="fc" id="L1372">		return(getTokens(groups, delimiter, true));</span>
	}

	/**
	 * Vrati pole typu String, s jednotlivymi polozkami v retazci, ak sa retazec neda rozdelit, vrati prazdne pole
	 * @param groups
	 * @param delimiter
	 * @param doTrim
	 * @return
	 */
	public static String[] getTokens(String groups, String delimiter, boolean doTrim)
	{
<span class="fc" id="L1384">		String[] ret = new String[0];</span>
		StringTokenizer st;
<span class="fc" id="L1386">		int i = 0;</span>
		String s;
		try
		{
<span class="fc bfc" id="L1390" title="All 2 branches covered.">			if (Tools.isNotEmpty(groups))</span>
			{
<span class="fc" id="L1392">				st = new StringTokenizer(groups, delimiter);</span>
<span class="fc" id="L1393">				ret = new String[st.countTokens()];</span>
<span class="fc bfc" id="L1394" title="All 2 branches covered.">				while (st.hasMoreTokens())</span>
				{
<span class="fc" id="L1396">					s = st.nextToken();</span>
<span class="pc bpc" id="L1397" title="1 of 2 branches missed.">					if (doTrim) s = s.trim();</span>
<span class="fc" id="L1398">					ret[i++] = s;</span>
				}
			}
		}
<span class="nc" id="L1402">		catch (Exception e)</span>
		{
<span class="nc" id="L1404">			sk.iway.iwcm.Logger.error(e);</span>
<span class="fc" id="L1405">		}</span>
<span class="fc" id="L1406">		return(ret);</span>

	}

	public String[] split(String groups, String delimiter) {
<span class="nc" id="L1411">		return split(groups, delimiter, true);</span>
	}

	public String[] split(String groups, String delimiter, boolean doTrim) {
<span class="nc" id="L1415">		return getTokens(groups, delimiter, doTrim);</span>
	}

	/**
	 * Vrati pole typu int s jednotlivymi polozkami v retazci
	 * @param groups
	 * @param delimiter
	 * @return
	 */
	public static int[] getTokensInt(String groups, String delimiter)
	{
<span class="fc bfc" id="L1426" title="All 2 branches covered.">		if (Tools.isEmpty(groups)) return new int[0];</span>
<span class="fc" id="L1427">		String[] retStr = getTokens(groups, delimiter, true);</span>
<span class="fc" id="L1428">		int[] retInt = new int[retStr.length];</span>
<span class="fc bfc" id="L1429" title="All 2 branches covered.">		for (int i=0; i&lt;retInt.length; i++)</span>
		{
<span class="fc" id="L1431">			retInt[i] = Tools.getIntValue(retStr[i], 0);</span>

		}
<span class="fc" id="L1434">		return(retInt);</span>

	}

	/**
	 * Vrati pole typu Integer s jednotlivymi polozkami v retazci
	 * @param groups
	 * @param delimiter
	 * @return
	 */
	public static Integer[] getTokensInteger(String groups, String delimiter)
	{
<span class="fc" id="L1446">		int[] ints = getTokensInt(groups, delimiter);</span>

<span class="fc bfc" id="L1448" title="All 2 branches covered.">		if(ints.length &lt; 1) return new Integer[0];</span>

<span class="fc" id="L1450">		return Arrays.stream(ints).boxed().toArray(Integer[]::new);</span>
	}

	/**
	 * Vrati docId stranky, pouzije docDetails v requeste a ked nie je
	 * pouzije docid parameter z requestu
	 * Nutne pouzit ked je nejake remapovanie stranky (cize parameter
	 * je iny ako skutocne zobrazena stranka)
	 * @param request
	 * @return
	 */
	public static int getDocId(HttpServletRequest request)
	{
<span class="fc" id="L1463">		int docId = Tools.getIntValue(request.getParameter(&quot;docid&quot;), -1);</span>
<span class="fc" id="L1464">      DocDetails docDetails = (DocDetails)request.getAttribute(&quot;docDetails&quot;);</span>
<span class="fc bfc" id="L1465" title="All 2 branches covered.">      if (docDetails != null)</span>
      {
      	//Logger.println(Tools.class, &quot;JSP REMAP DOC docId=&quot;+docDetails.getDocId());
<span class="fc" id="L1468">      	docId = docDetails.getDocId();</span>
      }
<span class="fc" id="L1470">      return(docId);</span>
	}

	/**
	 * Ziska hodnotu parametra zo zadaneho URL
	 * @param url
	 * @param paramName
	 * @return
	 */
	public static String getParameterFromUrl(String url, String paramName)
	{
		try
		{
<span class="nc" id="L1483">			int start = url.indexOf(paramName);</span>
<span class="nc" id="L1484">			StringTokenizer st = new StringTokenizer(url.substring(start+paramName.length()+1), &quot; &amp;#&quot;);</span>
<span class="nc bnc" id="L1485" title="All 2 branches missed.">			if (st.hasMoreTokens())</span>
			{
<span class="nc" id="L1487">				return(st.nextToken().trim());</span>
			}
		}
<span class="nc" id="L1490">		catch (Exception ex)</span>
		{
<span class="nc" id="L1492">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="nc" id="L1493">		}</span>
<span class="nc" id="L1494">		return(null);</span>
	}

	/**
	 * Prida parameter k zadanemu URL
	 * @param url
	 * @param paramName
	 * @param paramValue
	 * @return
	 */
	public static String addParameterToUrl(String url, String paramName, String paramValue)
	{
<span class="pc bpc" id="L1506" title="2 of 4 branches missed.">		if(paramName == null || paramValue == null) return url;</span>

<span class="fc" id="L1508">		paramName = Tools.URLEncode(paramName);</span>

<span class="pc bpc" id="L1510" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramName+&quot;=&quot;+Tools.URLEncode(paramValue));</span>

<span class="pc bpc" id="L1512" title="3 of 6 branches missed.">		if (url.indexOf(&quot;?&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;amp;&quot;+paramName+&quot;=&quot;)!=-1)</span>
		{
<span class="nc" id="L1514">			return(url);</span>
		}

<span class="pc bpc" id="L1517" title="1 of 2 branches missed.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1519">			return(url + &quot;?&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
		}
<span class="nc" id="L1521">		return(url + &quot;&amp;amp;&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
	}

	public static String addParameterToUrlNoAmp(String url, String paramName, String paramValue)
	{
<span class="pc bpc" id="L1526" title="2 of 4 branches missed.">		if(paramName == null || paramValue == null) return url;</span>

<span class="fc" id="L1528">		paramName = Tools.URLEncode(paramName);</span>

<span class="pc bpc" id="L1530" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramName+&quot;=&quot;+Tools.URLEncode(paramValue));</span>

<span class="pc bpc" id="L1532" title="3 of 6 branches missed.">		if (url.indexOf(&quot;?&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;&quot;+paramName+&quot;=&quot;)!=-1 || url.indexOf(&quot;&amp;amp;&quot;+paramName+&quot;=&quot;)!=-1)</span>
		{
<span class="nc" id="L1534">			return(url);</span>
		}

<span class="fc bfc" id="L1537" title="All 2 branches covered.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1539">			return(url + &quot;?&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
		}
<span class="fc" id="L1541">		return(url + &quot;&amp;&quot; + paramName + &quot;=&quot; + Tools.URLEncode(paramValue));</span>
	}

	public static String addParametersToUrl(String url, String paramNameValue)
	{
<span class="pc bpc" id="L1546" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramNameValue);</span>

<span class="pc bpc" id="L1548" title="1 of 2 branches missed.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1550">			return(url + &quot;?&quot; + paramNameValue);</span>
		}
<span class="nc" id="L1552">		return(url + &quot;&amp;amp;&quot; + paramNameValue);</span>
	}

	public static String addParametersToUrlNoAmp(String url, String paramNameValue)
	{
<span class="pc bpc" id="L1557" title="1 of 2 branches missed.">		if (url == null) return(&quot;?&quot;+paramNameValue);</span>

<span class="fc bfc" id="L1559" title="All 2 branches covered.">		if (url.indexOf('?')==-1)</span>
		{
<span class="fc" id="L1561">			return(url + &quot;?&quot; + paramNameValue);</span>
		}
<span class="fc" id="L1563">		return(url + &quot;&amp;&quot; + paramNameValue);</span>
	}

	/**
	 * Vrati URL vratane pripadnych parametrov (okrem docid)
	 * @param request
	 * @return
	 */
	public static String getBaseLink(HttpServletRequest request, String[] skipNames)
	{
<span class="fc" id="L1573">		String baseLink = PathFilter.getOrigPath(request);</span>
<span class="fc" id="L1574">		Enumeration&lt;String&gt; parameters = request.getParameterNames();</span>
<span class="fc bfc" id="L1575" title="All 2 branches covered.">		while (parameters.hasMoreElements())</span>
		{
<span class="fc" id="L1577">		   String name = parameters.nextElement();</span>
<span class="pc bpc" id="L1578" title="1 of 2 branches missed.">		   if (&quot;docid&quot;.equals(name)) continue;</span>

<span class="nc" id="L1580">		   boolean skipParam = false;</span>
<span class="nc bnc" id="L1581" title="All 4 branches missed.">		   if (skipNames!=null &amp;&amp; skipNames.length&gt;0)</span>
		   {
<span class="nc bnc" id="L1583" title="All 2 branches missed.">		   	for (int s=0; s&lt;skipNames.length; s++)</span>
		   	{
<span class="nc bnc" id="L1585" title="All 2 branches missed.">		   		if (skipNames[s].equals(name))</span>
		   		{
<span class="nc" id="L1587">		   			skipParam = true;</span>
<span class="nc" id="L1588">		   			break;</span>
		   		}
		   	}
		   }
<span class="nc bnc" id="L1592" title="All 2 branches missed.">		   if (skipParam) continue;</span>

<span class="nc" id="L1594">		   String[] values = request.getParameterValues(name);</span>
<span class="nc bnc" id="L1595" title="All 2 branches missed.">		   for (int i=0; i&lt;values.length; i++)</span>
		   {
<span class="nc" id="L1597">			   String value = org.apache.struts.util.ResponseUtils.filter(values[i]);</span>
<span class="nc" id="L1598">			   baseLink = addParameterToUrl(baseLink, name, value);</span>
		   }
<span class="nc" id="L1600">		}</span>
<span class="fc" id="L1601">		return baseLink;</span>
	}

	/**
	 * Oreze z HTML kodu vsetko za start a pred end, start a end sa tam nebude nachadzat
	 * @param data - HTML kod
	 * @param start - zaciatocny text orezu
	 * @param end - koncovy text orezu
	 * @return
	 */
	public static String getCleanBody(String data, String start, String end)
	{
		//odstran vsetko pred &lt;body&gt; a po &lt;/body&gt;
<span class="nc" id="L1614">		String data_lcase = data.toLowerCase();</span>
<span class="nc" id="L1615">		start = start.toLowerCase();</span>
<span class="nc" id="L1616">		end = end.toLowerCase();</span>
<span class="nc" id="L1617">		int index = data_lcase.indexOf(start);</span>
<span class="nc bnc" id="L1618" title="All 2 branches missed.">		if (index != -1)</span>
		{
<span class="nc bnc" id="L1620" title="All 2 branches missed.">			if (index &gt; 0)</span>
			{
<span class="nc" id="L1622">				int index2 = data_lcase.indexOf(&quot;&gt;&quot;, index + 1);</span>
<span class="nc bnc" id="L1623" title="All 4 branches missed.">				if (index2 &gt; index &amp;&amp; index2 &lt; data_lcase.length())</span>
				{
<span class="nc" id="L1625">					data = data.substring(index2 + 1);</span>
				}
			}

<span class="nc" id="L1629">			index = data.toLowerCase().indexOf(end);</span>
<span class="nc bnc" id="L1630" title="All 2 branches missed.">			if (index &gt; 0)</span>
			{
<span class="nc" id="L1632">				data = data.substring(0, index);</span>
			}
		}
<span class="nc" id="L1635">		return (data);</span>
	}
	/**
	 * vrati String a ak je null tak defaultValue
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static String getStringValue(String value, String defaultValue)
	{
<span class="fc" id="L1645">		String ret = defaultValue;</span>
<span class="fc bfc" id="L1646" title="All 2 branches covered.">		if(value != null) ret = value;</span>
<span class="fc" id="L1647">		return(ret);</span>
	}

	/**
	 * vrati read-only zoznam stringov a ak je null, tak prazdny zoznam
	 *
	 * @param value
	 * @return
	 */
	public static List&lt;String&gt; getStringListValue(String[] value)
	{
<span class="pc bpc" id="L1658" title="1 of 2 branches missed.">		if (value == null) {</span>
<span class="nc" id="L1659">			return Collections.emptyList();</span>
		}
<span class="fc" id="L1661">		return Arrays.asList(value);</span>
	}

	public static void doNotVerifyCertificates()
	{
<span class="fc" id="L1666">		doNotVerifyCertificates(null); //NOSONAR</span>
<span class="fc" id="L1667">	}</span>

	/**
	 * Nastavi neverifikaciu certifikatov pre SSL spojenie
	 */
	@SuppressWarnings({&quot;java:S4830&quot;, &quot;java:S1186&quot;})
	public static SSLContext doNotVerifyCertificates(String host)
	{
<span class="fc" id="L1675">		SSLContext sc = null;</span>
		try
		{
			// Create a trust manager that does not validate certificate chains
<span class="fc" id="L1679">			TrustManager[] trustAllCerts = new TrustManager[]{new X509ExtendedTrustManager()</span>
<span class="fc" id="L1680">			{</span>
				@Override
				public X509Certificate[] getAcceptedIssuers() {
<span class="nc" id="L1683">					return new X509Certificate[]{};</span>
				}

				@Override
				public void checkClientTrusted(X509Certificate[] chain, String authType) {
<span class="nc" id="L1688">				}</span>

				@Override
				public void checkServerTrusted(X509Certificate[] chain, String authType) {
<span class="nc" id="L1692">				}</span>

				@Override
				public void checkClientTrusted(X509Certificate[] chain, String authType, Socket socket) {
<span class="nc" id="L1696">				}</span>

				@Override
				public void checkServerTrusted(X509Certificate[] chain, String authType, Socket socket) {
<span class="fc" id="L1700">				}</span>

				@Override
				public void checkClientTrusted(X509Certificate[] chain, String authType, SSLEngine engine) {
<span class="nc" id="L1704">				}</span>

				@Override
				public void checkServerTrusted(X509Certificate[] chain, String authType, SSLEngine engine) {
<span class="nc" id="L1708">				}</span>
			}};
			// Install the all-trusting trust manager
<span class="fc" id="L1711">			sc = SSLContext.getInstance(&quot;SSL&quot;); //NOSONAR</span>
<span class="fc" id="L1712">			sc.init(null, trustAllCerts, null);</span>
<span class="fc" id="L1713">			HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());</span>

			/**
			 * pri httpS preskakuje kontrolu na verifikaciu hostname s SSL certifikatom
			 * riesenie chyby javax.net.ssl.SSLHandshakeException: No subject alternative DNS name matching 'moja.domena' found.
			 * vynimku je mozne zadat cez konf. premennu httpsDnsNameMatchingExceptions
			 */
<span class="fc" id="L1720">			String httpsDnsNameMatchingExceptions = Constants.getString(&quot;httpsDnsNameMatchingExceptions&quot;);</span>
<span class="pc bpc" id="L1721" title="1 of 2 branches missed.">			if (Tools.isNotEmpty(httpsDnsNameMatchingExceptions))</span>
			{
<span class="nc bnc" id="L1723" title="All 2 branches missed.">				if(Tools.isAnyEmpty(host, httpsDnsNameMatchingExceptions) == false)</span>
				{
<span class="nc" id="L1725">					Logger.debug(Tools.class, &quot;HttpsDnsNameMatchingExceptions: Checking: &quot;+host+&quot; vs &quot;+httpsDnsNameMatchingExceptions);</span>
<span class="nc bnc" id="L1726" title="All 2 branches missed.">					for(String hostException : Tools.getTokens(httpsDnsNameMatchingExceptions, &quot;,&quot;, true))</span>
					{
<span class="nc bnc" id="L1728" title="All 6 branches missed.">						if(hostException != null &amp;&amp; hostException.length() &gt; 2 &amp;&amp; host.endsWith(hostException))</span>
						{
<span class="nc" id="L1730">							HttpsURLConnection.setDefaultHostnameVerifier((s, sslSession) -&gt; true); //NOSONAR</span>
<span class="nc" id="L1731">							break;</span>
						}
					}
				}
			}
		}
<span class="nc" id="L1737">		catch (Exception ex)</span>
		{
<span class="nc" id="L1739">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L1740">		}</span>
<span class="fc" id="L1741">		return sc;</span>
	}

	/**
	 * Vrati kod dna podla cisla dna z kalendara (Calendar.DAY_OF_WEEK), vrati
	 * su, mo, tu, we, th, fr, sa
	 * @param dayOfWeek
	 * @return
	 */
	public static String getDayCode(int dayOfWeek)
	{
<span class="nc bnc" id="L1752" title="All 2 branches missed.">		if (dayOfWeek==Calendar.SUNDAY) return(&quot;su&quot;);</span>
<span class="nc bnc" id="L1753" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.MONDAY) return(&quot;mo&quot;);</span>
<span class="nc bnc" id="L1754" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.TUESDAY) return(&quot;tu&quot;);</span>
<span class="nc bnc" id="L1755" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.WEDNESDAY) return(&quot;we&quot;);</span>
<span class="nc bnc" id="L1756" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.THURSDAY) return(&quot;th&quot;);</span>
<span class="nc bnc" id="L1757" title="All 2 branches missed.">		else if (dayOfWeek==Calendar.FRIDAY) return(&quot;fr&quot;);</span>
<span class="nc" id="L1758">		else return(&quot;sa&quot;);</span>
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param request
	 * @return String
	 */
	public static String insertJQuery(HttpServletRequest request)
	{
<span class="fc" id="L1768">		boolean alreadyInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryInserted&quot;)) );</span>
<span class="fc" id="L1769">		request.setAttribute(&quot;jQueryInserted&quot;, &quot;true&quot;);</span>
<span class="fc bfc" id="L1770" title="All 4 branches covered.">		if (alreadyInserted || &quot;true&quot;.equals(request.getParameter(&quot;isDmail&quot;)))</span>
<span class="fc" id="L1771">			return &quot;&quot;;</span>
		else
		{
<span class="fc" id="L1774">			StringBuilder htmlCode = new StringBuilder();</span>
<span class="pc bpc" id="L1775" title="3 of 4 branches missed.">			if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()) || &quot;iwcm.iway.sk&quot;.equals(request.getServerName())) htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jquery.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
<span class="nc" id="L1776">			else htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jquery.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>

<span class="pc bpc" id="L1778" title="2 of 6 branches missed.">			if (request.getAttribute(&quot;docDetails&quot;)!=null &amp;&amp; request.getAttribute(&quot;pageGroupDetails&quot;)!=null &amp;&amp; request.getAttribute(&quot;commonPageFunctionsInserted&quot;)==null)</span>
			{
<span class="fc" id="L1780">				request.setAttribute(&quot;commonPageFunctionsInserted&quot;, &quot;true&quot;);</span>
<span class="fc" id="L1781">				request.setAttribute(&quot;mailProtection&quot;, true);</span>
<span class="fc" id="L1782">				htmlCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/page_functions.js.jsp?language=&quot;).append(PageLng.getUserLng(request)).append(&quot;\&quot; &gt;&lt;/script&gt;&quot;);</span>
<span class="fc" id="L1783">				htmlCode.append(&quot;&lt;link rel=\&quot;stylesheet\&quot; type=\&quot;text/css\&quot; media=\&quot;screen\&quot; href=\&quot;/components/form/check_form.css\&quot; /&gt; &quot;);</span>
			}

<span class="fc" id="L1786">			return htmlCode.toString();</span>
		}
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param pageContext
	 * @return String
	 */
	public static String insertJQueryUI(PageContext pageContext, String... modules)
	{
<span class="fc" id="L1797">		HttpServletRequest request = (HttpServletRequest)pageContext.getRequest();</span>
<span class="fc" id="L1798">		return insertJQueryUI(request, modules);</span>
	}

	/**
	 * Vlozi jquery javascript alebo ak uz bol vlozeny, tak prazdny String
	 * @param request
	 * @return String
	 */
	public static String insertJQueryUI(HttpServletRequest request, String... modules)
	{
<span class="fc" id="L1808">		StringBuilder returnCode = new StringBuilder(insertJQuery(request));</span>
<span class="fc" id="L1809">		boolean coreInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-core-Inserted&quot;)) );</span>
<span class="fc" id="L1810">		request.setAttribute(&quot;jQueryUI-core-Inserted&quot;, &quot;true&quot;);</span>
<span class="fc bfc" id="L1811" title="All 2 branches covered.">		if(!coreInserted)</span>
		{
<span class="pc bpc" id="L1813" title="1 of 2 branches missed.">			if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()))</span>
<span class="fc" id="L1814">				returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-core.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
			else
<span class="nc" id="L1816">				returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-core.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
		}

<span class="pc bpc" id="L1819" title="1 of 2 branches missed.">		if(modules == null)</span>
<span class="nc" id="L1820">			return returnCode.toString();</span>

<span class="fc bfc" id="L1822" title="All 2 branches covered.">		for (String module : modules)</span>
		{
<span class="fc" id="L1824">			boolean moduleInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-&quot;+module+&quot;-Inserted&quot;)) );</span>
<span class="pc bpc" id="L1825" title="1 of 2 branches missed.">			if (moduleInserted==false)</span>
			{
<span class="fc" id="L1827">				moduleInserted = isNotEmpty( (String)(request.getAttribute(&quot;jQueryUI-all-Inserted&quot;)) );</span>
			}
<span class="fc" id="L1829">			request.setAttribute(&quot;jQueryUI-&quot;+module+&quot;-Inserted&quot;, &quot;true&quot;);</span>
<span class="fc bfc" id="L1830" title="All 2 branches covered.">			if(!moduleInserted)</span>
			{
<span class="pc bpc" id="L1832" title="1 of 2 branches missed.">				if (&quot;iwcm.interway.sk&quot;.equals(request.getServerName()))</span>
<span class="fc" id="L1833">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-&quot;).append(module).append(&quot;.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
				else
<span class="nc" id="L1835">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/jquery-ui-&quot;).append(module).append(&quot;.min.js\&quot; &gt;&lt;/script&gt;&quot;);</span>

<span class="fc bfc" id="L1837" title="All 2 branches covered.">				if(&quot;datepicker&quot;.equals(module))</span>
				{
<span class="fc" id="L1839">					String lng = &quot;&quot;;</span>
<span class="pc bpc" id="L1840" title="1 of 2 branches missed.">					if (request.getAttribute(&quot;PageLng&quot;)!=null)</span>
					{
<span class="fc" id="L1842">						lng = (String)request.getAttribute(&quot;PageLng&quot;);</span>
					}
					else
					{
<span class="nc" id="L1846">						lng = ResponseUtils.filter(request.getParameter(&quot;language&quot;));</span>
<span class="nc bnc" id="L1847" title="All 2 branches missed.">						if (lng != null) request.getSession().setAttribute(Prop.SESSION_I18N_PROP_LNG, lng);</span>
<span class="nc bnc" id="L1848" title="All 2 branches missed.">						if (lng==null)</span>
						{
<span class="nc" id="L1850">							lng = (String)request.getSession().getAttribute(Prop.SESSION_I18N_PROP_LNG);</span>
						}
<span class="nc bnc" id="L1852" title="All 2 branches missed.">						if (lng == null)</span>
						{
<span class="nc" id="L1854">							lng = PageLng.getUserLng(request);</span>
						}
					}
<span class="pc bpc" id="L1857" title="1 of 2 branches missed.">					if(Tools.isEmpty(lng))</span>
<span class="nc" id="L1858">						lng = &quot;sk&quot;;</span>

<span class="fc" id="L1860">					returnCode.append(&quot;&lt;script type=\&quot;text/javascript\&quot; src=\&quot;/components/_common/javascript/jqui/i18n/jqui-datepicker-&quot;).append(lng).append(&quot;.js\&quot; &gt;&lt;/script&gt;&quot;);</span>
				}
			}
		}

<span class="fc" id="L1865">		return returnCode.toString();</span>
	}

	public static String insertAngular2(HttpServletRequest request) {
<span class="nc" id="L1869">		return insertAngular2(request, true, true);</span>
	}

	public static String insertAngular2(HttpServletRequest request, boolean minified, boolean insertBaseHref)
	{
<span class="nc" id="L1874">		boolean alreadyInserted = Tools.getBooleanValue((String) request.getAttribute(&quot;angular2Inserted&quot;), false);</span>
<span class="nc" id="L1875">		request.setAttribute(&quot;angular2Inserted&quot;, &quot;true&quot;);</span>

<span class="nc bnc" id="L1877" title="All 2 branches missed.">		if (!alreadyInserted)</span>
		{
<span class="nc" id="L1879">			StringBuilder htmlCode = new StringBuilder();</span>

<span class="nc bnc" id="L1881" title="All 2 branches missed.">			if (insertBaseHref) {</span>
<span class="nc" id="L1882">				DocDetails docDetails = new RequestHelper(request).getDocument();</span>
<span class="nc bnc" id="L1883" title="All 2 branches missed.">				if (docDetails != null) {</span>
<span class="nc" id="L1884">					htmlCode.append(&quot;&lt;base href=\&quot;&quot;).append(Tools.getBaseHref(request)).append(docDetails.getDocLink()).append(&quot;/\&quot;&gt;&quot;);</span>
				}
			}

<span class="nc" id="L1888">			String version = Constants.getString(&quot;AngularCDNVersion&quot;);</span>

<span class="nc" id="L1890">			htmlCode.append(&quot;&lt;script src=\&quot;https://cdnjs.cloudflare.com/ajax/libs/angular.js/&quot;).append(version).append(&quot;/angular2-polyfills&quot;);</span>

<span class="nc bnc" id="L1892" title="All 2 branches missed.">			if (minified) {</span>
<span class="nc" id="L1893">				htmlCode.append(&quot;.min&quot;);</span>
			}

<span class="nc" id="L1896">			htmlCode.append(&quot;.js\&quot;&gt;&lt;/script&gt;&quot;);</span>

<span class="nc" id="L1898">			return htmlCode.toString();</span>
		}

<span class="nc" id="L1901">		return &quot;&quot;;</span>
	}

	public static String getDomainBaseHref(HttpServletRequest request) {

<span class="fc" id="L1906">		StringBuilder sb = new StringBuilder();</span>

<span class="fc" id="L1908">		sb.append(&quot;http&quot;);</span>

<span class="pc bpc" id="L1910" title="1 of 2 branches missed.">		if (Tools.isSecure(request)) {</span>
<span class="nc" id="L1911">			sb.append(&quot;s&quot;);</span>
		}

<span class="fc" id="L1914">		sb.append(&quot;://&quot;);</span>
<span class="fc" id="L1915">		sb.append(DocDB.getDomain(request));</span>

<span class="fc" id="L1917">		return sb.toString();</span>
	}

	/**
	 * Vrati base HTTP adresu servera, cize nieco ako http://www.interway.sk
	 * vie si poradit aj s portami a umiestnenim za reverzne proxy
	 * @param request
	 * @return
	 */
	public static String getBaseHref(HttpServletRequest request)
	{
<span class="fc" id="L1928">		String httpServerName = Constants.getString(&quot;httpServerName&quot;);</span>

<span class="fc bfc" id="L1930" title="All 2 branches covered.">		if (request == null)</span>
		{
<span class="pc bpc" id="L1932" title="1 of 2 branches missed.">			if (httpServerName.startsWith(&quot;http&quot;)==false) httpServerName = &quot;http://&quot;+httpServerName;</span>

<span class="pc bpc" id="L1934" title="1 of 2 branches missed.">			if (Tools.isEmpty(httpServerName)) {</span>
				//skus vydedukovat podla requestBeanu
<span class="nc" id="L1936">				RequestBean rb = SetCharacterEncodingFilter.getCurrentRequestBean();</span>
<span class="nc bnc" id="L1937" title="All 2 branches missed.">				if (rb!=null) return rb.getBaseHref();</span>
<span class="nc" id="L1938">				return null;</span>
			}

<span class="fc" id="L1941">			StringBuilder baseHref = new StringBuilder(httpServerName);</span>

<span class="pc bpc" id="L1943" title="1 of 2 branches missed.">			if (Constants.getInt(&quot;httpServerPort&quot;) != 80)</span>
			{
<span class="nc" id="L1945">				baseHref.append(':').append(Constants.getInt(&quot;httpServerPort&quot;));</span>
			}

<span class="fc" id="L1948">			return baseHref.toString();</span>
		}

<span class="fc" id="L1951">		StringBuilder baseHref = new StringBuilder();</span>
<span class="pc bpc" id="L1952" title="1 of 2 branches missed.">		if (Tools.isSecure(request)) baseHref.append(&quot;https&quot;);</span>
<span class="fc" id="L1953">		else baseHref.append(&quot;http&quot;);</span>
<span class="fc" id="L1954">		baseHref.append(&quot;://&quot;);</span>

<span class="pc bpc" id="L1956" title="1 of 2 branches missed.">		if (Tools.isNotEmpty(httpServerName))</span>
		{
<span class="nc" id="L1958">			baseHref = new StringBuilder(httpServerName);</span>
		}
<span class="pc bpc" id="L1960" title="2 of 4 branches missed.">		else if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;) &amp;&amp; Tools.isNotEmpty(request.getHeader(&quot;x-forwarded-host&quot;)))</span>
		{
<span class="nc" id="L1962">			baseHref.append(request.getHeader(&quot;x-forwarded-host&quot;));</span>
		}
		else
		{
<span class="fc" id="L1966">			baseHref.append(Tools.getServerName(request, false));</span>
		}

<span class="pc bpc" id="L1969" title="1 of 2 branches missed.">        if (Constants.getInt(&quot;httpServerPort&quot;) == -1)</span>
        {
            //ak je httpServerPort nastavene na -1 pridame do URL priamo jeho hodnotu (pouziva sa, ked server bezi na viacerych portoch a nie je maskovany navonok)
<span class="nc bnc" id="L1972" title="All 4 branches missed.">            if (request.getServerPort()!=80 &amp;&amp; request.getServerPort()!=443)</span>
            {
<span class="nc" id="L1974">                baseHref.append(':').append(request.getServerPort());</span>
            }
        }
<span class="pc bpc" id="L1977" title="1 of 2 branches missed.">		else if (Constants.getInt(&quot;httpServerPort&quot;) != 80)</span>
		{
<span class="nc" id="L1979">			baseHref.append(':').append(Constants.getInt(&quot;httpServerPort&quot;));</span>
		}

<span class="pc bpc" id="L1982" title="1 of 2 branches missed.">		if (Tools.isEmpty(httpServerName))</span>
		{
<span class="pc bpc" id="L1984" title="3 of 4 branches missed.">			if (Tools.isNotEmpty(request.getContextPath()) &amp;&amp; request.getContextPath().equals(&quot;/&quot;)==false)</span>
			{
<span class="nc" id="L1986">				baseHref.append(request.getContextPath());</span>
			}
		}

<span class="fc" id="L1990">		return baseHref.toString();</span>
	}

	/**
	 * Vrati base HTTP adresu servera pre loopback HTTP spojenie, cize nieco ako http://localhost:8080/
	 * @param request
	 * @return
	 */
	public static String getBaseHrefLoopback(HttpServletRequest request)
	{
<span class="fc" id="L2000">		String baseHref = Constants.getString(&quot;baseHrefLoopback&quot;);</span>
<span class="pc bpc" id="L2001" title="1 of 2 branches missed.">		if (Tools.isEmpty(baseHref)) baseHref = getBaseHref(request);</span>
<span class="nc" id="L2002">		else baseHref = Tools.replace(baseHref, &quot;SERVER_NAME&quot;, Tools.getServerName(request));</span>

<span class="fc" id="L2004">		return baseHref;</span>
	}

	public static boolean isInteger(String possibleNumber)
	{
<span class="fc bfc" id="L2009" title="All 2 branches covered.">		if (possibleNumber == null)</span>
<span class="fc" id="L2010">			return false;</span>
<span class="fc" id="L2011">		return possibleNumber.trim().matches(&quot;^-?[0-9]+$&quot;); //NOSONAR</span>
	}

	/**
	 * Vrati Calendar z rodneho cisla. Tento Calendar
	 * obsahuje vek cloveka s tymto rodnych cislom.
	 *
	 * pocet rokov si potom zistime jednoduchym zavolanim:
	 * 	extractFromAge(rodneCislo).get(Calendar.YEAR)
	 *
	 * Pri priestupnych rokoch ma odchylku +- jeden den.
	 *
	 * @param birthId - rodne cislo
	 * @return {@link Calendar}
	 */
	public static Calendar extractAgeFrom(String birthId)
	{
<span class="nc bnc" id="L2028" title="All 4 branches missed.">		if (birthId == null || birthId.length() &lt; 6)</span>
<span class="nc" id="L2029">			throw new IllegalArgumentException(&quot;Neplatne rodne cislo: &quot;+birthId);</span>
<span class="nc" id="L2030">		Calendar now = Calendar.getInstance();</span>
		//calendar pocita mesiace od 0, ale rodne cislo od 1
<span class="nc" id="L2032">		now.add(Calendar.MONTH, 1);</span>
		//pretekajuci kalendar...
<span class="nc" id="L2034">		now.setLenient(true);</span>
		//zistime a odpocitame roky
<span class="nc bnc" id="L2036" title="All 2 branches missed.">		int birthYear = Integer.parseInt(birthId.substring(0,2)) &gt; (now.get(Calendar.YEAR) - 2000) ?</span>
<span class="nc" id="L2037">					Integer.parseInt(birthId.substring(0,2)) + 1900 :</span>
<span class="nc" id="L2038">					Integer.parseInt(birthId.substring(0,2)) + 2000;</span>
<span class="nc" id="L2039">		now.add(Calendar.YEAR, -birthYear );</span>
		//to iste s mesiacmi a dnami
<span class="nc bnc" id="L2041" title="All 2 branches missed.">		int birthMonth = Integer.parseInt(birthId.substring(2,4)) &gt; 50 ?</span>
<span class="nc" id="L2042">					Integer.parseInt(birthId.substring(2,4)) - 50:</span>
<span class="nc" id="L2043">					Integer.parseInt(birthId.substring(2,4));</span>
<span class="nc" id="L2044">		now.add(Calendar.MONTH,-birthMonth);</span>
<span class="nc" id="L2045">		now.add(Calendar.DAY_OF_MONTH, - Integer.parseInt(birthId.substring(4,6)));</span>
<span class="nc" id="L2046">		return now;</span>
	}

	/**
	 * Vracia id prihlaseneho pouzivatela. Identicka metoda je aj v {@link BasketDB},
	 * kde nema co robit
	 *
	 * @param request
	 * @return {@link Integer} userId
	 */
	public static int getUserId(HttpServletRequest request)
	{
<span class="fc" id="L2058">		int userId = -1;</span>
<span class="fc" id="L2059">		Identity user = UsersDB.getCurrentUser(request);</span>
<span class="fc bfc" id="L2060" title="All 2 branches covered.">		if (user != null) userId = user.getUserId();</span>
<span class="fc" id="L2061">		return(userId);</span>
	}

	/**
	 * Otestuje, ci pole arrOne obsahuje aspon jeden prvok z pola arrTwo
	 * @param arrOne
	 * @param arrTwo
	 * @return
	 */
	public static boolean containsOneItem(int[] arrOne, int[] arrTwo)
	{
<span class="nc bnc" id="L2072" title="All 8 branches missed.">		if (arrOne==null || arrOne.length==0 || arrTwo==null || arrTwo.length==0) return false;</span>

<span class="nc bnc" id="L2074" title="All 2 branches missed.">		for (int one : arrOne)</span>
		{
<span class="nc bnc" id="L2076" title="All 2 branches missed.">			for (int two : arrTwo)</span>
			{
<span class="nc bnc" id="L2078" title="All 2 branches missed.">				if (one == two) return true;</span>
			}
		}
<span class="nc" id="L2081">		return false;</span>
	}

	/**
	 * Otestuje, ci pole arrOne obsahuje two
	 * @param arrOne
	 * @param arrTwo
	 * @return
	 */
	public static boolean containsOneItem(int[] arrOne, int two)
    {
<span class="pc bpc" id="L2092" title="1 of 4 branches missed.">        if (arrOne==null || arrOne.length==0) return false;</span>

<span class="fc bfc" id="L2094" title="All 2 branches covered.">        for (int one : arrOne)</span>
        {
<span class="fc bfc" id="L2096" title="All 2 branches covered.">           if (one==two) return true;</span>
        }
<span class="fc" id="L2098">        return false;</span>
    }

	/**
	 * Otestuje, ci pole arrOne obsahuje aspon jeden prvok z pola arrTwo
	 * @param arrOne
	 * @param arrTwo
	 * @return
	 */
	public static boolean containsOneItem(String[] arrOne, String[] arrTwo)
	{
<span class="nc bnc" id="L2109" title="All 8 branches missed.">		if (arrOne==null || arrOne.length==0 || arrTwo==null || arrTwo.length==0) return false;</span>

<span class="nc bnc" id="L2111" title="All 2 branches missed.">		for (String one : arrOne)</span>
		{
<span class="nc bnc" id="L2113" title="All 2 branches missed.">			for (String two : arrTwo)</span>
			{
<span class="nc bnc" id="L2115" title="All 2 branches missed.">				if (one.equals(two)) return true;</span>
			}
		}
<span class="nc" id="L2118">		return false;</span>
	}

    /**
     * Otestuje, ci pole arrOne obsahuje two
     * @param arrOne
     * @param two
     * @return
     */
    public static boolean containsOneItem(String[] arrOne, String two)
    {
<span class="pc bpc" id="L2129" title="3 of 6 branches missed.">        if (arrOne==null || arrOne.length==0 || two==null) return false;</span>

<span class="fc bfc" id="L2131" title="All 2 branches covered.">        for (String one : arrOne)</span>
        {
<span class="fc bfc" id="L2133" title="All 2 branches covered.">           if (one.equals(two)) return true;</span>
        }
<span class="fc" id="L2135">        return false;</span>
    }

	/**
	 * Vrati, ci je rozdiel medzi dvomi double cislami mensi ako zadana odchylka
	 */
	public static boolean doubleEquals(double firstNumber,double secondNumber,double eps)
	{
<span class="nc bnc" id="L2143" title="All 2 branches missed.">		return Math.abs( firstNumber - secondNumber ) &lt; eps;</span>
	}

	/**
	 * Vrati, ci sa dve cisla rovnaju v signifikantnych bitoch -
	 * reprezentacia dvoch cisiel v JVM v double formate sa moze lisit
	 * na poslednych 8 bitoch - preto == nemusi fungovat.
	 * Skuste System.out.println((1.0d / 49)*49)
	 */
	public static boolean doubleEquals(double firstNumber,double secondNumber)
	{
<span class="nc" id="L2154">		return doubleEquals(firstNumber, secondNumber,1e-7);</span>
	}

	public static boolean isAnyNotEmpty(String... values)
	{
<span class="nc bnc" id="L2159" title="All 2 branches missed.">		for (String value : values)</span>
<span class="nc bnc" id="L2160" title="All 2 branches missed.">			if (isNotEmpty(value))</span>
<span class="nc" id="L2161">				return true;</span>
<span class="nc" id="L2162">		return false;</span>
	}


	public static boolean isAnyEmpty(String... values)
	{
<span class="fc bfc" id="L2168" title="All 2 branches covered.">		for (String value : values)</span>
<span class="fc bfc" id="L2169" title="All 2 branches covered.">			if (isEmpty(value))</span>
<span class="fc" id="L2170">				return true;</span>
<span class="fc" id="L2171">		return false;</span>
	}

	public static boolean areNotEmpty(String... values)
	{
<span class="nc bnc" id="L2176" title="All 2 branches missed.">		return !isAnyEmpty(values);</span>
	}

	/**
	 * Vrati novy zoznam, ktory pozostava z prvkov povodneho zoznamu,
	 * ktore splnaju zadanu podmienku.
	 */
	public static &lt;T&gt; List&lt;T&gt; filter( List&lt;? extends T&gt; originalList,SelectionFilter&lt;? super T&gt; filter)
	{
<span class="nc" id="L2185">		List&lt;T&gt; list = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L2186" title="All 2 branches missed.">		for (T element : originalList)</span>
<span class="nc bnc" id="L2187" title="All 2 branches missed.">			if (filter.fullfilsConditions(element))</span>
<span class="nc" id="L2188">				list.add(element);</span>
<span class="nc" id="L2189">		return list;</span>
	}

	/**
	 * Vrati serverName z poziadavky aj ked je za proxy.
	 *
	 * @param request
	 * @return
	 */
	public static String getServerName(HttpServletRequest request)
	{
<span class="fc" id="L2200">		return getServerName(request, true);</span>
	}

	/**
	 * Vrati server name aj ked je za proxy
	 * @param request
	 * @param useAlias - ak je true robi sa aj serverAlias, false treba len pri tvorbe presmerovani
	 * @return
	 */
	public static String getServerName(HttpServletRequest request, boolean useAlias)
	{
<span class="fc bfc" id="L2211" title="All 2 branches covered.">		if (request == null) return null;</span>

<span class="fc" id="L2213">		String serverName = request.getServerName();</span>
<span class="fc bfc" id="L2214" title="All 2 branches covered.">		if (Constants.getBoolean(&quot;serverBeyoundProxy&quot;))</span>
        {
<span class="fc" id="L2216">			String forwardHost = Tools.sanitizeHttpHeaderParam(request.getHeader(&quot;x-forwarded-host&quot;));</span>
<span class="fc bfc" id="L2217" title="All 2 branches covered.">			if (Tools.isNotEmpty(forwardHost))</span>
			{
<span class="pc bpc" id="L2219" title="4 of 8 branches missed.">				if (forwardHost.contains(&quot;&lt;&quot;)==false &amp;&amp; forwardHost.contains(&quot;&gt;&quot;)==false &amp;&amp; forwardHost.contains(&quot;\&quot;&quot;)==false &amp;&amp; forwardHost.contains(&quot;'&quot;)==false)</span>
				{
<span class="fc" id="L2221">					serverName = forwardHost;</span>
				}
			}
        }

		//sometimes serverName is send with :port at the end by some k8s proxy, remove it
<span class="fc" id="L2227">		int index = serverName.indexOf(':');</span>
<span class="fc bfc" id="L2228" title="All 2 branches covered.">		if (index &gt; 0) serverName = serverName.substring(0, index);</span>

<span class="fc bfc" id="L2230" title="All 2 branches covered.">		if (useAlias)</span>
		{
<span class="fc" id="L2232">			String domainName = DomainRedirectDB.getDomainFromAlias(serverName);</span>
<span class="pc bpc" id="L2233" title="1 of 2 branches missed.">			if (Tools.isNotEmpty(domainName)) serverName = domainName;</span>
		}

<span class="fc" id="L2236">		return (serverName);</span>
	}

	/**
	 * Vracia cely String, ktory pouzivatel uvidi v adresnej liste v prehliadaci,
	 * URL + queryString
	 *
	 * nieco ako:
	 * http://www.google.sk/search?q=something&amp;ie=utf-8&amp;oe=utf-8&amp;aq=t&amp;rls=org.mozilla:sk:official&amp;client=firefox-a
	 */
	public static String getRequestedLink(HttpServletRequest request)
	{
<span class="nc" id="L2248">		StringBuilder link = new StringBuilder();</span>
<span class="nc bnc" id="L2249" title="All 2 branches missed.">		link.append( Tools.isSecure(request) ? &quot;https&quot; : &quot;http&quot; );</span>
<span class="nc" id="L2250">		link.append(&quot;://&quot;);</span>
<span class="nc" id="L2251">		link.append(Tools.getServerName(request));</span>
<span class="nc" id="L2252">		String path = PathFilter.getOrigPath(request);</span>
<span class="nc bnc" id="L2253" title="All 2 branches missed.">		if (path == null) path = request.getRequestURI();</span>
<span class="nc" id="L2254">		link.append(path);</span>
<span class="nc bnc" id="L2255" title="All 2 branches missed.">		if (Tools.isNotEmpty(request.getQueryString()))</span>
		{
<span class="nc" id="L2257">			link.append('?');</span>
<span class="nc" id="L2258">			link.append(request.getQueryString());</span>
		}
<span class="nc" id="L2260">		return link.toString();</span>
	}

	public static String getRealPath(String virtualPathParam) {
<span class="fc" id="L2264">		String virtualPath = virtualPathParam;</span>

		// JDK 8 + Tomcat 8 nezvladaju url cast v ceste k suboru
<span class="fc bfc" id="L2267" title="All 2 branches covered.">		if (Tools.isNotEmpty(virtualPath)) {</span>
<span class="fc" id="L2268">			int index = virtualPath.indexOf(&quot;?&quot;);</span>
<span class="fc bfc" id="L2269" title="All 2 branches covered.">			if (index &gt; 0) {</span>
<span class="fc" id="L2270">				virtualPath = virtualPath.substring(0, index);</span>
			}

<span class="fc bfc" id="L2273" title="All 2 branches covered.">			if (virtualPath.contains(&quot;:&quot;)) {</span>
<span class="fc" id="L2274">				virtualPath = Tools.replace(virtualPath, &quot;:&quot;, &quot;-&quot;);</span>
			}

<span class="fc bfc" id="L2277" title="All 2 branches covered.">			if (virtualPath.contains(&quot;*&quot;)) {</span>
<span class="fc" id="L2278">				virtualPath = Tools.replace(virtualPath, &quot;*&quot;, &quot;&quot;);</span>
			}

<span class="fc" id="L2281">			virtualPath = virtualPath.trim();</span>

<span class="pc bpc" id="L2283" title="1 of 2 branches missed.">			if (virtualPath.contains(&quot;%&quot;)) {</span>
<span class="nc" id="L2284">				virtualPath = Tools.URLDecode(virtualPath);</span>
			}
		}
<span class="fc bfc" id="L2287" title="All 2 branches covered.">		if (virtualPath.startsWith(&quot;/&quot;) == false)</span>
<span class="fc" id="L2288">			virtualPath = &quot;/&quot; + virtualPath; // NOSONAR</span>

		// pre cloud WebJET posielame inu cestu k suborom
<span class="fc bfc" id="L2291" title="All 2 branches covered.">		if (FilePathTools.isExternalDir(virtualPath)) {</span>
			File file;
<span class="pc bpc" id="L2293" title="1 of 2 branches missed.">			if (virtualPath.startsWith(&quot;/shared&quot;)</span>
<span class="pc bpc" id="L2294" title="1 of 2 branches missed.">					|| virtualPath.startsWith(Constants.getString(&quot;thumbServletCacheDir&quot;) + &quot;shared&quot;)) {</span>
				// ziskaj cestu pre akoby shared domenu
<span class="nc" id="L2296">				file = new File(FilePathTools.getDomainBaseFolder(&quot;shared&quot;), virtualPath);</span>
<span class="nc bnc" id="L2297" title="All 4 branches missed.">				if (virtualPath.equals(&quot;/shared&quot;) || virtualPath.equals(&quot;/shared/&quot;)) {</span>
					try {
						// vytvor hlavnu strukturu pre shared adresar na sietovom disku, domenove sa
						// robia automaticky, toto je komplikovanejsie
<span class="nc bnc" id="L2301" title="All 2 branches missed.">						if (file.exists() == false)</span>
<span class="nc" id="L2302">							file.mkdirs();</span>
<span class="nc" id="L2303">					} catch (Exception ex) {</span>
<span class="nc" id="L2304">					}</span>
				}
			} else {
<span class="fc" id="L2307">				file = new File(FilePathTools.getDomainBaseFolder(), virtualPath);</span>
			}
			// Logger.debug(Tools.class, &quot;getRealPath, return=&quot;+file.getAbsolutePath()+&quot;
			// virtualPath=&quot;+virtualPath);

<span class="fc" id="L2312">			String path = file.getAbsolutePath();</span>
<span class="pc bpc" id="L2313" title="3 of 4 branches missed.">			if (virtualPath.endsWith(&quot;/&quot;) &amp;&amp; path.endsWith(File.separator) == false)</span>
<span class="nc" id="L2314">				path += File.separator;</span>
<span class="fc" id="L2315">			return (path);</span>
		}

		// String path = Constants.getServletContext().getRealPath(virtualPath);
<span class="fc" id="L2319">		String path = null;</span>
		try {
			// kvoli Tomcat 8.5 a symlinkam to potrebujeme takto
<span class="fc" id="L2322">			File f = new File(Constants.getServletContext().getRealPath(&quot;/&quot;));</span>
			// to musi ist CanonicalPath aby nam nevracalo
			// /www/tomcat_au2/webapps2/../webapps/iway_2016
<span class="fc" id="L2325">			String rootPath = f.getCanonicalPath();</span>
<span class="pc bpc" id="L2326" title="1 of 4 branches missed.">			if (Tools.isEmpty(virtualPath) || &quot;/&quot;.equals(virtualPath))</span>
<span class="fc" id="L2327">				path = rootPath;</span>
			else {
				// pridavame cestu k root adresaru, to nema zacinat na lomitko
<span class="fc" id="L2330">				String addPath = Tools.replace(virtualPath, &quot;/&quot;, &quot;&quot; + File.separatorChar).substring(1);</span>
<span class="fc" id="L2331">				f = new File(rootPath, addPath);</span>
				// tu musi ist getAbsolutePath aby neprelozilo symlink
<span class="fc" id="L2333">				path = f.getAbsolutePath();</span>
			}
<span class="nc" id="L2335">		} catch (Exception ex) {</span>
<span class="nc" id="L2336">			sk.iway.iwcm.Logger.error(ex);</span>
<span class="fc" id="L2337">		}</span>

<span class="pc bpc" id="L2339" title="1 of 2 branches missed.">		if (path == null) {</span>
<span class="nc" id="L2340">			path = Constants.getServletContext().getRealPath(&quot;/&quot;) + Tools.replace(virtualPath, &quot;/&quot;, &quot;&quot; + File.separatorChar);</span>
<span class="nc" id="L2341">			path = Tools.replace(path, &quot;&quot; + File.separatorChar + File.separatorChar, &quot;&quot; + File.separatorChar);</span>
		}

		// podpora /admin/generate.jsp kde sa volaju subory z ../support/generators
		// adresara
<span class="pc bpc" id="L2346" title="3 of 4 branches missed.">		if (Tools.isNotEmpty(PathFilter.getCustomPath()) &amp;&amp; virtualPath.startsWith(&quot;..&quot;)</span>
<span class="nc bnc" id="L2347" title="All 2 branches missed.">				&amp;&amp; virtualPath.indexOf(&quot;/WebContent/&quot;) == -1) {</span>
<span class="nc" id="L2348">			String myPath = Constants.getServletContext().getRealPath(&quot;/&quot;) + &quot;/&quot; + virtualPath; // NOSONAR</span>
<span class="nc bnc" id="L2349" title="All 2 branches missed.">			if (myPath.indexOf(&quot;/WebContent/..&quot;) != -1) {</span>
<span class="nc" id="L2350">				path = Tools.replace(myPath, &quot;/WebContent/..&quot;, &quot;&quot;);</span>
			}
		}

		// JDK9 + Tomcat 8 - root path by mala koncit lomitkom (tak to bolo doteraz)
<span class="pc bpc" id="L2355" title="1 of 4 branches missed.">		if (&quot;/&quot;.equals(virtualPath) &amp;&amp; path.endsWith(File.separator) == false)</span>
<span class="fc" id="L2356">			path = path + File.separator;</span>

<span class="pc bpc" id="L2358" title="1 of 2 branches missed.">		if (path.contains(&quot;..&quot;))</span>
<span class="nc" id="L2359">			path = Tools.replace(path, &quot;/webapps2/../webapps/&quot;, &quot;/webapps/&quot;);</span>

<span class="fc" id="L2361">		path = FileTools.symlinkReplaceToRootPath(path);</span>

		//add last slash if it's on virutal path (to directly combine with file name)
<span class="fc bfc" id="L2364" title="All 4 branches covered.">		if (virtualPath.endsWith(&quot;/&quot;) &amp;&amp; path.endsWith(File.separator) == false) path += File.separator;</span>

<span class="fc" id="L2366">		return path;</span>
	}

	/**
	 *  capitalize(&quot;nieco Nieco nIeCo&quot;) =&gt; &quot;Nieco Nieco Nieco&quot;
	 */
	public static String capitalize(String source)
	{
<span class="nc bnc" id="L2374" title="All 2 branches missed.">		if (isEmpty(source))</span>
<span class="nc" id="L2375">			return source;</span>

<span class="nc" id="L2377">		Matcher matcher = Pattern.compile(&quot;(\\b)(.)(.*?)(\\b)&quot;).matcher(source); //NOSONAR</span>

<span class="nc bnc" id="L2379" title="All 2 branches missed.">		while (matcher.find())</span>
		{
<span class="nc" id="L2381">			String whole = matcher.group(0);</span>
<span class="nc" id="L2382">			String spaceBefore = matcher.group(1);</span>
<span class="nc" id="L2383">			String firstLetter = matcher.group(2).toUpperCase();</span>
<span class="nc" id="L2384">			String remainder = matcher.group(3).toLowerCase();</span>
<span class="nc" id="L2385">			String spaceAfter = matcher.group(4);</span>
<span class="nc" id="L2386">			source = source.replace(whole, spaceBefore+firstLetter+remainder+spaceAfter);</span>
<span class="nc" id="L2387">		}</span>

<span class="nc" id="L2389">		return source;</span>
	}

	/**
	 * Funkcia vrati objekt typu Date zo vstupneho retazca dateString na zaklade formatu uvedeneho v parametri formatString.
	 * Napr. Tools.getDateFromString(&quot;20091231 235959&quot;, &quot;yyyyMMdd HHmmss&quot;) vrati objekt Date s nastavenymi hodnotami ako 31.12.2009 23:59:59
    *
	 * @author kmarton
	 *
	 * @param dateString		vstupny retazec, z ktoreho chceme ziskat objekt Date, napr. &quot;20091231 235959&quot;
	 * @param formatString	formatovaci retazec, podla ktoreho sa bude formatovat vstupny retazec dateString, napr. &quot;yyyyMMdd HHmmss&quot;
	 *
	 * @return vrati objekt typu Date s nastavenymi hodnotami podla vstupnych parametrov, ak sa vyskytne nejaka parsovacia chyba, vrati null
	 */
	public static Date getDateFromString(String dateString, String formatString)
	{
<span class="fc" id="L2405">		Date date = null;</span>
   	try
   	{
<span class="fc" id="L2408">   		DateFormat formatter = new SimpleDateFormat(formatString);</span>
<span class="fc" id="L2409">   		date = formatter.parse(dateString);</span>
   	}
<span class="nc" id="L2411">   	catch (ParseException e)</span>
   	{
<span class="nc" id="L2413">   		sk.iway.iwcm.Logger.error(e);</span>
<span class="fc" id="L2414">   	}</span>

<span class="fc" id="L2416">   	return date;</span>

	}

	/**
	 * Funkcia vrati lokalizovane meno mesiaca z properties, pouzitim pozadovaneho jazyka
	 * @param month - cislo mesiaca v konvencii triedy &lt;code&gt;Calendar&lt;/code&gt; (tj. januar = 0, februar = 1 ... december = 11)
	 * @param lng - pozadovany jazyk, ak je &lt;code&gt;null&lt;/code&gt;, pouzije sa defaultLanguage z Constants
	 * @return - lokalizovany nazov mesiaca
	 */
	public static String getMonthNameLocalized(int month, String lng)
	{
<span class="nc" id="L2428">		String localizedMonth = &quot;&quot;;</span>
		Prop prop;
<span class="nc bnc" id="L2430" title="All 2 branches missed.">		if(lng == null)</span>
<span class="nc" id="L2431">			prop = Prop.getInstance();</span>
		else
<span class="nc" id="L2433">			prop = Prop.getInstance(lng);</span>
<span class="nc bnc" id="L2434" title="All 13 branches missed.">		switch(month) //NOSONAR</span>
		{
<span class="nc" id="L2436">			case 0: localizedMonth = prop.getText(&quot;component.calendar.january&quot;);break;</span>
<span class="nc" id="L2437">			case 1: localizedMonth = prop.getText(&quot;component.calendar.february&quot;);break;</span>
<span class="nc" id="L2438">			case 2: localizedMonth = prop.getText(&quot;component.calendar.march&quot;);break;</span>
<span class="nc" id="L2439">			case 3: localizedMonth = prop.getText(&quot;component.calendar.april&quot;);break;</span>
<span class="nc" id="L2440">			case 4: localizedMonth = prop.getText(&quot;component.calendar.may&quot;);break;</span>
<span class="nc" id="L2441">			case 5: localizedMonth = prop.getText(&quot;component.calendar.june&quot;);break;</span>
<span class="nc" id="L2442">			case 6: localizedMonth = prop.getText(&quot;component.calendar.july&quot;);break;</span>
<span class="nc" id="L2443">			case 7: localizedMonth = prop.getText(&quot;component.calendar.august&quot;);break;</span>
<span class="nc" id="L2444">			case 8: localizedMonth = prop.getText(&quot;component.calendar.september&quot;);break;</span>
<span class="nc" id="L2445">			case 9: localizedMonth = prop.getText(&quot;component.calendar.october&quot;);break;</span>
<span class="nc" id="L2446">			case 10: localizedMonth = prop.getText(&quot;component.calendar.november&quot;);break;</span>
<span class="nc" id="L2447">			case 11: localizedMonth = prop.getText(&quot;component.calendar.december&quot;);break;</span>
		}
<span class="nc" id="L2449">		return localizedMonth;</span>
	}

	/**
	 * Funkcia vrati lokalizovane meno mesiaca z properties, pouzitim predvoleneho jazyka (parameter defaultLanguage z Constants)
	 * @param month - cislo mesiaca v konvencii triedy &lt;code&gt;Calendar&lt;/code&gt; (tj. januar = 0, februar = 1 ... december = 11)
	 * @return - lokalizovany nazov mesiaca
	 */
	public static String getMonthNameLocalized(int month)
	{
<span class="nc" id="L2459">		return getMonthNameLocalized(month, null);</span>
	}

		// This method returns a buffered image with the contents of an image
	public static BufferedImage toBufferedImage(Image image) {
<span class="nc bnc" id="L2464" title="All 2 branches missed.">	    if (image instanceof BufferedImage) {</span>
<span class="nc" id="L2465">	        return (BufferedImage)image;</span>
	    }

	    // This code ensures that all the pixels in the image are loaded
<span class="nc" id="L2469">	    image = new ImageIcon(image).getImage();</span>

	    // Determine if the image has transparent pixels; for this method's
	    // implementation, see Determining If an Image Has Transparent Pixels
	    //boolean hasAlpha = hasAlpha(image);

	    // Create a buffered image with a format that's compatible with the screen
<span class="nc" id="L2476">	    BufferedImage bimage = null;</span>
<span class="nc" id="L2477">	    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();</span>
	    try {
	        // Determine the type of transparency of the new buffered image
<span class="nc" id="L2480">	        int transparency = Transparency.OPAQUE;</span>
//	        if (hasAlpha) {
//	            transparency = Transparency.BITMASK;
//	        }

	        // Create the buffered image
<span class="nc" id="L2486">	        GraphicsDevice gs = ge.getDefaultScreenDevice();</span>
<span class="nc" id="L2487">	        GraphicsConfiguration gc = gs.getDefaultConfiguration();</span>
<span class="nc" id="L2488">	        bimage = gc.createCompatibleImage(</span>
<span class="nc" id="L2489">	            image.getWidth(null), image.getHeight(null), transparency);</span>
<span class="nc" id="L2490">	    } catch (HeadlessException e) {</span>
	        // The system does not have a screen
<span class="nc" id="L2492">	    }</span>

<span class="nc bnc" id="L2494" title="All 2 branches missed.">	    if (bimage == null) {</span>
	        // Create a buffered image using the default color model
<span class="nc" id="L2496">	        int type = BufferedImage.TYPE_INT_RGB;</span>
//	        if (hasAlpha) {
//	            type = BufferedImage.TYPE_INT_ARGB;
//	        }
<span class="nc" id="L2500">	        bimage = new BufferedImage(image.getWidth(null), image.getHeight(null), type);</span>
	    }

	    // Copy image to buffered image
<span class="nc" id="L2504">	    Graphics g = bimage.createGraphics();</span>

	    // Paint the image onto the buffered image
<span class="nc" id="L2507">	    g.drawImage(image, 0, 0, null);</span>
<span class="nc" id="L2508">	    g.dispose();</span>

<span class="nc" id="L2510">	    return bimage;</span>
	}

	@SuppressWarnings(&quot;unchecked&quot;)
	public static &lt;T&gt; T firstNonNull(T...possibilities)
	{
<span class="nc bnc" id="L2516" title="All 2 branches missed.">		if (possibilities.length == 0)</span>
<span class="nc" id="L2517">			return null;</span>
<span class="nc" id="L2518">		T lastOne = possibilities[possibilities.length - 1];</span>
<span class="nc bnc" id="L2519" title="All 2 branches missed.">		for (T t : possibilities)</span>
<span class="nc bnc" id="L2520" title="All 2 branches missed.">			if (t != null)</span>
<span class="nc" id="L2521">				return t;</span>

<span class="nc" id="L2523">		return lastOne;</span>
	}

	/**
	 * Ziskanie hodnoty ako boolean
	 * @param value
	 * @param defaultValue
	 * @return
	 */
	public static boolean getBooleanValue(String value, boolean defaultValue)
	{
<span class="fc bfc" id="L2534" title="All 2 branches covered.">		if (value==null)</span>
		{
<span class="fc" id="L2536">			return(defaultValue);</span>
		}
<span class="pc bpc" id="L2538" title="2 of 6 branches missed.">		return value.equalsIgnoreCase(&quot;yes&quot;) || value.equalsIgnoreCase(&quot;true&quot;) || value.equalsIgnoreCase(&quot;1&quot;);</span>
	}

	/**
	 * deeply clones a Map by cloning all the values.
	 */
	public static Map&lt;String,String&gt; deepCopy(Map&lt;String, String&gt; original) {
<span class="fc" id="L2545">	    Map&lt;String, String&gt; copy = new HashMap&lt;&gt;(original.size());</span>
<span class="fc bfc" id="L2546" title="All 2 branches covered.">	    for(Map.Entry&lt;String, String&gt; entry : original.entrySet()) {</span>
<span class="fc" id="L2547">	        copy.put(entry.getKey(), entry.getValue());</span>
<span class="fc" id="L2548">	    }</span>
<span class="fc" id="L2549">	    return copy;</span>
	}


	public static boolean addCookie(javax.servlet.http.Cookie cookie, HttpServletResponse response, HttpServletRequest request)
	{

<span class="pc bpc" id="L2556" title="3 of 6 branches missed.">		if (response == null || cookie == null || request == null)</span>
		{
<span class="nc" id="L2558">			Logger.debug(Tools.class,&quot;response or cookie or request is null cookie wasn't add&quot;);</span>
<span class="nc" id="L2559">			return false;</span>
		}

<span class="fc" id="L2562">		String cookieName = cookie.getName();</span>
<span class="fc bfc" id="L2563" title="All 2 branches covered.">		if (&quot;statBrowserIdNew&quot;.equals(cookieName))</span>
		{
<span class="pc bpc" id="L2565" title="1 of 2 branches missed.">			if (canSetCookie(&quot;statisticke&quot;, request.getCookies())==false)</span>
			{
<span class="nc" id="L2567">				Logger.debug(Tools.class,&quot;Nemozem nastavit statBrowserIdNew pretoze nie je povolena skupina statisticke&quot;);</span>
<span class="nc" id="L2568">				return false;</span>
			}
		}

<span class="pc bpc" id="L2572" title="3 of 4 branches missed.">		if(canSetAnyCookie(request.getCookies()) || cookie.getName().equalsIgnoreCase(&quot;JSESSIONID&quot;))</span>
		{
<span class="pc bpc" id="L2574" title="3 of 4 branches missed.">			if (Tools.isSecure(request) &amp;&amp; Tools.isNotEmpty(Constants.getString(&quot;strictTransportSecurity&quot;)))</span>
			{
<span class="nc" id="L2576">				cookie.setSecure(true);</span>
			}

<span class="fc" id="L2579">			response.addCookie(cookie);</span>
<span class="fc" id="L2580">			return true;</span>
		}
		else
		{
<span class="nc" id="L2584">			Logger.debug(Tools.class,&quot;adding cookies is denied  &quot; + cookie.getName());</span>
<span class="nc" id="L2585">			return false;</span>
		}
	}

	public static boolean canSetCookie(String classification, javax.servlet.http.Cookie[] cookies)
	{
<span class="pc bpc" id="L2591" title="1 of 2 branches missed.">		if (Constants.getBoolean(&quot;gdprAllowAllCookies&quot;)) return true;</span>

<span class="pc bpc" id="L2593" title="1 of 6 branches missed.">		if(Tools.isEmpty(classification) || &quot;ALWAYS&quot;.equals(classification) || &quot;nutne&quot;.equals(classification))</span>
		{
<span class="fc" id="L2595">			return true;</span>
		}

<span class="fc" id="L2598">		boolean gdprInsertAllScriptsBeforeConsent = Constants.getBoolean(&quot;gdprInsertAllScriptsBeforeAccept&quot;);</span>
<span class="fc" id="L2599">		String cookieName = Constants.getString(&quot;gdprCookieName&quot;);</span>
<span class="fc" id="L2600">		String[] enableCookiesClass = Tools.getTokens(Tools.getCookieValue(cookies, cookieName, &quot;&quot;), &quot;_&quot;);</span>

		// LPA https://intra.iway.sk/helpdesk/tickets/detail/32155?comment=2267668
<span class="pc bpc" id="L2603" title="3 of 4 branches missed.">		if (gdprInsertAllScriptsBeforeConsent &amp;&amp; enableCookiesClass.length == 0) {</span>
<span class="nc" id="L2604">			return true;</span>
		}

<span class="fc bfc" id="L2607" title="All 2 branches covered.">		for(String enableCookie: enableCookiesClass)</span>
		{
<span class="fc bfc" id="L2609" title="All 2 branches covered.">			if(classification.equals(enableCookie))</span>
<span class="fc" id="L2610">				return true;</span>
		}

<span class="fc" id="L2613">		return false;</span>
	}

	/**
	 * Toto umoznuje uplne vypnut vkladanie cookies, staci nastavit cookie s nazvom cc_cookie_decline (Constants.disableCookiesCookieName) s hodnotu cc_cookie_decline (Constants.disableCookiesCookieValue)
	 * @param actualCookies
	 * @return
	 */
	private static boolean canSetAnyCookie(javax.servlet.http.Cookie[] actualCookies)
	{
<span class="pc bpc" id="L2623" title="2 of 6 branches missed.">		if(actualCookies == null || Tools.isEmpty(Constants.getString(&quot;disableCookiesCookieName&quot;)) || Tools.isEmpty(Constants.getString(&quot;disableCookiesCookieValue&quot;)) )</span>
<span class="fc" id="L2624">			return true;</span>

<span class="pc bpc" id="L2626" title="1 of 2 branches missed.">		if(actualCookies.length &gt; 0 )</span>
		{
<span class="fc bfc" id="L2628" title="All 2 branches covered.">			for (int i = 0; i &lt; actualCookies.length; i++)</span>
			{
<span class="pc bpc" id="L2630" title="1 of 2 branches missed.">				if (actualCookies[i].getName().equals (Constants.getString(&quot;disableCookiesCookieName&quot;))</span>
<span class="nc bnc" id="L2631" title="All 2 branches missed.">							&amp;&amp; Constants.getString(&quot;disableCookiesCookieValue&quot;).equals(actualCookies[i].getValue()))</span>
<span class="nc" id="L2632">					return false;</span>
			}
		}
<span class="fc" id="L2635">		return true;</span>
	}

	/**
	 * Vycisti html od znaciek a pod, vrati cisty text, odstrani viacnasobne whitespaces a newlines
	 * pre viac info : &lt;a href=&quot;http://jsoup.org/apidocs/&quot;&gt;http://jsoup.org/apidocs/ &lt;/a&gt;
	 * @param html
	 * @return
	 */
	public static String html2text(String html)
	{
<span class="fc" id="L2646">		return Html2Text.html2text(html);</span>
	}

	/**
	 * Vrati hodnotu parametra, alebo attributu (ak je parameter null). Ak je aj atribut null, vrati null.
	 *
	 * @param name
	 * @param request
	 * @return
	 */
	public static String getParamAttribute(String name, HttpServletRequest request)
	{
<span class="nc" id="L2658">		String ret = request.getParameter(name);</span>
<span class="nc bnc" id="L2659" title="All 2 branches missed.">		if (ret == null)</span>
		{
<span class="nc" id="L2661">			ret = (String) request.getAttribute(name);</span>
		}
<span class="nc" id="L2663">		return (ret);</span>
	}

	/**
	 * deep copy of list
	 * @param source
	 * @return
	 */
	public static &lt;T&gt; List&lt;T&gt; copyList(List&lt;T&gt; source)
	{
<span class="nc" id="L2673">		List&lt;T&gt; dest = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L2674" title="All 2 branches missed.">		for (T item : source)</span>
		{
<span class="nc" id="L2676">			dest.add(item);</span>
<span class="nc" id="L2677">		}</span>
<span class="nc" id="L2678">		return dest;</span>
	}

	/**
	 * performs save conversion from long to int
	 * if long value isn't convertable to int without change of value
	 * exception is thrown
	 * @param l
	 * @return int representation of longsomhow to
	 * @author mhalas
	 */
	public static int safeLongToInt(long l) {
<span class="pc bpc" id="L2690" title="2 of 4 branches missed.">	    if (l &lt; Integer.MIN_VALUE || l &gt; Integer.MAX_VALUE) {</span>
<span class="nc" id="L2691">	        throw new IllegalArgumentException</span>
	            (l + &quot; cannot be cast to int without changing its value.&quot;);
	    }
<span class="fc" id="L2694">	    return (int) l;</span>
	}


	/**
	 * Zmaze duplikaty z dlheho stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 *
	 * @param txt
	 * @param splitterRegex
	 * @return
	 */
	public static String removeDuplicates(String txt, String splitterRegex)
	{
<span class="nc" id="L2707">		List&lt;String&gt; values = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L2708">		String[] splitted = txt.split(splitterRegex);</span>
<span class="nc" id="L2709">		StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L2710" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2712" title="All 2 branches missed.">			if (!values.contains(splitted[i]))</span>
			{
<span class="nc" id="L2714">				values.add(splitted[i]);</span>
<span class="nc" id="L2715">				sb.append(splitterRegex);</span>
<span class="nc" id="L2716">				sb.append(splitted[i]);</span>
			}
		}
<span class="nc" id="L2719">		return sb.substring(1) + &quot;,&quot;;</span>
	}

	/**
	 * V dlhem stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 * skontroluje ci cele casti medzi oddelovacmi sa nenachodzaju v comparableText-e
	 *
	 * @param allText
	 * @param splitterRegex
	 * @param comparableText
	 * @return
	 */
	public static boolean containsWholePartInString(String allText, String splitterRegex, String comparableText)
	{
<span class="nc" id="L2733">		boolean ret = false;</span>
<span class="nc" id="L2734">		String[] splitted = allText.split(splitterRegex);</span>
<span class="nc bnc" id="L2735" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2737" title="All 2 branches missed.">			if (comparableText.equals(splitted[i]))</span>
			{
<span class="nc" id="L2739">				ret = true;</span>
			}
		}
<span class="nc" id="L2742">		return ret;</span>
	}

	/**
	 * Z dlheho stringu, kde su hodnoty oddelene ciarkou napr.(String str = &quot;auto,dom,strom&quot;)
	 * prida na zaciatok kazdej hodnoty predponu z parametra &quot;addStringStart&quot;
	 *
	 * @param txt
	 * @param splitterRegex
	 * @param addStringStart
	 * @return
	 */
	public static String parseStringAddOnStart(String txt, String splitterRegex, String addStringStart)
	{
<span class="nc" id="L2756">		List&lt;String&gt; values = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L2757">		String[] splitted = txt.split(splitterRegex);</span>
<span class="nc" id="L2758">		StringBuilder sb = new StringBuilder();</span>
<span class="nc bnc" id="L2759" title="All 2 branches missed.">		for (int i = 0; i &lt; splitted.length; ++i)</span>
		{
<span class="nc bnc" id="L2761" title="All 2 branches missed.">			if (!values.contains(splitted[i]))</span>
			{
<span class="nc" id="L2763">				values.add(addStringStart + splitted[i]);</span>
<span class="nc" id="L2764">				sb.append(splitterRegex);</span>
<span class="nc" id="L2765">				sb.append(addStringStart + splitted[i]);</span>
			}
		}
<span class="nc" id="L2768">		return sb.substring(1) + &quot;,&quot;;</span>
	}

	/**
	 *
	 * @param string
	 * @param delimiter
	 * @return
	 */
	public List&lt;String&gt; stringToList(String string, String delimiter)
	{
<span class="nc" id="L2779">		return new ArrayList&lt;&gt;(Arrays.asList(string.split(delimiter)));</span>
	}

	/**
	 * prida k ceste parameter time s timestampom (aby sa znovunacitavalo ce es es ko)
	 * @param virtualPath
	 * @return
	 */
	public static String getPathWithTimestamp(String virtualPath)
	{
<span class="nc" id="L2789">		String realPath = PathFilter.getRealPath(virtualPath);</span>
<span class="nc" id="L2790">		File file = new File(realPath);</span>
<span class="nc bnc" id="L2791" title="All 2 branches missed.">		if (file.exists())</span>
		{
<span class="nc" id="L2793">			return addParameterToUrl(virtualPath,&quot;time&quot;,String.valueOf(file.lastModified()));</span>
		}
<span class="nc" id="L2795">		return virtualPath;</span>
	}


	/**
	 * checks if remote IP of requestis listed in allowed IPs constant ( comma separated string )
	 * @param request
	 * @param constantName - meno konfiguracnej premennej (ta je nastavena na znak * alebo zoznam ZACIATKOV povolenych ip adries oddelenych ciarkou)
	 * @return
	 */
	public static boolean checkIpAccess(HttpServletRequest request,String constantName){
<span class="fc" id="L2806">		String enabledIPs = Constants.getString(constantName);</span>

<span class="pc bpc" id="L2808" title="1 of 2 branches missed.">		if (&quot;*&quot;.equals(enabledIPs)) return true;</span>

<span class="pc bpc" id="L2810" title="1 of 2 branches missed.">		if (Tools.isEmpty(enabledIPs))</span>
		{
			//[#44392 - Vystavenie rest služby pre konkrétny formulár] - uloha #15 =&gt;
			//iba tieto 2 premenne mozu byt prazdne a je to povazovane za OK, ostatne musia mat nastavene * aby sa nestalo, ze kvoli preklepu v nazve premennej sa sluzba otvori navonok
<span class="nc bnc" id="L2814" title="All 4 branches missed.">			if (&quot;webEnableIPs&quot;.equals(constantName) || &quot;adminEnableIPs&quot;.equals(constantName)) return true;</span>
		}

<span class="pc bpc" id="L2817" title="2 of 4 branches missed.">		if (enabledIPs != null &amp;&amp; enabledIPs.length() &gt; 1)</span>
		{
<span class="fc" id="L2819">			StringTokenizer st = new StringTokenizer(enabledIPs, &quot;,&quot;);</span>
			String ip;
<span class="fc" id="L2821">			String myIP = Tools.getRemoteIP(request);</span>
<span class="fc" id="L2822">			Logger.debug(PathFilter.class,&quot;Checking: &quot; + myIP + &quot; vs &quot; + enabledIPs);</span>
<span class="pc bpc" id="L2823" title="1 of 2 branches missed.">			while (st.hasMoreTokens())</span>
			{
<span class="fc" id="L2825">				ip = st.nextToken();</span>
<span class="pc bpc" id="L2826" title="1 of 2 branches missed.">				if (myIP.startsWith(ip.trim()))</span>
				{
<span class="fc" id="L2828">					return true;</span>
				}
			}
		}
<span class="nc" id="L2832">		return false;</span>

	}


	/**
	 * Vrati request.getUserPrincipal aj pre spring owrapovanie (pouzivane pri integracii na IIS)
	 * @param request
	 * @return
	 */
	public static Principal getUserPrincipal(HttpServletRequest request)
	{
<span class="nc" id="L2844">		ServletRequestAttributes attr = (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes();</span>
		//Logger.debug(Tools.class, &quot;getUserPrincipal() attr: &quot;+attr);
<span class="nc" id="L2846">		Principal p = attr.getRequest().getUserPrincipal();</span>
		//Logger.debug(Tools.class, &quot;PRINCIPAL attr: &quot; + p);
<span class="nc bnc" id="L2848" title="All 2 branches missed.">		if (p != null) return p;</span>

<span class="nc" id="L2850">		return request.getUserPrincipal();</span>
	}

	public static String fixURL(String url)
	{
<span class="nc bnc" id="L2855" title="All 2 branches missed.">		if (url==null) return(&quot;&quot;);</span>

<span class="nc" id="L2857">		url = DocTools.removeCharsDir(url).toLowerCase();</span>

<span class="nc" id="L2859">		url = Tools.replace(url, &quot;//&quot;, &quot;/&quot;);</span>
<span class="nc" id="L2860">		url = Tools.replace(url, &quot;=&quot;, &quot;-&quot;);</span>
<span class="nc" id="L2861">		url = Tools.replace(url, &quot;_-_&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2862">		url = Tools.replace(url, &quot;__&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2863">		url = Tools.replace(url, &quot;___&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2864">		url = Tools.replace(url, &quot;._&quot;, &quot;_&quot;);</span>
<span class="nc" id="L2865">		url = Tools.replace(url, &quot;_.html&quot;, &quot;.html&quot;);</span>
<span class="nc" id="L2866">		url = Tools.replace(url, &quot;.html.html&quot;, &quot;.html&quot;);</span>
		//ak mame nahradu spojok a bodiek v URL toto treba
<span class="nc" id="L2868">		url = Tools.replace(url, &quot;-html.html&quot;, &quot;.html&quot;);</span>
		//htm je tu kvoli importu web stranok zo zip archivu
<span class="nc" id="L2870">		url = Tools.replace(url, &quot;.htm.html&quot;, &quot;.htm&quot;);</span>
<span class="nc" id="L2871">		url = Tools.replace(url, &quot;-htm.html&quot;, &quot;.htm&quot;);</span>
<span class="nc" id="L2872">		return(url);</span>
	}

	/**
	 * Vrati orezany text po najblizsie slovo
	 */
	public static String truncateText(String text, int length){

<span class="nc bnc" id="L2880" title="All 2 branches missed.">		if(text.length() &gt; length){</span>
<span class="nc" id="L2881">			int index = text.lastIndexOf(&quot; &quot;, length);</span>
<span class="nc bnc" id="L2882" title="All 2 branches missed.">			if (index &gt; 0) text = text.substring(0, index);</span>
<span class="nc" id="L2883">			else text = text.substring(0, length);</span>
		}
<span class="nc" id="L2885">		return text;</span>
	}

	/**
	 * Skonvertuje |* tagy na html tagy
	 * @param text
	 * @return
	 */
	public static String convertToHtmlTags(String text){

<span class="pc bpc" id="L2895" title="1 of 2 branches missed.">		if (text.contains(&quot;*||&quot;)) text = Tools.replace(text, &quot;*||&quot;, &quot;&lt;/&quot;);</span>
<span class="pc bpc" id="L2896" title="1 of 2 branches missed.">		if (text.contains(&quot;*|&quot;)) text = Tools.replace(text, &quot;*|&quot;, &quot;&lt;&quot;);</span>
<span class="pc bpc" id="L2897" title="1 of 2 branches missed.">		if (text.contains(&quot;|*&quot;)) text = Tools.replace(text, &quot;|*&quot;, &quot;&gt;&quot;);</span>
<span class="fc bfc" id="L2898" title="All 2 branches covered.">		if (text.contains(&quot;&amp;amp;#47;&quot;)) text = Tools.replace(text, &quot;&amp;amp;#47;&quot;, &quot;&amp;#47;&quot;);</span>

<span class="fc" id="L2900">		return  text;</span>
	}

	public static boolean isNumeric(String str)
	{
<span class="fc bfc" id="L2905" title="All 2 branches covered.">		if (Tools.isEmpty(str)) return false;</span>
		try
		{
<span class="nc" id="L2908">			Double.parseDouble(str);</span>
		}
<span class="fc" id="L2910">		catch(NumberFormatException nfe)</span>
		{
<span class="fc" id="L2912">			return false;</span>
<span class="nc" id="L2913">		}</span>
<span class="nc" id="L2914">		return true;</span>
	}

	/**
	 * Funkcia podobna JS kodu setTimeout pre asynchronne spustenie ulohy (vid InitServlet volanie localconf.jsp)
	 * @param runnable
	 * @param delay
	 */
	public static void setTimeout(Runnable runnable, int delay){
<span class="fc" id="L2923">		new Thread(() -&gt; {</span>
			try {
<span class="fc" id="L2925">				Thread.sleep(delay);</span>
<span class="fc" id="L2926">				runnable.run();</span>
			}
<span class="nc" id="L2928">			catch (Exception e){</span>
<span class="nc" id="L2929">				Logger.error(Tools.class, e);</span>
<span class="fc" id="L2930">			}</span>
<span class="fc" id="L2931">		}).start();</span>
<span class="fc" id="L2932">	}</span>

	public static String prepositionsAppendNbsp(String text) {
<span class="nc" id="L2935">		String result = text;</span>
<span class="nc" id="L2936">		String[] prepositions = Tools.getTokens(Constants.getString(&quot;prepositions&quot;), &quot;,&quot;);</span>

<span class="nc bnc" id="L2938" title="All 2 branches missed.">		for (String preposition : prepositions) {</span>
<span class="nc" id="L2939">			preposition = preposition.trim();</span>
<span class="nc" id="L2940">			result = Tools.replace(result, &quot; &quot; + preposition + &quot; &quot;, &quot; &quot; + preposition + &quot;&amp;nbsp;&quot;);</span>
		}

<span class="nc" id="L2943">		return result;</span>
	}

	/**
	 * Odescapuje HTML kod, napr. z &amp;lt; spravi &lt;, je to potrebne napr. pri exporte do Excelu a podobne
	 * @param text
	 * @return
	 */
	public static String unescapeHtmlEntities(String text)
	{
<span class="nc" id="L2953">		String returnString = text;</span>
<span class="nc" id="L2954">		returnString = Tools.replace(returnString, &quot;&amp;lt;&quot;, &quot;&lt;&quot;);</span>
<span class="nc" id="L2955">		returnString = Tools.replace(returnString, &quot;&amp;gt;&quot;, &quot;&gt;&quot;);</span>
<span class="nc" id="L2956">		returnString = Tools.replace(returnString, &quot;&amp;amp;&quot;, &quot;&amp;&quot;);</span>
<span class="nc" id="L2957">		returnString = Tools.replace(returnString, &quot;&amp;quot;&quot;, &quot;\&quot;&quot;);</span>

<span class="nc" id="L2959">		return returnString;</span>
	}

	public static String escapeHtml(String text) {
<span class="fc bfc" id="L2963" title="All 2 branches covered.">		if(text != null) {</span>
//			return StringEscapeUtils.escapeHtml(text);
<span class="fc" id="L2965">			return ResponseUtils.filter(text).replace(&quot;&amp;amp;&quot;, &quot;&amp;&quot;);</span>
		} else {
<span class="fc" id="L2967">			return null;</span>
		}
	}

    public static String getJsonUnsafe(String json) {
<span class="fc" id="L2972">	    return json;</span>
    }

    /**
     * RequestParameterNames
     */

    /**
     *
     * @param request HttpServletRequest
     * @return unescaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNamesUnsafe(HttpServletRequest request) {
<span class="nc" id="L2985">        return getRequestParameterNames(request, false);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @return escaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNames(HttpServletRequest request) {
<span class="nc" id="L2994">        return getRequestParameterNames(request, true);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @param sanitize escape request parameter names if it's true
     * @return escaped/unescaped request parameter names
     */
    public static Enumeration&lt;String&gt; getRequestParameterNames(HttpServletRequest request, boolean sanitize) {
<span class="nc" id="L3004">        Enumeration&lt;String&gt; e = request.getParameterNames();</span>

<span class="nc bnc" id="L3006" title="All 2 branches missed.">        if(sanitize) {</span>
<span class="nc" id="L3007">            List&lt;String&gt; names = Collections.list(e);</span>

<span class="nc bnc" id="L3009" title="All 2 branches missed.">            for(int i = 0; i &lt; names.size(); i++) {</span>
<span class="nc" id="L3010">                names.set(i, escapeHtml(names.get(i)));</span>
            }

<span class="nc" id="L3013">            e = Collections.enumeration(names);</span>
        }

<span class="nc" id="L3016">        return e;</span>
    }

    /**
     * RequestParameterValues
     */

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return escaped request parameter values
     */
	public static String[] getRequestParameterValues(HttpServletRequest request, String param) {
<span class="nc" id="L3030">		return getRequestParameterValues(request, param, true);</span>
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @param sanitize escape request parameter values if it's true
     * @return escaped/unescaped request parameter values
     */
	public static String[] getRequestParameterValues(HttpServletRequest request, String param, boolean sanitize) {
<span class="nc bnc" id="L3041" title="All 2 branches missed.">		if(sanitize) {</span>
<span class="nc" id="L3042">			String[] values = request.getParameterValues(param);</span>
<span class="nc bnc" id="L3043" title="All 2 branches missed.">			if (values == null) return null;</span>

<span class="nc bnc" id="L3045" title="All 2 branches missed.">			for(int i = 0; i &lt; values.length; i++) {</span>
<span class="nc" id="L3046">				values[i] = escapeHtml(values[i]);</span>
			}
<span class="nc" id="L3048">			return values;</span>
		} else {
<span class="nc" id="L3050">			return request.getParameterValues(param);</span>
		}
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return unescaped request parameter values
     */
	public static String[] getRequestParameterValuesUnsafe(HttpServletRequest request, String param) {
<span class="nc" id="L3061">		return getRequestParameterValues(request, param, false);</span>
	}

    /**
     * RequestParameter
     */

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @return escaped request parameter value
     */
	public static String getRequestParameter(HttpServletRequest request, String param) {
<span class="fc" id="L3075">		return getRequestParameter(request, param, true);</span>
	}

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @@return unescaped request parameter value
     */
    public static String getRequestParameterUnsafe(HttpServletRequest request, String param) {
<span class="fc" id="L3085">        return getRequestParameter(request, param, false);</span>
    }

    /**
     *
     * @param request HttpServletRequest
     * @param param Request parameter name
     * @param sanitize escape request parameter value if it's true
     * @return escaped/unescaped request parameter value
     */
	public static String getRequestParameter(HttpServletRequest request, String param, boolean sanitize) {
<span class="fc bfc" id="L3096" title="All 2 branches covered.">		if(sanitize) {</span>
<span class="fc" id="L3097">			return escapeHtml(request.getParameter(param));</span>
		} else {
<span class="fc" id="L3099">			return request.getParameter(param);</span>
		}
	}

	/**
	 *
	 * @param out JspWriter
	 * @param json JSONArray with news
	 * @param callback name of callback you want to call with json as a parameter
	 * @throws JSONException
	 * @throws IOException
	 */
	public static void printJSON(JspWriter out, JSONArray json, String callback) throws JSONException, IOException {
<span class="pc bpc" id="L3112" title="1 of 2 branches missed.">		if (callback == null) {</span>
<span class="fc" id="L3113">			out.println(Tools.getJsonUnsafe(json.toString(4)));</span>
		} else {
<span class="nc" id="L3115">			out.println(callback + &quot;(&quot; + Tools.getJsonUnsafe(json.toString(4)) + &quot;);&quot;);</span>
		}
<span class="fc" id="L3117">	}</span>

    /**
     *
     * @param out JspWriter
     * @param json JSONArray with news
     * @throws JSONException
     * @throws IOException
     */
    public static void printJSON(JspWriter out, JSONArray json) throws JSONException, IOException {
<span class="fc" id="L3127">        printJSON(out, json, null);</span>
<span class="fc" id="L3128">    }</span>

    public static String getRequestURI(HttpServletRequest request) {
<span class="nc" id="L3131">        return Tools.escapeHtml(request.getRequestURI());</span>
    }

    public static String getRequestQueryString(HttpServletRequest request) {
<span class="nc" id="L3135">        return Tools.escapeHtml(request.getQueryString());</span>
    }

	public static Calendar nextWorkingDay(Calendar calendar) {
		do {
<span class="nc" id="L3140">			calendar.add(Calendar.DAY_OF_YEAR , 1);</span>
<span class="nc bnc" id="L3141" title="All 2 branches missed.">		} while (!isWorkingDay(calendar));</span>
<span class="nc" id="L3142">		return calendar;</span>
	}

	public static boolean isWorkingDay(Calendar cal) {
<span class="nc bnc" id="L3146" title="All 4 branches missed.">		if (cal.get(Calendar.DAY_OF_WEEK) == Calendar.SATURDAY || cal.get(Calendar.DAY_OF_WEEK) == Calendar.SUNDAY) {</span>
<span class="nc" id="L3147">			return false;</span>
		}
<span class="nc" id="L3149">		int result = new SimpleQuery().forInt(&quot;SELECT holiday_id FROM holidays WHERE hday=? AND hmonth = ? AND (hyear = ? OR hyear is NULL or hyear = '')&quot;, cal.get(Calendar.DAY_OF_MONTH), cal.get(Calendar.MONTH)+1, cal.get(Calendar.YEAR));</span>
<span class="nc bnc" id="L3150" title="All 2 branches missed.">		if (result &gt; 0)</span>
<span class="nc" id="L3151">			return false;</span>
<span class="nc" id="L3152">		return true;</span>
	}

	public static String trim(String value) {
<span class="pc bpc" id="L3156" title="1 of 2 branches missed.">		if (value == null) return value;</span>

<span class="fc" id="L3158">		return value.trim();</span>
	}

	/**
	 * Returns toString value of StringBuilder OR null if StringBuilder is NULL
	 * @param builder
	 * @return
	 */
	public static String toString(StringBuilder builder) {
<span class="pc bpc" id="L3167" title="1 of 2 branches missed.">		if (builder == null) return null;</span>
<span class="nc" id="L3168">		return builder.toString();</span>
	}

	/**
	 * @deprecated use DomainRedirectDB.getDomainFromAlias
	 * @param aliasedDomainName
	 * @return
	 */
	@Deprecated
	public static String getDomainFromAlias(String aliasedDomainName) {
<span class="nc" id="L3178">		return DomainRedirectDB.getDomainFromAlias(aliasedDomainName);</span>
	}

	/**
	 * Returns Spring ApplicationContext to access spring beans from not spring classes
	 * @return
	 */
	public static ApplicationContext getSpringContext() {
<span class="fc" id="L3186">		RequestBean requestBean = SetCharacterEncodingFilter.getCurrentRequestBean();</span>
		ApplicationContext context;
<span class="fc bfc" id="L3188" title="All 2 branches covered.">      	if (requestBean == null) context = (ApplicationContext) Constants.getServletContext().getAttribute(&quot;springContext&quot;);</span>
<span class="fc" id="L3189">		else context = requestBean.getSpringContext();</span>

<span class="fc" id="L3191">		return context;</span>
	}

	/**
	 * Returns Spring Bean, you can get the SpringBean from not spring classes
	 * @param &lt;T&gt;
	 * @param name
	 * @param clazz
	 * @return
	 */
	public static &lt;T&gt; T getSpringBean(String name, Class&lt;T&gt; clazz) {
<span class="fc" id="L3202">		ApplicationContext springContext = getSpringContext();</span>
<span class="pc bpc" id="L3203" title="2 of 4 branches missed.">        if (springContext == null || !springContext.containsBean(name)) {</span>
<span class="nc" id="L3204">            return null;</span>
        }

<span class="fc" id="L3207">        return springContext.getBean(name, clazz);</span>
    }

	/**
	 * Returns true if b IS NOT NULL and value is TRUE
	 * @param b
	 * @return
	 */
	public static boolean isTrue(Boolean b) {
<span class="fc" id="L3216">		return Boolean.TRUE.equals(b);</span>
	}

	/**
	 * Returns true if b IS NOT NULL and is FALSE
	 * @param b
	 * @return
	 */
	public static boolean isFalse(Boolean b) {
<span class="fc" id="L3225">		return Boolean.FALSE.equals(b);</span>
	}

	/**
	 * Decode base64 encoded string
	 * @param encoded
	 * @return
	 */
	public static String base64Decode(String encoded) {
<span class="pc bpc" id="L3234" title="1 of 2 branches missed.">		if (Tools.isEmpty(encoded)) return &quot;&quot;;</span>
<span class="nc" id="L3235">		return new String(Base64.getDecoder().decode(encoded));</span>
	}

	/**
	 * Encode string to base64
	 * @param text
	 * @return
	 */
	public static String base64Encode(String text) {
<span class="nc bnc" id="L3244" title="All 2 branches missed.">		if (Tools.isEmpty(text)) return &quot;&quot;;</span>
<span class="nc" id="L3245">		return Base64.getEncoder().encodeToString(text.getBytes());</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>