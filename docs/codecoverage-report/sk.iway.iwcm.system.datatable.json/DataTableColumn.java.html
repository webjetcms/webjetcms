<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DataTableColumn.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjet8v9</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm.system.datatable.json</a> &gt; <span class="el_source">DataTableColumn.java</span></div><h1>DataTableColumn.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm.system.datatable.json;

import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonInclude;

import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import lombok.Getter;
import lombok.Setter;
import sk.iway.iwcm.*;
import sk.iway.iwcm.i18n.Prop;
import sk.iway.iwcm.system.datatable.DataTableColumnType;
import sk.iway.iwcm.system.datatable.DataTableColumnsFactory;

import javax.persistence.Transient;
import javax.servlet.http.HttpServletRequest;
import java.lang.reflect.Field;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Date;
import java.util.HashMap;
import java.util.List;

/**
 * Trieda pre generovanie JSONu pre DataTable {@see https://datatables.net/} z
 * anotacie {@link sk.iway.iwcm.system.datatable.annotations.DataTableColumn}
 * nad poliami objektu. Trieda je priamo mapovatelna pomocou
 * {@link com.fasterxml.jackson.databind.ObjectMapper}
 */
@JsonInclude(JsonInclude.Include.NON_NULL)
@Getter
@Setter
public class DataTableColumn {
    private String data;
    private String name;
    private String title;
    @JsonIgnore
    private String titleKeyOriginal; //originalny prekladovy kluc title

    private String defaultContent;

    private String className;
    private String renderFormat;
    private String renderFormatLinkTemplate;
    private String renderFormatPrefix;

    private DataTableColumnEditor editor;
    private Boolean visible;
    private Boolean hidden;
    private Boolean hiddenEditor;
    private Boolean filter;

    private String sortAfter;
    private String perms;

    private Boolean array;

    private Boolean orderable;

    @SuppressWarnings(&quot;rawtypes&quot;)
<span class="fc" id="L62">    public DataTableColumn(Class controller, Field field, String fieldPrefix) {</span>
<span class="fc" id="L63">        String fieldPrefixNotNull = fieldPrefix;</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">        if (fieldPrefixNotNull == null)</span>
<span class="fc" id="L65">            fieldPrefixNotNull = &quot;&quot;;</span>
<span class="fc" id="L66">        name = fieldPrefixNotNull + field.getName();</span>
<span class="fc" id="L67">        data = fieldPrefixNotNull + field.getName();</span>

<span class="fc" id="L69">        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (requestAttributes==null) return;</span>

<span class="fc" id="L72">        HttpServletRequest request = requestAttributes.getRequest();</span>
<span class="fc" id="L73">        Prop prop = Prop.getInstance(request);</span>

<span class="fc" id="L75">        setPropertiesFromFieldType(field);</span>
<span class="fc" id="L76">        setPropertiesFromAnnotation(controller, field, prop);</span>
<span class="fc" id="L77">        setEditorPropertiesFromField(field);</span>

<span class="fc" id="L79">        setFinalProperties(field);</span>
<span class="fc" id="L80">        setCellNotEditable(field);</span>
<span class="fc" id="L81">    }</span>

    private void setPropertiesFromFieldType(Field field) {
        // DATE
<span class="pc bpc" id="L85" title="1 of 4 branches missed.">        if (field.getType().isAssignableFrom(Date.class) || field.getType().isAssignableFrom(java.sql.Date.class)) {</span>
<span class="fc" id="L86">            renderFormat = &quot;dt-format-date-time&quot;;</span>
<span class="fc" id="L87">            addClassName(&quot;dt-style-date&quot;);</span>
        }
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (field.getType().isArray()) array = Boolean.TRUE;</span>
<span class="fc" id="L90">        else array = Boolean.FALSE;</span>
<span class="fc" id="L91">    }</span>

    /**
     * Metoda nastavi JSON podla anotacie
     * {@link sk.iway.iwcm.system.datatable.annotations.DataTableColumn} na danom
     * poli. Anotacie maju rovnaky nazov a format ako generovany JSON.
     *
     * @param field - reflection field, ktore ma nastavenu anotaciu
     *              {@link sk.iway.iwcm.system.datatable.annotations.DataTableColumn}
     */
    @SuppressWarnings(&quot;rawtypes&quot;)
    private void setPropertiesFromAnnotation(Class controller, Field field, Prop prop) {
<span class="fc" id="L103">        sk.iway.iwcm.system.datatable.annotations.DataTableColumn annotation = field.getAnnotation(sk.iway.iwcm.system.datatable.annotations.DataTableColumn.class);</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">        if (annotation == null) {</span>
<span class="nc" id="L105">            return;</span>
        }

<span class="fc" id="L108">        DataTableColumnType[] inputType = annotation.inputType();</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (inputType.length &gt; 0) {</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">            for (DataTableColumnType type : inputType) {</span>
<span class="fc" id="L111">                setPropertiesFromType(type, annotation, prop);</span>
            }
        }

<span class="fc bfc" id="L115" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotation.data())) {</span>
<span class="fc" id="L116">            data = annotation.data();</span>
        }

<span class="fc bfc" id="L119" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotation.name())) {</span>
<span class="fc" id="L120">            name = annotation.name();</span>
        }

<span class="fc bfc" id="L123" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotation.title())) {</span>
<span class="fc" id="L124">            String[] titleArr = annotation.title().split(&quot;;&quot;);</span>

<span class="fc" id="L126">            titleKeyOriginal = titleArr[0];</span>

<span class="fc bfc" id="L128" title="All 2 branches covered.">            if(titleArr.length &gt; 1)</span>
<span class="fc" id="L129">                title = prop.getTextWithParams(titleArr[0], Arrays.copyOfRange(titleArr, 1, titleArr.length));</span>
            else {
<span class="pc bpc" id="L131" title="1 of 6 branches missed.">                if (inputType!=null &amp;&amp; inputType.length==1 &amp;&amp; inputType[0].equals(DataTableColumnType.BOOLEAN_TEXT)) {</span>
                    //title will be as option for checkbox
<span class="fc" id="L133">                    title = &quot;&amp;nbsp;&quot;;</span>
                } else {
<span class="fc" id="L135">                    title = prop.getText(annotation.title());</span>
                }
            }


            // skus implementovat zapis z pug suboru
<span class="fc" id="L141">            title = DataTableColumnsFactory.translate(title);</span>

<span class="fc bfc" id="L143" title="All 4 branches covered.">            if (Tools.isEmpty(title) || &quot;&amp;nbsp;&quot;.equals(title)) addClassName(&quot;empty-title&quot;);</span>
<span class="fc" id="L144">        } else {</span>
<span class="fc" id="L145">            String titleKey = &quot;components.&quot; + toLowerUnderscore(controller.getSimpleName()) + &quot;.&quot; + toLowerUnderscore(field.getName());</span>
<span class="fc" id="L146">            title = prop.getText(titleKey);</span>
<span class="fc bfc" id="L147" title="All 2 branches covered.">            if (titleKey.equals(title)) title = Tools.replace(toLowerUnderscore(field.getName()), &quot;_&quot;, &quot; &quot;);</span>
        }

<span class="fc bfc" id="L150" title="All 4 branches covered.">        if (inputType.length &gt; 0 &amp;&amp; inputType[0] == DataTableColumnType.STATIC_TEXT) {</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">            if (Tools.isNotEmpty(title)) {</span>
<span class="fc" id="L152">                editor.addAttr(&quot;data-value&quot;, title);</span>
            }
<span class="fc" id="L154">            title = &quot;&amp;nbsp;&quot;;</span>
        }

<span class="fc bfc" id="L157" title="All 6 branches covered.">        if (hidden == null &amp;&amp; (Tools.isEmpty(title) || &quot;&amp;nbsp;&quot;.equals(title))) {</span>
            // ak nie je nastaveny titulok, tak stlpec nezobraz v DB, asi sa jedna o nejaky
            // boolean atribut pre editor
<span class="fc" id="L160">            hidden = Boolean.TRUE;</span>
        }

<span class="fc" id="L163">        String[] strings = annotation.defaultContent();</span>
<span class="pc bpc" id="L164" title="2 of 4 branches missed.">        if (strings != null &amp;&amp; strings.length &gt; 0) {</span>
<span class="nc" id="L165">            defaultContent = strings[0];</span>
        }

<span class="fc" id="L168">        String annotationClassName = annotation.className();</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotationClassName)) {</span>
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">            if (annotationClassName.startsWith(&quot;!&quot;)) className = annotationClassName;</span>
<span class="fc" id="L171">            else addClassName(annotationClassName);</span>
        }

<span class="fc bfc" id="L174" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotation.renderFormat())) {</span>
<span class="fc" id="L175">            renderFormat = annotation.renderFormat();</span>
        }

<span class="fc bfc" id="L178" title="All 2 branches covered.">        if (Tools.isNotEmpty(annotation.renderFormatLinkTemplate())) {</span>
<span class="fc" id="L179">            renderFormatLinkTemplate = annotation.renderFormatLinkTemplate();</span>
        }

<span class="pc bpc" id="L182" title="1 of 2 branches missed.">        if (Tools.isNotEmpty(annotation.renderFormatPrefix())) {</span>
<span class="nc" id="L183">            renderFormatPrefix = annotation.renderFormatPrefix();</span>
        }

<span class="fc" id="L186">        boolean[] _visible = annotation.visible();</span>
<span class="fc bfc" id="L187" title="All 2 branches covered.">        if (_visible.length &gt; 0) {</span>
<span class="fc" id="L188">            this.visible = _visible[0];</span>
        }

<span class="fc" id="L191">        boolean[] _hidden = annotation.hidden();</span>
<span class="fc bfc" id="L192" title="All 2 branches covered.">        if (_hidden.length &gt; 0) {</span>
<span class="fc" id="L193">            this.hidden = _hidden[0];</span>
        }

<span class="fc" id="L196">        boolean[] _hiddenEditor = annotation.hiddenEditor();</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">        if (_hiddenEditor.length &gt; 0) {</span>
<span class="fc" id="L198">            this.hiddenEditor = _hiddenEditor[0];</span>
        }

<span class="fc" id="L201">        boolean[] _filter = annotation.filter();</span>
<span class="fc bfc" id="L202" title="All 2 branches covered.">        if (_filter.length &gt; 0) {</span>
<span class="fc" id="L203">            this.filter = _filter[0];</span>
<span class="fc bfc" id="L204" title="All 2 branches covered.">        } else if (field.getAnnotation(Transient.class)!=null) {</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">            if (&quot;userFullName&quot;.equals(field.getName())) {</span>
                //userFullName vieme standardne vyhladavat v DatatableRestControllerV2.addSpecSearchUserFullName
            } else {
                //ak je entita @Transient asi nie je v DB, filter pre istotu vypneme, ak treba musi sa zapnut manualne nastavenim filter: true
<span class="fc" id="L209">                this.filter = Boolean.FALSE;</span>
            }
<span class="pc bpc" id="L211" title="1 of 4 branches missed.">        } else if (className!=null &amp;&amp; className.contains(&quot;todo&quot;)) {</span>
            //ak ma className to do tiez nezobraz filter, na 99% nefunguje
<span class="nc" id="L213">            this.filter = Boolean.FALSE;</span>
        }

<span class="fc" id="L216">        String tab = annotation.tab();</span>
<span class="fc bfc" id="L217" title="All 2 branches covered.">        if (Tools.isNotEmpty(tab)) {</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">            if (editor == null) {</span>
<span class="fc" id="L219">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L221">            editor.setTab(tab);</span>
        }

<span class="fc" id="L224">        sortAfter = annotation.sortAfter();</span>
<span class="fc" id="L225">        perms = annotation.perms();</span>

<span class="fc" id="L227">        String defaultValue = annotation.defaultValue();</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">        if (Tools.isNotEmpty(defaultValue)) {</span>
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="nc" id="L230">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc bfc" id="L232" title="All 2 branches covered.">            if (&quot;{currentDomain}&quot;.equals(defaultValue)) {</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">                if (Constants.getBoolean(&quot;multiDomainEnabled&quot;)) {</span>
<span class="fc" id="L234">                    RequestBean rb = SetCharacterEncodingFilter.getCurrentRequestBean();</span>
<span class="fc" id="L235">                    defaultValue = rb.getDomain();</span>
<span class="fc" id="L236">                } else {</span>
<span class="nc" id="L237">                    defaultValue = &quot;&quot;;</span>
                }
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">            } else if (&quot;{currentDate}&quot;.equals(defaultValue)) {</span>
<span class="nc" id="L240">                defaultValue = Tools.formatDate(Tools.getNow());</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">            } else if (&quot;{currentDateTimeSeconds}&quot;.equals(defaultValue)) {</span>
<span class="nc" id="L242">                defaultValue = Tools.formatDateTimeSeconds(Tools.getNow());</span>
<span class="pc bpc" id="L243" title="1 of 2 branches missed.">            } else if (&quot;{currentTime}&quot;.equals(defaultValue)) {</span>
<span class="nc" id="L244">                defaultValue = Tools.formatTime(Tools.getNow());</span>
            }
<span class="fc" id="L246">            editor.setDef(defaultValue);</span>
        }

<span class="fc" id="L249">        boolean[] _orderable = annotation.orderable();</span>
<span class="fc bfc" id="L250" title="All 2 branches covered.">        if (_orderable.length &gt; 0) {</span>
<span class="fc" id="L251">            this.orderable = _orderable[0];</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">        } else if (Boolean.FALSE.equals(this.filter)) {</span>
            //ak je vypnuty filter a nenastavim orderable, tak predpokladam, ze nema byt ani orderable
<span class="fc" id="L254">            this.orderable = false;</span>
        }
<span class="fc" id="L256">    }</span>

    private void setEditorPropertiesFromField(Field field) {
<span class="fc bfc" id="L259" title="All 2 branches covered.">        if (editor == null) {</span>
<span class="fc" id="L260">            editor = new DataTableColumnEditor();</span>
        }

<span class="fc" id="L263">        editor.setPropertiesFromField(field);</span>

<span class="fc bfc" id="L265" title="All 2 branches covered.">        if (editor.isRequired()) addClassName(&quot;required&quot;);</span>

<span class="pc bpc" id="L267" title="1 of 8 branches missed.">        if (Tools.isEmpty(editor.getMessage()) &amp;&amp; Tools.isNotEmpty(titleKeyOriginal) &amp;&amp; &quot;&amp;nbsp&quot;.equals(titleKeyOriginal)==false &amp;&amp; &quot;&amp;nbsp;&quot;.equals(titleKeyOriginal)==false) {</span>
<span class="fc" id="L268">            String key = titleKeyOriginal+&quot;.tooltip&quot;;</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">            if (key.startsWith(&quot;[[#{&quot;)) {</span>
<span class="fc" id="L270">                key = Tools.replace(key, &quot;[[#{&quot;, &quot;&quot;);</span>
<span class="fc" id="L271">                key = Tools.replace(key, &quot;}]]&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L273">            String translated = DataTableColumnsFactory.translate(key);</span>
<span class="pc bpc" id="L274" title="1 of 4 branches missed.">            if (Tools.isNotEmpty(translated) &amp;&amp; key.equals(translated)==false) {</span>
<span class="fc" id="L275">                editor.setMessage(translated);</span>
            }
        }

<span class="fc bfc" id="L279" title="All 2 branches covered.">        if (editor.isEmpty()) {</span>
<span class="fc" id="L280">            this.editor = null;</span>
        }
<span class="fc" id="L282">    }</span>

    /**
     * Metoda nastavi do JSONu atributy, podla toho, ako je natavena anotacia
     * inputType {@link DataTableColumnType}
     *
     * @param dataTableColumnType - {@link DataTableColumnType} - nastaveny v
     *                            anotacii inputType
     */
    private void setPropertiesFromType(DataTableColumnType dataTableColumnType, sk.iway.iwcm.system.datatable.annotations.DataTableColumn annotation, Prop prop) {
<span class="fc bfc" id="L292" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.ID) {</span>
<span class="pc bpc" id="L293" title="1 of 2 branches missed.">            if (Tools.isEmpty(data)) {</span>
<span class="nc" id="L294">                data = &quot;id&quot;;</span>
            }
<span class="fc" id="L296">            defaultContent = &quot;&quot;;</span>
<span class="fc" id="L297">            addClassName(&quot;dt-select-td&quot;);</span>
<span class="fc" id="L298">            renderFormat = &quot;dt-format-selector&quot;;</span>
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L300">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L302">            editor.setType(&quot;hidden&quot;);</span>
        }

<span class="fc bfc" id="L305" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.TEXT) {</span>
<span class="fc" id="L306">            renderFormat = &quot;dt-format-text&quot;;</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L308">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L310">            editor.setType(&quot;text&quot;);</span>
        }

<span class="fc bfc" id="L313" title="All 4 branches covered.">        if (dataTableColumnType == DataTableColumnType.TEXT_NUMBER || dataTableColumnType == DataTableColumnType.NUMBER) {</span>
<span class="fc" id="L314">            renderFormat = &quot;dt-format-number&quot;;</span>
<span class="fc bfc" id="L315" title="All 2 branches covered.">            if (dataTableColumnType == DataTableColumnType.TEXT_NUMBER) renderFormat+=&quot;--text&quot;;</span>
<span class="fc" id="L316">            addClassName(&quot;dt-style-number&quot;);</span>

<span class="pc bpc" id="L318" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L319">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L321">            editor.setType(&quot;text&quot;);</span>
<span class="fc" id="L322">            HashMap&lt;String, String&gt; attrs = new HashMap&lt;&gt;();</span>
<span class="fc" id="L323">            attrs.put(&quot;type&quot;, &quot;number&quot;);</span>
<span class="fc" id="L324">            editor.setAttr(attrs);</span>
        }

<span class="fc bfc" id="L327" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.TEXT_NUMBER_INVISIBLE) {</span>
<span class="fc" id="L328">            renderFormat = &quot;dt-format-none&quot;;</span>
<span class="fc" id="L329">            visible = false;</span>

<span class="pc bpc" id="L331" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L332">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L334">            editor.setType(&quot;text&quot;);</span>
<span class="fc" id="L335">            HashMap&lt;String, String&gt; attrs = new HashMap&lt;&gt;();</span>
<span class="fc" id="L336">            attrs.put(&quot;type&quot;, &quot;number&quot;);</span>
<span class="fc" id="L337">            editor.setAttr(attrs);</span>
        }

<span class="fc bfc" id="L340" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.QUILL) {</span>
<span class="fc" id="L341">            renderFormat = &quot;dt-format-text&quot;;</span>
<span class="pc bpc" id="L342" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L343">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L345">            editor.setType(&quot;quill&quot;);</span>
        }

<span class="fc bfc" id="L348" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.TEXTAREA) {</span>
<span class="fc" id="L349">            renderFormat = &quot;dt-format-text-wrap&quot;;</span>
<span class="fc" id="L350">            addClassName(&quot;dt-style-text-wrap&quot;);</span>

<span class="pc bpc" id="L352" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L353">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L355">            editor.setType(&quot;textarea&quot;);</span>

<span class="pc bpc" id="L357" title="1 of 4 branches missed.">            if (annotation.className()!=null &amp;&amp; annotation.className().contains(&quot;show-html&quot;)) editor.addAttr(&quot;entityDecode&quot;, &quot;false&quot;);</span>
        }

<span class="fc bfc" id="L360" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.DATE) {</span>
<span class="fc" id="L361">            renderFormat = &quot;dt-format-date&quot;;</span>
<span class="fc" id="L362">            addClassName(&quot;dt-style-date&quot;);</span>

<span class="pc bpc" id="L364" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L365">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L367">            editor.setType(&quot;date&quot;);</span>
        }

<span class="fc bfc" id="L370" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.DATETIME) {</span>
<span class="fc" id="L371">            renderFormat = &quot;dt-format-date-time&quot;;</span>
<span class="fc" id="L372">            addClassName(&quot;dt-style-date&quot;);</span>

<span class="pc bpc" id="L374" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L375">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L377">            editor.setType(&quot;datetime&quot;);</span>
        }

<span class="fc bfc" id="L380" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.TIME_HM) {</span>
<span class="fc" id="L381">            renderFormat = &quot;dt-format-time-hm&quot;;</span>
<span class="fc" id="L382">            addClassName(&quot;dt-style-date&quot;);</span>

<span class="pc bpc" id="L384" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L385">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L387">            editor.setType(&quot;timehm&quot;);</span>
        }

<span class="pc bpc" id="L390" title="1 of 2 branches missed.">        if (dataTableColumnType == DataTableColumnType.TIME_HMS) {</span>
<span class="nc" id="L391">            renderFormat = &quot;dt-format-time-hms&quot;;</span>
<span class="nc" id="L392">            addClassName(&quot;dt-style-date&quot;);</span>

<span class="nc bnc" id="L394" title="All 2 branches missed.">            if (editor == null) {</span>
<span class="nc" id="L395">                editor = new DataTableColumnEditor();</span>
            }
<span class="nc" id="L397">            editor.setType(&quot;timehms&quot;);</span>
        }

<span class="fc bfc" id="L400" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.OPEN_EDITOR) {</span>
<span class="fc" id="L401">            addClassName(&quot;dt-row-edit&quot;);</span>
<span class="fc" id="L402">            renderFormat = &quot;dt-format-text&quot;;</span>
<span class="fc" id="L403">            renderFormatLinkTemplate = &quot;javascript:;&quot;;</span>
<span class="fc" id="L404">            renderFormatPrefix = &quot;&lt;i class=\&quot;ti ti-pencil\&quot;&gt;&lt;/i&gt; &quot;;</span>

<span class="pc bpc" id="L406" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L407">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L409">            editor.setType(&quot;text&quot;);</span>
        }

<span class="fc bfc" id="L412" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.DISABLED) {</span>
<span class="pc bpc" id="L413" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L414">                editor = new DataTableColumnEditor();</span>
            }

<span class="fc" id="L417">            editor.addAttr(&quot;disabled&quot;, &quot;disabled&quot;);</span>
        }

<span class="fc bfc" id="L420" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.GALLERY_IMAGE) {</span>
<span class="fc" id="L421">            title = &quot;&quot;;</span>
<span class="fc" id="L422">            hidden = Boolean.FALSE;</span>
        }

<span class="fc bfc" id="L425" title="All 4 branches covered.">        if (dataTableColumnType == DataTableColumnType.SELECT || dataTableColumnType == DataTableColumnType.MULTISELECT) {</span>
<span class="fc" id="L426">            renderFormat = &quot;dt-format-select&quot;;</span>
<span class="fc bfc" id="L427" title="All 2 branches covered.">            if (editor == null) {</span>
<span class="fc" id="L428">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L430">            editor.setType(&quot;select&quot;);</span>

<span class="fc bfc" id="L432" title="All 2 branches covered.">            if (dataTableColumnType == DataTableColumnType.MULTISELECT) {</span>
<span class="fc" id="L433">                editor.setMultiple(Boolean.TRUE);</span>
                //editor.addAttr(&quot;multiple&quot;, &quot;multiple&quot;);
            }

<span class="pc bpc" id="L437" title="1 of 2 branches missed.">            if (editor.getOptions() == null) {</span>
<span class="fc" id="L438">                editor.setOptions(new ArrayList&lt;&gt;());</span>
            }
        }

<span class="fc bfc" id="L442" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.BOOLEAN) {</span>
<span class="fc" id="L443">            renderFormat = &quot;dt-format-boolean-true&quot;;</span>
<span class="pc bpc" id="L444" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L445">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L447">            editor.setType(&quot;checkbox&quot;);</span>
        }

<span class="fc bfc" id="L450" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.BOOLEAN_TEXT) {</span>
<span class="fc" id="L451">            renderFormat = &quot;dt-format-boolean-true&quot;;</span>
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L453">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L455">            editor.setType(&quot;checkbox&quot;);</span>
<span class="pc bpc" id="L456" title="1 of 2 branches missed.">            if (editor.getOptions() == null) {</span>
<span class="fc" id="L457">                List&lt;LabelValue&gt; options = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L458">                options.add(new LabelValue(prop.getText(annotation.title()), &quot;true&quot;));</span>
<span class="fc" id="L459">                editor.setOptions(options);</span>
            }
        }

<span class="fc bfc" id="L463" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.CHECKBOX) {</span>
<span class="fc" id="L464">            renderFormat = &quot;dt-format-checkbox&quot;;</span>
<span class="pc bpc" id="L465" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L466">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L468">            editor.setType(&quot;checkbox&quot;);</span>
        }

<span class="fc bfc" id="L471" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.JSON) {</span>
<span class="fc" id="L472">            renderFormat = &quot;dt-format-json&quot;;</span>
<span class="fc" id="L473">            addClassName(&quot;dt-style-json&quot;);</span>

<span class="fc bfc" id="L475" title="All 2 branches covered.">            if (editor == null) {</span>
<span class="fc" id="L476">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L478">            editor.setType(&quot;json&quot;);</span>
        }

<span class="fc bfc" id="L481" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.DATATABLE) {</span>
<span class="fc" id="L482">            renderFormat = &quot;dt-format-datatable&quot;;</span>

<span class="pc bpc" id="L484" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L485">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L487">            editor.setType(&quot;datatable&quot;);</span>
        }

<span class="fc bfc" id="L490" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.ELFINDER) {</span>
<span class="fc" id="L491">            renderFormat = &quot;dt-format-elfinder&quot;;</span>

<span class="pc bpc" id="L493" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L494">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L496">            editor.setType(&quot;elfinder&quot;);</span>
        }

<span class="fc bfc" id="L499" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.WYSIWYG) {</span>
<span class="fc" id="L500">            renderFormat = &quot;dt-format-wysiwyg&quot;;</span>
<span class="fc" id="L501">            addClassName(&quot;dt-style-wysiwyg&quot;);</span>
<span class="fc" id="L502">            addClassName(&quot;cell-not-editable&quot;);</span>

<span class="pc bpc" id="L504" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L505">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L507">            editor.setType(&quot;wysiwyg&quot;);</span>
        }

<span class="fc bfc" id="L510" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.JSTREE) {</span>
<span class="fc" id="L511">            renderFormat = &quot;dt-format-jstree&quot;;</span>
<span class="fc" id="L512">            addClassName(&quot;dt-style-jstree&quot;);</span>

<span class="pc bpc" id="L514" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L515">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L517">            editor.setType(&quot;jsTree&quot;);</span>
        }

<span class="fc bfc" id="L520" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.HIDDEN) {</span>
<span class="fc" id="L521">            renderFormat = &quot;dt-format-hidden&quot;;</span>
<span class="fc" id="L522">            hidden = Boolean.TRUE;</span>
<span class="pc bpc" id="L523" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L524">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L526">            editor.setType(&quot;hidden&quot;);</span>
        }

<span class="fc bfc" id="L529" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.RADIO) {</span>
<span class="fc" id="L530">            renderFormat = &quot;dt-format-radio&quot;;</span>
<span class="pc bpc" id="L531" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L532">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L534">            editor.setType(&quot;radio&quot;);</span>
        }

<span class="fc bfc" id="L537" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.PASSWORD) {</span>
<span class="fc" id="L538">            renderFormat = &quot;dt-format-text&quot;;</span>
<span class="pc bpc" id="L539" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L540">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L542">            editor.setType(&quot;password&quot;);</span>
<span class="fc" id="L543">            editor.addAttr(&quot;autocomplete&quot;, &quot;off&quot;);</span>
        }

<span class="fc bfc" id="L546" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.ATTRS) {</span>
<span class="fc" id="L547">            renderFormat = &quot;dt-format-attrs&quot;;</span>
<span class="fc" id="L548">            addClassName(&quot;dt-style-attrs&quot;);</span>

<span class="pc bpc" id="L550" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L551">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L553">            editor.setType(&quot;attrs&quot;);</span>
        }

<span class="fc bfc" id="L556" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.COLOR) {</span>
<span class="fc" id="L557">            renderFormat = &quot;dt-format-color&quot;;</span>
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L559">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L561">            editor.setType(&quot;color&quot;);</span>
        }

<span class="fc bfc" id="L564" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.IFRAME) {</span>
<span class="fc" id="L565">            renderFormat = &quot;dt-format-iframe&quot;;</span>

<span class="pc bpc" id="L567" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L568">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L570">            editor.setType(&quot;iframe&quot;);</span>
        }

<span class="fc bfc" id="L573" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.BASE64) {</span>
<span class="fc" id="L574">            renderFormat = &quot;dt-format-base64&quot;;</span>
<span class="pc bpc" id="L575" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L576">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L578">            editor.setType(&quot;base64&quot;);</span>
        }

<span class="fc bfc" id="L581" title="All 2 branches covered.">        if (dataTableColumnType == DataTableColumnType.STATIC_TEXT) {</span>
<span class="fc" id="L582">            renderFormat = &quot;dt-format-static-text&quot;;</span>
<span class="pc bpc" id="L583" title="1 of 2 branches missed.">            if (editor == null) {</span>
<span class="fc" id="L584">                editor = new DataTableColumnEditor();</span>
            }
<span class="fc" id="L586">            editor.setType(&quot;staticText&quot;);</span>
        }
<span class="fc" id="L588">    }</span>

    private void setFinalProperties(Field field) {
<span class="fc" id="L591">        sk.iway.iwcm.system.datatable.annotations.DataTableColumn annotation = field.getAnnotation(sk.iway.iwcm.system.datatable.annotations.DataTableColumn.class);</span>
<span class="pc bpc" id="L592" title="1 of 2 branches missed.">        if (annotation == null) {</span>
<span class="nc" id="L593">            return;</span>
        }
<span class="fc" id="L595">        DataTableColumnType[] inputType = annotation.inputType();</span>
<span class="fc bfc" id="L596" title="All 2 branches covered.">        if (inputType.length &gt; 0) {</span>
<span class="fc" id="L597">            DataTableColumnType dataTableColumnType = inputType[0];</span>
<span class="fc bfc" id="L598" title="All 2 branches covered.">            if (dataTableColumnType == DataTableColumnType.DATATABLE) {</span>
                try {
<span class="fc" id="L600">                    String attrName = &quot;data-dt-field-dt-columns&quot;;</span>
<span class="fc" id="L601">                    String classNameAttr = editor.getAttr().get(attrName);</span>
<span class="fc" id="L602">                    String json = new DataTableColumnsFactory(classNameAttr).getColumnsJson();</span>
<span class="fc" id="L603">                    editor.addAttr(attrName, json);</span>
<span class="nc" id="L604">                } catch (Exception e) {</span>
<span class="nc" id="L605">                    Logger.error(DataTableColumn.class, e);</span>
<span class="fc" id="L606">                }</span>
            }
        }

<span class="fc" id="L610">    }</span>

    /**
     * Nastavi className na cell-not-editable pre needitovatelne bunky (pre editaciu danej bunky)
     * @param field
     */
    private void setCellNotEditable(Field field) {
<span class="fc" id="L617">        boolean notEditable = false;</span>
<span class="fc" id="L618">        String columnType = &quot;&quot;;</span>
<span class="fc bfc" id="L619" title="All 4 branches covered.">        if (editor != null &amp;&amp; editor.getType()!=null) columnType = editor.getType();</span>
<span class="pc bpc" id="L620" title="1 of 4 branches missed.">        if (hiddenEditor!=null &amp;&amp; hiddenEditor.booleanValue()==true) notEditable = true;</span>
<span class="fc bfc" id="L621" title="All 2 branches covered.">        else if (&quot;hidden&quot;.equals(columnType)) {</span>
<span class="fc" id="L622">            notEditable = true;</span>
        }
<span class="pc bpc" id="L624" title="1 of 8 branches missed.">        else if (editor != null &amp;&amp; editor.getAttr()!=null &amp;&amp; (&quot;disabled&quot;.equals(editor.getAttr().get(&quot;disabled&quot;)) || &quot;true&quot;.equals(editor.getAttr().get(&quot;disabled&quot;)))) notEditable = true;</span>

<span class="fc bfc" id="L626" title="All 2 branches covered.">        if (notEditable) {</span>
<span class="fc" id="L627">            addClassName(&quot;cell-not-editable&quot;);</span>
        }
<span class="fc" id="L629">    }</span>

    private String toLowerUnderscore(String str) {
<span class="fc" id="L632">        String underscored = str.replaceAll(&quot;([^_A-Z])([A-Z])&quot;, &quot;$1_$2&quot;).toLowerCase();</span>
<span class="fc bfc" id="L633" title="All 2 branches covered.">        if (underscored.endsWith(&quot;_dto&quot;)) underscored = underscored.substring(0, underscored.length()-4);</span>
<span class="fc bfc" id="L634" title="All 2 branches covered.">        if (underscored.endsWith(&quot;_bean&quot;)) underscored = underscored.substring(0, underscored.length()-5);</span>
<span class="fc bfc" id="L635" title="All 2 branches covered.">        if (underscored.endsWith(&quot;_entity&quot;)) underscored = underscored.substring(0, underscored.length()-7);</span>

<span class="fc" id="L637">        return underscored;</span>
    }

    private void addClassName(String addClassName) {
<span class="pc bpc" id="L641" title="1 of 2 branches missed.">        if (Tools.isEmpty(addClassName)) return;</span>
<span class="fc bfc" id="L642" title="All 2 branches covered.">        if (Tools.isEmpty(className)) className = addClassName.trim();</span>
<span class="fc" id="L643">        else className += &quot; &quot;+addClassName.trim();</span>
<span class="fc" id="L644">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>