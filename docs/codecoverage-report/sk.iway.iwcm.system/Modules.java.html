<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Modules.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjetcms</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm.system</a> &gt; <span class="el_source">Modules.java</span></div><h1>Modules.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm.system;

import java.io.File;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.HashMap;
import java.util.Hashtable;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

import sk.iway.iwcm.Constants;
import sk.iway.iwcm.DB;
import sk.iway.iwcm.DBPool;
import sk.iway.iwcm.FileTools;
import sk.iway.iwcm.Identity;
import sk.iway.iwcm.LabelValueDetails;
import sk.iway.iwcm.Logger;
import sk.iway.iwcm.Tools;
import sk.iway.iwcm.i18n.IwayProperties;
import sk.iway.iwcm.i18n.Prop;
import sk.iway.iwcm.io.IwcmFile;

/**
 *  Modules.java - konfiguracia a povolenie modulov (globalne pre cely server)
 *
 *@Title        WebJET
 *@Company      Interway s.r.o. (www.interway.sk)
 *@Copyright    Interway s.r.o. (c) 2001-2004
 *@author       $Author: jeeff $
 *@version      $Revision: 1.69 $
 *@created      $Date: 2010/02/09 08:26:37 $
 *@modified     $Date: 2010/02/09 08:26:37 $
 */
public class Modules
{
	public static final String CONTEXT_KEY = &quot;sk.iway.iwcm.system.Modules&quot;;

	private static Map&lt;String, String&gt; modVersions;

	private List&lt;ModuleInfo&gt; modules; //NOSONAR

	static {
<span class="fc" id="L48">		modVersions = new Hashtable&lt;&gt;();</span>
<span class="fc" id="L49">	}</span>

	public static Modules getInstance()
	{
<span class="fc" id="L53">		return(getInstance(null, false));</span>
	}

	public static Modules getInstance(String enableList, boolean forceRefresh)
	{
<span class="fc bfc" id="L58" title="All 2 branches covered.">		if (forceRefresh == false)</span>
		{
<span class="pc bpc" id="L60" title="1 of 2 branches missed.">			if (Constants.getServletContext().getAttribute(CONTEXT_KEY) != null)</span>
			{
<span class="fc" id="L62">				Modules modules = (Modules)Constants.getServletContext().getAttribute(CONTEXT_KEY);</span>

<span class="fc" id="L64">				return (modules);</span>
			}
		}
<span class="fc" id="L67">		return (new Modules(enableList));</span>
	}

	/**
	 * Skratka pismen je:
	 * B = basic
	 * P = professional
	 * E = enterprise
	 * C = cestovka
	 * I = intranet
	 * D = dmail
	 * M = cloud (multi)
	 * O = open source
	 * @param enableList
	 */
	private Modules(String enableList)
<span class="fc" id="L83">	{</span>
<span class="fc" id="L84">		modVersions.put(&quot;cmp__common&quot;, &quot;BPECIDMO;c49&quot;);</span>
<span class="fc" id="L85">		modVersions.put(&quot;cmp_webjet9&quot;, &quot;BPECIDMO;c47&quot;);</span>

		//apps
<span class="fc" id="L88">		modVersions.put(&quot;cmp_app-disqus&quot;, &quot;BPECIDMO;d01&quot;);</span>
<span class="fc" id="L89">		modVersions.put(&quot;cmp_app-facebook_comments&quot;, &quot;BPECIDMO;d02&quot;);</span>
<span class="fc" id="L90">		modVersions.put(&quot;cmp_app-facebook_like&quot;, &quot;BPECIDMO;d03&quot;);</span>
<span class="fc" id="L91">		modVersions.put(&quot;cmp_app-facebook_like_box&quot;, &quot;BPECIDMO;d04&quot;);</span>
<span class="fc" id="L92">		modVersions.put(&quot;cmp_app-docsembed&quot;, &quot;BPECIDMO;d05&quot;);</span>
<span class="fc" id="L93">		modVersions.put(&quot;cmp_app-htmlembed&quot;, &quot;BPECIDMO;d06&quot;);</span>
<span class="fc" id="L94">		modVersions.put(&quot;cmp_app-smartsupp&quot;, &quot;BPECIDMO;d07&quot;);</span>
<span class="fc" id="L95">		modVersions.put(&quot;cmp_app-social_icon&quot;, &quot;BPECIDMO;d08&quot;);</span>
<span class="fc" id="L96">		modVersions.put(&quot;cmp_app-weather&quot;, &quot;BPECIDM;d09&quot;);</span>
<span class="fc" id="L97">		modVersions.put(&quot;cmp_app-date&quot;, &quot;BPECIDMO;d10&quot;);</span>
<span class="fc" id="L98">		modVersions.put(&quot;cmp_app-vyhladavanie&quot;, &quot;BPECIDMO;d11&quot;);</span>
<span class="fc" id="L99">		modVersions.put(&quot;cmp_app-slit_slider&quot;, &quot;BPECIDM;d12&quot;);</span>
<span class="fc" id="L100">		modVersions.put(&quot;cmp_app-impress_slideshow&quot;, &quot;BPECIDM;d13&quot;);</span>
<span class="fc" id="L101">		modVersions.put(&quot;cmp_app-testimonials&quot;, &quot;BPECIDM;d14&quot;);</span>
<span class="fc" id="L102">		modVersions.put(&quot;cmp_app-cookiebar&quot;, &quot;BPECIDMO;d15&quot;);</span>

		//standard moduly
<span class="fc" id="L105">		modVersions.put(&quot;cmp_abtesting&quot;, &quot;E;7c9&quot;); //WebJET AB Testovanie</span>
<span class="fc" id="L106">		modVersions.put(&quot;cmp_adminlog&quot;, &quot;BPEICDMO;c5a&quot;); //WebJET adminlog - 1990</span>
<span class="fc" id="L107">		modVersions.put(&quot;cmp_adresar&quot;, &quot;I;ec1&quot;); //WebJET adresar - 1990</span>
<span class="fc" id="L108">		modVersions.put(&quot;cmp_attributes&quot;, &quot;E;1c9&quot;); //WebJET Attributes - 9990</span>
<span class="fc" id="L109">		modVersions.put(&quot;cmp_auction&quot;, &quot;EI;1b2&quot;); //WebJET Aukcie - 1990</span>
<span class="fc" id="L110">		modVersions.put(&quot;cmp_banner&quot;, &quot;EC;26d&quot;); //WebJET Banner Manager - 5900</span>
<span class="fc" id="L111">		modVersions.put(&quot;cmp_basket&quot;, &quot;ECMI;943&quot;); //WebJET Shopping Basket - 3900</span>
<span class="fc" id="L112">		modVersions.put(&quot;cmp_bazar&quot;, &quot;PEI;bf5&quot;); //WebJET Bazzar - 3900</span>
<span class="fc" id="L113">		modVersions.put(&quot;cmp_blog&quot;, &quot;EIM;3cd&quot;); //WebJET Blog - 4900</span>
<span class="fc" id="L114">		modVersions.put(&quot;cmp_calendar&quot;, &quot;PECIM;3a1&quot;); //WebJET Event Manager - 6990</span>
<span class="fc" id="L115">		modVersions.put(&quot;cmp_carousel_slider&quot;, &quot;PECIM;15a&quot;); //WebJET Event Manager - 6990</span>
<span class="fc" id="L116">		modVersions.put(&quot;cmp_catalog&quot;, &quot;PE;427&quot;); //WebJET Catalog - 9900</span>
<span class="fc" id="L117">		modVersions.put(&quot;cmp_cestovka&quot;, &quot;C;d1c&quot;); //WebJET Cestovna Agentura - 9900</span>
<span class="fc" id="L118">		modVersions.put(&quot;cmp_clone_structure&quot;, &quot;PEI;9bc&quot;);</span>
<span class="fc" id="L119">		modVersions.put(&quot;cmp_content-block&quot;, &quot;PEI;361&quot;);</span>
<span class="fc" id="L120">		modVersions.put(&quot;cmp_counter&quot;, &quot;PEIM;671&quot;); //WebJET Counter - 990 Sk</span>
<span class="fc" id="L121">		modVersions.put(&quot;cmp_crontab&quot;, &quot;ECDIM;a01&quot;); //WebJET Crontab - 4900</span>
<span class="fc" id="L122">		modVersions.put(&quot;cmp_crypto&quot;, &quot;PECDIM;2c9&quot;); //WebJET Crypto - 499 eur</span>
<span class="fc" id="L123">		modVersions.put(&quot;cmp_data_deleting&quot;, &quot;BPECDIM;775&quot;); //WebJET Data Deleting</span>
<span class="fc" id="L124">		modVersions.put(&quot;cmp_date&quot;, &quot;BPECDIMO;775&quot;); //WebJET Date - 900</span>
<span class="fc" id="L125">		modVersions.put(&quot;cmp_db_browser&quot;, &quot;EI;f1e&quot;); //WebJET DB Browser - 6900</span>
<span class="fc" id="L126">		modVersions.put(&quot;cmp_dictionary&quot;, &quot;EI;c4a&quot;); //WebJET Dictionary - 1900</span>
<span class="fc" id="L127">		modVersions.put(&quot;cmp_dmail&quot;, &quot;EDI;617&quot;); //WebJET Distribution List - 14990</span>
<span class="fc" id="L128">		modVersions.put(&quot;cmp_docman&quot;, &quot;I;26f&quot;); //WebJET Document Management - 4900</span>
<span class="fc" id="L129">		modVersions.put(&quot;cmp_elfinder&quot;, &quot;E;c2e&quot;);</span>
<span class="fc" id="L130">		modVersions.put(&quot;cmp_emoticon&quot;, &quot;BPECIDMO;777&quot;);</span>
<span class="fc" id="L131">		modVersions.put(&quot;cmp_enumerations&quot;, &quot;PECID;3f8&quot;);</span>
<span class="fc" id="L132">		modVersions.put(&quot;cmp_export&quot;, &quot;PEIM;4f6&quot;);</span>
<span class="fc" id="L133">		modVersions.put(&quot;cmp_fileatr&quot;, &quot;EI;823&quot;);</span>
<span class="fc" id="L134">		modVersions.put(&quot;cmp_file_archiv&quot;, &quot;EI;dc1&quot;); //archiv suborov</span>
<span class="fc" id="L135">		modVersions.put(&quot;cmp_form&quot;, &quot;PECIM;9ac&quot;); //WebJET Interactive Form - 1990 Sk</span>
<span class="fc" id="L136">		modVersions.put(&quot;cmp_formsimple&quot;, &quot;PECIM;6e3&quot;); //WebJET FormSimple</span>
<span class="fc" id="L137">		modVersions.put(&quot;cmp_forum&quot;, &quot;PECIM;a51&quot;); //WebJET Forum &amp; Message Board - 3990</span>
<span class="fc" id="L138">		modVersions.put(&quot;cmp_gallery&quot;, &quot;PECIDMO;b36&quot;); //WebJET Photo Gallery - 4990</span>
<span class="fc" id="L139">		modVersions.put(&quot;cmp_gdpr&quot;, &quot;BPEIDM;7c2&quot;);</span>
<span class="fc" id="L140">		modVersions.put(&quot;cmp_graph&quot;, &quot;PEI;16d&quot;); //WebJET Graph - 4990</span>
<span class="fc" id="L141">        modVersions.put(&quot;cmp_grideditor&quot;, &quot;BPECIDMO;27f&quot;); //WebJET grideditor</span>
<span class="fc" id="L142">		modVersions.put(&quot;cmp_htmlbox&quot;, &quot;BPECIDMO;ccc&quot;); //WebJET HTMLBox - v cene</span>
<span class="fc" id="L143">		modVersions.put(&quot;cmp_helpdesk&quot;, &quot;I;9b5&quot;);</span>
<span class="fc" id="L144">		modVersions.put(&quot;cmp_intranet&quot;, &quot;I;9b6&quot;);</span>
<span class="fc" id="L145">		modVersions.put(&quot;cmp_inventory&quot;, &quot;I;a86&quot;);</span>
<span class="fc" id="L146">        modVersions.put(&quot;cmp_inzercia&quot;, &quot;I;471&quot;);</span>
<span class="fc" id="L147">		modVersions.put(&quot;cmp_kanban&quot;, &quot;I;9ba&quot;);</span>
<span class="fc" id="L148">		modVersions.put(&quot;cmp_chat&quot;, &quot;ECI;5a0&quot;); //WebJET Chat - 3990</span>
<span class="fc" id="L149">		modVersions.put(&quot;cmp_imagefont&quot;, &quot;PED;27c&quot;); //WebJET Imagefont - 1900</span>
<span class="fc" id="L150">		modVersions.put(&quot;cmp_import_web_pages&quot;, &quot;PEDI;53c&quot;); //WebJET Import Web Pages - 1900</span>
<span class="fc" id="L151">		modVersions.put(&quot;cmp_insert_script&quot;, &quot;PEIM;6a2&quot;);</span>
<span class="fc" id="L152">		modVersions.put(&quot;cmp_inquiry&quot;, &quot;PECIMO;d97&quot;); //WebJET Inquiry - 2900</span>
<span class="fc" id="L153">		modVersions.put(&quot;cmp_inquirysimple&quot;, &quot;BPECIMO;2e9&quot;); //WebJET InquirySimple</span>
<span class="fc" id="L154">		modVersions.put(&quot;cmp_json_editor&quot;, &quot;BPECIDMO;7a2&quot;);</span>
<span class="fc" id="L155">		modVersions.put(&quot;cmp_kurzy&quot;, &quot;PECI;e6c&quot;); //WebJET Exchange Rates - 450</span>
<span class="fc" id="L156">		modVersions.put(&quot;cmp_lms&quot;, &quot;I;c85&quot;);</span>
<span class="fc" id="L157">		modVersions.put(&quot;cmp_mail&quot;, &quot;I;c81&quot;);</span>
<span class="fc" id="L158">		modVersions.put(&quot;cmp_mcalendar&quot;, &quot;I;c82&quot;);</span>
<span class="fc" id="L159">		modVersions.put(&quot;cmp_map&quot;, &quot;BPECIM;ac4&quot;); //WebJET Map (Google) - 0</span>
<span class="fc" id="L160">		modVersions.put(&quot;cmp_magzilla&quot;, &quot;I;2fe&quot;); //WebJET Help Desk - 4900</span>
<span class="fc" id="L161">		modVersions.put(&quot;cmp_media&quot;, &quot;PECIDM;a82&quot;); //WebJET Media - 1990</span>
<span class="fc" id="L162">		modVersions.put(&quot;cmp_menu&quot;, &quot;BPECIDMO;f1c&quot;); //WebJET News &amp; Press Releases - 1990</span>
<span class="fc" id="L163">		modVersions.put(&quot;cmp_messages&quot;, &quot;BPECID;4e2&quot;); //WebJET Messages</span>
<span class="fc" id="L164">		modVersions.put(&quot;cmp_news&quot;, &quot;BPECIDMO;f5c&quot;); //WebJET News &amp; Press Releases - 1990</span>
<span class="fc" id="L165">		modVersions.put(&quot;cmp_organization&quot;, &quot;I;ae3&quot;);</span>
<span class="fc" id="L166">		modVersions.put(&quot;cmp_page_reactions&quot;, &quot;EI;af2&quot;);</span>
<span class="fc" id="L167">        modVersions.put(&quot;cmp_page_update_info&quot;, &quot;EI;c52&quot;); //-------WebJET Page Update Info - 1990</span>
<span class="fc" id="L168">		modVersions.put(&quot;cmp_pocasie&quot;, &quot;PECI;7c8&quot;); //WebJET pocasie - 1990</span>
<span class="fc" id="L169">		modVersions.put(&quot;cmp_popup&quot;, &quot;BPECI;111&quot;); //WebJET Popup - v cene</span>
<span class="fc" id="L170">		modVersions.put(&quot;cmp_profesia&quot;, &quot;PEI;d4d&quot;); //WebJET Profesia - 1990</span>
<span class="fc" id="L171">		modVersions.put(&quot;cmp_proxy&quot;, &quot;ECI;52c&quot;); //WebJET Proxy - 2990</span>
<span class="fc" id="L172">		modVersions.put(&quot;cmp_projects_microsite&quot;, &quot;I;46f&quot;);</span>
<span class="fc" id="L173">		modVersions.put(&quot;cmp_qa&quot;, &quot;PECIMO;2c8&quot;);  //WebJET Questions &amp; Answers - 1990</span>
<span class="fc" id="L174">		modVersions.put(&quot;cmp_quiz&quot;, &quot;EI;9c6&quot;);</span>
<span class="fc" id="L175">		modVersions.put(&quot;cmp_rating&quot;, &quot;ECI;3dd&quot;); //WebJET Rating - 900</span>
<span class="fc" id="L176">		modVersions.put(&quot;cmp_redirects&quot;, &quot;BPECIDMO;7c1&quot;); //WebJET Redirects</span>
<span class="fc" id="L177">		modVersions.put(&quot;cmp_related-pages&quot;, &quot;ECI;4c1&quot;); //WebJET Related Pages - 1900</span>
<span class="fc" id="L178">		modVersions.put(&quot;cmp_reservation&quot;, &quot;EIM;fa2&quot;); //WebJET Reservations - 2900</span>
<span class="fc" id="L179">		modVersions.put(&quot;cmp_response-header&quot;, &quot;PEIM;74c&quot;);</span>
<span class="fc" id="L180">		modVersions.put(&quot;cmp_restaurant_menu&quot;, &quot;PEIM;6c8&quot;);</span>
<span class="fc" id="L181">		modVersions.put(&quot;cmp_rss&quot;, &quot;PECIMO;5f0&quot;); //WebJET RSS Export</span>
<span class="fc" id="L182">		modVersions.put(&quot;cmp_search&quot;, &quot;PECIM;60c&quot;); //WebJET Search - 1990 Sk</span>
<span class="fc" id="L183">		modVersions.put(&quot;cmp_send_link&quot;, &quot;PECI;842&quot;); //WebJET Send Link - 1490 Sk</span>
<span class="fc" id="L184">		modVersions.put(&quot;cmp_seo&quot;, &quot;E;eb1&quot;); //WebJET SEO - 2490 Sk</span>
<span class="fc" id="L185">		modVersions.put(&quot;cmp_server_monitoring&quot;, &quot;PECIM;aea&quot;); //WebJET Send Link - 1490 Sk</span>
<span class="fc" id="L186">		modVersions.put(&quot;cmp_sharepoint&quot;, &quot;I;c84&quot;);</span>
<span class="fc" id="L187">		modVersions.put(&quot;cmp_sharing_icons&quot;, &quot;PECMO;15c&quot;); //WebJET Sharing Icons</span>
<span class="fc" id="L188">		modVersions.put(&quot;cmp_site_browser&quot;, &quot;EI;92f&quot;); //WebJET Site Browser - 900</span>
<span class="fc" id="L189">		modVersions.put(&quot;cmp_sitemap&quot;, &quot;BPECIM;701&quot;);	 //WebJET Sitemap	- 1990 Sk</span>
<span class="fc" id="L190">		modVersions.put(&quot;cmp_slider&quot;, &quot;PEIM;8a6&quot;);</span>
<span class="fc" id="L191">		modVersions.put(&quot;cmp_sms&quot;, &quot;EI;8cf&quot;); //WebJET SMS Sender - 2900</span>
<span class="fc" id="L192">		modVersions.put(&quot;cmp_stat&quot;, &quot;PECIM;f49&quot;); //WebJET Statistics - 9990 Sk</span>
<span class="fc" id="L193">		modVersions.put(&quot;cmp_structuremirroring&quot;, &quot;E;a42&quot;); //WebJET structuremirroring</span>
<span class="fc" id="L194">		modVersions.put(&quot;cmp_sync&quot;, &quot;PEI;ce2&quot;); //WebJET SyncDir - 2990</span>
<span class="fc" id="L195">		modVersions.put(&quot;cmp_tips&quot;, &quot;PECI;9d5&quot;); //WebJET Tips - 900</span>
<span class="fc" id="L196">		modVersions.put(&quot;cmp_tooltip&quot;, &quot;E;371&quot;); //WebJET Tooltip - 900</span>
<span class="fc" id="L197">		modVersions.put(&quot;cmp_user&quot;, &quot;PECDIO;ac6&quot;);</span>
<span class="fc" id="L198">		modVersions.put(&quot;cmp_uschovna&quot;, &quot;I;557&quot;);</span>
<span class="fc" id="L199">		modVersions.put(&quot;cmp_video&quot;, &quot;PEIMO;821&quot;); //Video</span>
<span class="fc" id="L200">		modVersions.put(&quot;cmp_wiki&quot;, &quot;EI;1c4&quot;); //Wiki</span>
<span class="fc" id="L201">		modVersions.put(&quot;cmp_xml&quot;, &quot;PEI;bf0&quot;);</span>
<span class="fc" id="L202">		modVersions.put(&quot;cmp_captcha&quot;, &quot;PECI;a3c&quot;); //zoznam slov pre captchu</span>

<span class="fc" id="L204">		modVersions.put(&quot;menuUsers&quot;, &quot;PECDIO;f20&quot;); //WebJET Multi-User Access - 2990 Sk, WebJET Protected Section-4990</span>
<span class="fc" id="L205">		modVersions.put(&quot;menuSync&quot;, &quot;PEI;f36&quot;); //WebJET Synchronization - 12900</span>
<span class="fc" id="L206">		modVersions.put(&quot;imageEditor&quot;, &quot;PECDIMO;f47&quot;); //WebJET Image Editor - 4900</span>

<span class="fc" id="L208">		modVersions.put(&quot;fileIndexer&quot;, &quot;EI;c21&quot;); //WebJET Extended Search - 14900</span>

<span class="fc" id="L210">		modVersions.put(&quot;multiDomain&quot;, &quot;EM;f17&quot;); //WebJET Multi Domain - 30%ceny webjetu</span>

		//standardne moduly
<span class="fc" id="L213">		modVersions.put(&quot;menu.users&quot;, &quot;PECDIOM;c01&quot;); //standardny modul Pouzivatelia</span>
<span class="fc" id="L214">		modVersions.put(&quot;menu.fbrowser&quot;, &quot;BPECDIM;c02&quot;); //standardny modul Subory</span>
<span class="fc" id="L215">		modVersions.put(&quot;menu.templates&quot;, &quot;BPECDIOM;c03&quot;); //standardny modul Sablony</span>


		//WebJET Active Directory Access - 24.900

		try
		{
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">			if (Tools.isNotEmpty(enableList))</span>
			{
				String key;
				String modName;
				String modPerms;
<span class="nc" id="L227">				int failsafe = 0;</span>
<span class="nc bnc" id="L228" title="All 4 branches missed.">				while (enableList.length() &gt; 2 &amp;&amp; failsafe &lt; 50)</span>
				{
<span class="nc" id="L230">					key = enableList.substring(0, 3);</span>
<span class="nc" id="L231">					enableList = enableList.substring(3);</span>
<span class="nc" id="L232">					failsafe++;</span>

					//preiteruj moduly a povol
<span class="nc bnc" id="L235" title="All 2 branches missed.">					for (Map.Entry&lt;String, String&gt; entry : modVersions.entrySet())</span>
					{
<span class="nc" id="L237">						modName = entry.getKey();</span>
<span class="nc" id="L238">						modPerms = entry.getValue();</span>

						//Logger.println(this,&quot;--&gt; testujem: &quot; + key + &quot; &quot; + modName + &quot; &quot; + modPerms);

<span class="nc bnc" id="L242" title="All 4 branches missed.">						if (modPerms!=null &amp;&amp; modPerms.endsWith(&quot;;&quot;+key))</span>
						{
							//povol modul
							//Logger.println(this,&quot;--&gt; povolujem: &quot; + modName);
<span class="nc" id="L246">							modVersions.put(modName, &quot;BPEDCIDMO;&quot;+key);</span>
<span class="nc" id="L247">							break;</span>
						}
<span class="nc" id="L249">					}</span>
				}
			}
		}
<span class="nc" id="L253">		catch (Exception ex1)</span>
		{
<span class="nc" id="L255">			Logger.error(Modules.class, ex1);</span>
<span class="fc" id="L256">		}</span>

<span class="fc" id="L258">		modules = new ArrayList&lt;&gt;();</span>

		try
		{
			//natiahni komponenty
<span class="fc" id="L263">			IwcmFile[] components = (new IwcmFile(Tools.getRealPath(&quot;/components&quot;))).listFiles();</span>
<span class="fc" id="L264">			IwcmFile[] apps = (new IwcmFile(Tools.getRealPath(&quot;/apps&quot;))).listFiles();</span>

<span class="fc" id="L266">			List&lt;IwcmFile&gt; files = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L267">			files.addAll(Arrays.asList(components));</span>
<span class="pc bpc" id="L268" title="2 of 4 branches missed.">			if (apps != null &amp;&amp; apps.length&gt;0) files.addAll(Arrays.asList(apps));</span>

			ModuleInfo m;
			String wjPerms;
			IwcmFile propFile;
			IwayProperties prop;
			String sTmp;
			//Logger.debug(Modules.class, &quot;components.size=&quot;+size);
<span class="fc bfc" id="L276" title="All 2 branches covered.">			for (IwcmFile file : files)</span>
			{
<span class="fc" id="L278">				String baseDir = &quot;/components/&quot;;</span>
<span class="fc" id="L279">				String propertiesPrefix = &quot;components.&quot;;</span>
<span class="fc bfc" id="L280" title="All 2 branches covered.">				if (file.getAbsolutePath().contains(File.separatorChar+&quot;apps&quot;+File.separatorChar)) {</span>
<span class="fc" id="L281">					baseDir = &quot;/apps/&quot;;</span>
<span class="fc" id="L282">					propertiesPrefix = &quot;apps.&quot;;</span>
				}

				//Logger.debug(Modules.class, &quot;components[&quot;+i+&quot;]=&quot;+components[i].getAbsolutePath()+&quot; isDir=&quot;+components[i].isDirectory());
<span class="fc bfc" id="L286" title="All 2 branches covered.">				if (file.isDirectory())</span>
				{
<span class="fc bfc" id="L288" title="All 2 branches covered.">					for (int j=0; j&lt;30; j++)</span>
					{
<span class="fc" id="L290">		         		m = new ModuleInfo();</span>
<span class="fc" id="L291">						m.setNameKey(propertiesPrefix+file.getName()+&quot;.title&quot;);</span>
<span class="fc" id="L292">						m.setItemKey(&quot;cmp_&quot;+file.getName());</span>
<span class="fc" id="L293">						m.setPath(baseDir+file.getName());</span>
<span class="fc" id="L294">						m.setUserItem(false);</span>
<span class="fc" id="L295">						wjPerms = modVersions.get(m.getItemKey());</span>
<span class="fc bfc" id="L296" title="All 2 branches covered.">						if (wjPerms == null) wjPerms = &quot;BPECIDMO&quot;;</span>
<span class="fc" id="L297">						m.setWjVersions(wjPerms);</span>

<span class="fc" id="L299">						String fileName = &quot;modinfo.properties&quot;;</span>
<span class="fc bfc" id="L300" title="All 2 branches covered.">						if (j&gt;0) fileName = &quot;modinfo&quot;+j+&quot;.properties&quot;;</span>

<span class="fc" id="L302">						propFile = new IwcmFile(Tools.getRealPath(baseDir+file.getName()+&quot;/&quot;+fileName));</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">						if (propFile.exists())</span>
						{
							//Logger.debug(Modules.class, &quot;Loading: &quot;+baseDir+file.getName()+&quot;/&quot;+fileName);

							//nahraj prop subor a nastav hodnoty
<span class="fc" id="L308">							prop = new IwayProperties(&quot;iso-8859-1&quot;);</span>
<span class="fc" id="L309">							prop.load(propFile);</span>

							//Logger.debug(Modules.class, &quot;size: &quot;+prop.entrySet().size());
<span class="fc bfc" id="L312" title="All 2 branches covered.">							if (prop.entrySet().size() &lt; 2)</span>
							{
								//nepodari sa resetnut stream, skusme ako utf-8
<span class="fc" id="L315">								prop = new IwayProperties(&quot;utf-8&quot;);</span>
<span class="fc" id="L316">								prop.load(propFile);</span>
							}

<span class="fc" id="L319">							sTmp = prop.getProperty(&quot;userItem&quot;);</span>
<span class="fc bfc" id="L320" title="All 2 branches covered.">							if (&quot;true&quot;.equals(sTmp))</span>
							{
<span class="fc" id="L322">								m.setUserItem(true);</span>
							}
<span class="fc" id="L324">							sTmp = prop.getProperty(&quot;leftMenuLink&quot;);</span>
<span class="fc bfc" id="L325" title="All 2 branches covered.">							if (Tools.isNotEmpty(sTmp))</span>
							{
<span class="fc" id="L327">								m.setLeftMenuLink(sTmp.trim());</span>
<span class="fc" id="L328">								m.setShowInLeftMenu(true);</span>
							}
<span class="fc" id="L330">							sTmp = prop.getProperty(&quot;leftMenuNameKey&quot;);</span>
<span class="fc bfc" id="L331" title="All 2 branches covered.">							if (Tools.isNotEmpty(sTmp))</span>
							{
<span class="fc" id="L333">								m.setLeftMenuNameKey(sTmp.trim());</span>
							}
<span class="fc" id="L335">							sTmp = prop.getProperty(&quot;itemKey&quot;);</span>
<span class="fc bfc" id="L336" title="All 2 branches covered.">							if (Tools.isNotEmpty(sTmp))</span>
							{
<span class="fc" id="L338">								m.setItemKey(sTmp.trim());</span>
							}
<span class="fc" id="L340">							sTmp = prop.getProperty(&quot;menuOrder&quot;);</span>
<span class="fc bfc" id="L341" title="All 2 branches covered.">							if (Tools.isNotEmpty(sTmp))</span>
							{
<span class="fc" id="L343">								m.setMenuOrder(Tools.getIntValue(sTmp, 0));</span>
							}
<span class="fc" id="L345">							sTmp = prop.getProperty(&quot;defaultDisabled&quot;);</span>
<span class="fc bfc" id="L346" title="All 4 branches covered.">							if (sTmp!=null &amp;&amp; &quot;true&quot;.equals(sTmp.trim()))</span>
							{
<span class="fc" id="L348">								m.setDefaultDisabled(true);</span>
							}
<span class="fc" id="L350">							sTmp = prop.getProperty(&quot;requireConstantsKey&quot;);</span>
<span class="pc bpc" id="L351" title="1 of 2 branches missed.">							if (Tools.isNotEmpty(sTmp))</span>
							{
<span class="nc" id="L353">								m.setRequireConstantsKey(sTmp.trim());</span>
							}
<span class="fc" id="L355">							sTmp = prop.getProperty(&quot;showSubcategories&quot;);</span>
<span class="fc bfc" id="L356" title="All 4 branches covered.">							if (sTmp!=null &amp;&amp; &quot;true&quot;.equals(sTmp.trim()))</span>
							{
<span class="fc" id="L358">								m.setShowSubCategories(true);</span>
							}
<span class="fc" id="L360">							sTmp = prop.getProperty(&quot;hideSubmenu&quot;);</span>
<span class="fc bfc" id="L361" title="All 4 branches covered.">							if (sTmp!=null &amp;&amp; &quot;true&quot;.equals(sTmp.trim()))</span>
							{
<span class="fc" id="L363">								m.setHideSubmenu(true);</span>
							}

<span class="fc" id="L366">							sTmp = prop.getProperty(&quot;installName&quot;);</span>
							//installName moze byt zapisane ako vubweb,vubintra
<span class="pc bpc" id="L368" title="3 of 4 branches missed.">							if (Tools.isNotEmpty(sTmp) &amp;&amp; (&quot;,&quot;+sTmp.trim()+&quot;,&quot;).indexOf(&quot;,&quot;+Constants.getInstallName()+&quot;,&quot;)==-1)</span>
							{
								//tento modul je custom, preskakujem
<span class="nc" id="L371">								continue;</span>
							}

<span class="fc" id="L374">							sTmp = prop.getProperty(&quot;isCustom&quot;);</span>
<span class="fc bfc" id="L375" title="All 2 branches covered.">							if (Tools.isEmpty(sTmp)) sTmp = prop.getProperty(&quot;custom&quot;);</span>
<span class="fc bfc" id="L376" title="All 2 branches covered.">							if (&quot;true&quot;.equals(sTmp))</span>
							{
<span class="fc" id="L378">								m.setCustom(true);</span>
							}

<span class="fc" id="L381">							sTmp = prop.getProperty(&quot;group&quot;);</span>
<span class="fc bfc" id="L382" title="All 2 branches covered.">							if (Tools.isEmpty(sTmp)) sTmp = &quot;components&quot;;</span>
<span class="fc" id="L383">							m.setGroup(sTmp.trim());</span>

<span class="fc" id="L385">							sTmp = prop.getProperty(&quot;icon&quot;);</span>
<span class="fc bfc" id="L386" title="All 2 branches covered.">							if (Tools.isEmpty(sTmp)) sTmp = &quot;&quot;;</span>
<span class="fc" id="L387">							m.setMenuIcon(sTmp.trim());</span>

<span class="fc" id="L389">							sTmp = prop.getProperty(&quot;domainName&quot;);</span>
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">							if (Tools.isEmpty(sTmp)) sTmp = &quot;&quot;;</span>
<span class="fc" id="L391">							m.setDomainName(sTmp.trim());</span>

							//nacitaj submenus
<span class="fc bfc" id="L394" title="All 2 branches covered.">							for (int s=1; s&lt;25; s++)</span>
							{
<span class="fc" id="L396">								String nameKey = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;NameKey&quot;);</span>
<span class="fc" id="L397">								String link = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;Link&quot;);</span>
<span class="pc bpc" id="L398" title="1 of 4 branches missed.">								if (Tools.isNotEmpty(nameKey) &amp;&amp; Tools.isNotEmpty(link))</span>
								{
<span class="fc" id="L400">									ModuleInfo subModule = new ModuleInfo();</span>

<span class="fc" id="L402">									subModule.setPath(baseDir+file.getName());</span>
<span class="fc" id="L403">									subModule.setWjVersions(wjPerms);</span>

<span class="fc" id="L405">									subModule.setNameKey(nameKey);</span>
<span class="fc" id="L406">									subModule.setLeftMenuLink(link);</span>

<span class="fc" id="L408">									sTmp = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;UserItem&quot;);</span>
<span class="fc bfc" id="L409" title="All 4 branches covered.">									if (sTmp!=null &amp;&amp; &quot;true&quot;.equals(sTmp.trim())) subModule.setUserItem(true);</span>
<span class="fc" id="L410">									else subModule.setUserItem(false);</span>

<span class="fc" id="L412">									sTmp = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;ItemKey&quot;);</span>
<span class="fc bfc" id="L413" title="All 2 branches covered.">									if (Tools.isNotEmpty(sTmp)) subModule.setItemKey(sTmp.trim());</span>

<span class="fc" id="L415">									sTmp = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;DefaultDisabled&quot;);</span>
<span class="fc bfc" id="L416" title="All 4 branches covered.">									if (&quot;true&quot;.equals(sTmp) || m.isDefaultDisabled()) subModule.setDefaultDisabled(true);</span>

<span class="fc" id="L418">									sTmp = prop.getProperty(&quot;leftSubmenu&quot;+s+&quot;Icon&quot;);</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">									if (Tools.isNotEmpty(sTmp)) subModule.setMenuIcon(sTmp.trim());</span>

<span class="fc" id="L421">									setAvailable(subModule);</span>
<span class="fc" id="L422">									m.addSubmenu(subModule);</span>
								}
							}

							//nacitaj subcomponents
<span class="fc bfc" id="L427" title="All 2 branches covered.">							for (int s=1; s&lt;15; s++)</span>
							{
<span class="fc" id="L429">								String nameKey = prop.getProperty(&quot;component&quot;+s+&quot;NameKey&quot;);</span>
<span class="fc" id="L430">								String link =    prop.getProperty(&quot;component&quot;+s+&quot;Link&quot;);</span>
<span class="fc" id="L431">								String icon =    prop.getProperty(&quot;component&quot;+s+&quot;Icon&quot;);</span>
<span class="pc bpc" id="L432" title="3 of 4 branches missed.">								if (Tools.isNotEmpty(nameKey) &amp;&amp; Tools.isNotEmpty(link))</span>
								{
<span class="nc bnc" id="L434" title="All 2 branches missed.">									if (Tools.isNotEmpty(icon)) icon = icon.trim();</span>

<span class="nc" id="L436">									LabelValueDetails lvd = new LabelValueDetails();</span>
<span class="nc" id="L437">									lvd.setLabel(nameKey.trim());</span>
<span class="nc" id="L438">									lvd.setValue(link.trim());</span>
<span class="nc" id="L439">									lvd.setValue2(icon);</span>

<span class="nc" id="L441">									m.addComponent(lvd);</span>
								}
							}
						}

						//Logger.println(this,&quot;HASH: &quot; + m.getItemKey().hashCode());
<span class="fc bfc" id="L447" title="All 4 branches covered.">						if (j==0 || propFile.exists()) loadModule(m);</span>
					}
				}
<span class="fc" id="L450">			}</span>
		}
<span class="nc" id="L452">		catch (Exception e)</span>
		{
<span class="nc" id="L454">			Logger.error(Modules.class, e);</span>
<span class="fc" id="L455">		}</span>

<span class="fc" id="L457">		ModuleInfo welcome = new ModuleInfo(&quot;welcome.left_menu&quot;, &quot;welcome&quot;, &quot;/admin/v9/dist/views/dashboard/overview.html&quot;, null, false, true, &quot;/admin/&quot;, &quot;BPECDIMO&quot;, 5).setGroup(&quot;welcome&quot;).setMenuIcon(&quot;home&quot;);</span>
<span class="fc" id="L458">		loadModule(welcome);</span>

<span class="fc" id="L460">		ModuleInfo webSites = new ModuleInfo(&quot;menu.web_sites&quot;, &quot;menuWebpages&quot;, &quot;/admin/v9/dist/views/webpages/web-pages-list.html&quot;, null, true, true, &quot;/admin/webpages/&quot;, &quot;BPECDIMO&quot;, 10);</span>
<span class="fc" id="L461">		webSites.setGroup(&quot;website&quot;);</span>
<span class="fc" id="L462">		webSites.setMenuIcon(&quot;docs&quot;);</span>
		ModuleInfo sub;

<span class="fc" id="L465">		sub = new ModuleInfo();</span>
<span class="fc" id="L466">		sub.setNameKey(&quot;user.miniEditMenu&quot;);</span>
<span class="fc" id="L467">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L468">		sub.setWjVersions(&quot;BPECDIO&quot;);</span>
<span class="fc" id="L469">		sub.setUserItem(true);</span>
<span class="fc" id="L470">		sub.setItemKey(&quot;editorMiniEdit&quot;);</span>
<span class="fc" id="L471">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L472">		setAvailable(sub);</span>
<span class="fc" id="L473">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L475">		sub = new ModuleInfo();</span>
<span class="fc" id="L476">		sub.setNameKey(&quot;components.user.perms.addPage&quot;);</span>
<span class="fc" id="L477">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L478">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L479">		sub.setUserItem(true);</span>
<span class="fc" id="L480">		sub.setItemKey(&quot;addPage&quot;);</span>
<span class="fc" id="L481">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L482">		setAvailable(sub);</span>
<span class="fc" id="L483">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L485">		sub = new ModuleInfo();</span>
<span class="fc" id="L486">		sub.setNameKey(&quot;components.user.perms.pageSave&quot;);</span>
<span class="fc" id="L487">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L488">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L489">		sub.setUserItem(true);</span>
<span class="fc" id="L490">		sub.setItemKey(&quot;pageSave&quot;);</span>
<span class="fc" id="L491">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L492">		setAvailable(sub);</span>
<span class="fc" id="L493">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L495">		sub = new ModuleInfo();</span>
<span class="fc" id="L496">		sub.setNameKey(&quot;components.user.perms.pageSaveAs&quot;);</span>
<span class="fc" id="L497">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L498">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L499">		sub.setUserItem(true);</span>
<span class="fc" id="L500">		sub.setItemKey(&quot;pageSaveAs&quot;);</span>
<span class="fc" id="L501">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L502">		setAvailable(sub);</span>
<span class="fc" id="L503">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L505">		sub = new ModuleInfo();</span>
<span class="fc" id="L506">		sub.setNameKey(&quot;components.user.perms.deletePage&quot;);</span>
<span class="fc" id="L507">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L508">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L509">		sub.setUserItem(true);</span>
<span class="fc" id="L510">		sub.setItemKey(&quot;deletePage&quot;);</span>
<span class="fc" id="L511">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L512">		setAvailable(sub);</span>
<span class="fc" id="L513">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L515">		sub = new ModuleInfo();</span>
<span class="fc" id="L516">		sub.setNameKey(&quot;components.user.perms.editDir&quot;);</span>
<span class="fc" id="L517">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L518">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L519">		sub.setUserItem(true);</span>
<span class="fc" id="L520">		sub.setItemKey(&quot;editDir&quot;);</span>
<span class="fc" id="L521">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L522">		setAvailable(sub);</span>
<span class="fc" id="L523">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L525">		sub = new ModuleInfo();</span>
<span class="fc" id="L526">		sub.setNameKey(&quot;components.user.perms.addSubdir&quot;);</span>
<span class="fc" id="L527">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L528">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L529">		sub.setUserItem(true);</span>
<span class="fc" id="L530">		sub.setItemKey(&quot;addSubdir&quot;);</span>
<span class="fc" id="L531">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L532">		setAvailable(sub);</span>
<span class="fc" id="L533">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L535">		sub = new ModuleInfo();</span>
<span class="fc" id="L536">		sub.setNameKey(&quot;components.user.perms.deleteDir&quot;);</span>
<span class="fc" id="L537">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L538">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L539">		sub.setUserItem(true);</span>
<span class="fc" id="L540">		sub.setItemKey(&quot;deleteDir&quot;);</span>
<span class="fc" id="L541">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L542">		setAvailable(sub);</span>
<span class="fc" id="L543">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L545">		sub = new ModuleInfo();</span>
<span class="fc" id="L546">		sub.setNameKey(&quot;components.user.perms.editPerexGroups&quot;);</span>
<span class="fc" id="L547">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L548">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L549">		sub.setUserItem(true);</span>
<span class="fc" id="L550">		sub.setItemKey(&quot;editor_edit_perex&quot;);</span>
<span class="fc" id="L551">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L552">		setAvailable(sub);</span>
<span class="fc" id="L553">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L555">		sub = new ModuleInfo();</span>
<span class="fc" id="L556">		sub.setNameKey(&quot;components.user.perms.editMediaGroups&quot;);</span>
<span class="fc" id="L557">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L558">		sub.setWjVersions(&quot;BPECIM&quot;);</span>
<span class="fc" id="L559">		sub.setUserItem(true);</span>
<span class="fc" id="L560">		sub.setItemKey(&quot;editor_edit_media_group&quot;);</span>
<span class="fc" id="L561">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L562">		setAvailable(sub);</span>
<span class="fc" id="L563">		webSites.addSubmenu(sub);</span>

<span class="fc" id="L565">      sub = new ModuleInfo();</span>
<span class="fc" id="L566">      sub.setNameKey(&quot;groupedit.showHiddenFolders&quot;);</span>
<span class="fc" id="L567">      sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L568">      sub.setWjVersions(&quot;PECDIMO&quot;);</span>
<span class="fc" id="L569">      sub.setUserItem(true);</span>
<span class="fc" id="L570">      sub.setItemKey(&quot;editor_show_hidden_folders&quot;);</span>
<span class="fc" id="L571">      sub.setDefaultDisabled(true);</span>
<span class="fc" id="L572">      setAvailable(sub);</span>
<span class="fc" id="L573">      webSites.addSubmenu(sub);</span>

<span class="fc" id="L575">      loadModule(webSites);</span>

<span class="fc" id="L577">		sub = new ModuleInfo();</span>
<span class="fc" id="L578">		sub.setNameKey(&quot;components.user.perms.unlimitedUpload&quot;);</span>
<span class="fc" id="L579">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L580">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L581">		sub.setUserItem(true);</span>
<span class="fc" id="L582">		sub.setItemKey(&quot;editor_unlimited_upload&quot;);</span>
<span class="fc" id="L583">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L584">		sub.setGroup(&quot;files&quot;);</span>
<span class="fc" id="L585">		setAvailable(sub);</span>
<span class="fc" id="L586">		loadModule(sub);</span>

		//sablony
<span class="fc" id="L589">		ModuleInfo templates = new ModuleInfo(&quot;menu.templates&quot;, &quot;menuTemplates&quot;, &quot;/admin/v9/dist/views/templates/temps-list.html&quot;, null, true, true, &quot;/admin/v9/templates/temps-list/&quot;, modVersions.get(&quot;menu.templates&quot;), 20).setGroup(&quot;templates&quot;).setMenuIcon(&quot;grid&quot;);</span>


<span class="fc" id="L592">		sub = new ModuleInfo();</span>
<span class="fc" id="L593">		sub.setNameKey(&quot;components.templates.dialog_title&quot;);</span>
<span class="fc" id="L594">		sub.setPath(&quot;/admin/v9/dist/views/templates/temps-list.html&quot;);</span>
<span class="fc" id="L595">		sub.setWjVersions(modVersions.get(&quot;menu.templates&quot;));</span>
<span class="fc" id="L596">		sub.setItemKey(&quot;menuTemplates&quot;);</span>
<span class="fc" id="L597">		sub.setUserItem(false);</span>
<span class="fc" id="L598">		sub.setGroup(&quot;templates&quot;);</span>
<span class="fc" id="L599">		setAvailable(sub);</span>
<span class="fc" id="L600">		templates.addSubmenu(sub);</span>

<span class="fc" id="L602">        sub = new ModuleInfo();</span>
<span class="fc" id="L603">        sub.setNameKey(&quot;menu.group_templates&quot;);</span>
<span class="fc" id="L604">        sub.setPath(&quot;/admin/v9/dist/views/templates/temps-groups-list.html&quot;);</span>
<span class="fc" id="L605">        sub.setWjVersions(modVersions.get(&quot;menu.templates&quot;));</span>
<span class="fc" id="L606">        sub.setItemKey(&quot;menuTemplatesGroup&quot;);</span>
<span class="fc" id="L607">        sub.setUserItem(true);</span>
<span class="fc" id="L608">        sub.setGroup(&quot;templates&quot;);</span>
<span class="fc" id="L609">        setAvailable(sub);</span>
<span class="fc" id="L610">        templates.addSubmenu(sub);</span>

		/*
		sub = new ModuleInfo();
		sub.setNameKey(&quot;temps_list.newTemplate&quot;);
		sub.setPath(&quot;javascript:openPopupDialogFromLeftMenu('/admin/listtemps.do?tempid=-1');&quot;);
		sub.setWjVersions(modVersions.get(&quot;menu.templates&quot;));
		sub.setUserItem(false);
		setAvailable(sub);
		templates.addSubmenu(sub);

		sub = new ModuleInfo();
		sub.setNameKey(&quot;admin.temp_merge.merge_stranok&quot;);
		sub.setPath(&quot;javascript:openPopupDialogFromLeftMenu('/admin/listtemps.do?merge=1');&quot;);
		sub.setWjVersions(modVersions.get(&quot;menu.templates&quot;));
		sub.setUserItem(false);
		setAvailable(sub);
		templates.addSubmenu(sub);

		sub = new ModuleInfo();
		sub.setNameKey(&quot;admin.temps_page_uses.pouzitie_stranok&quot;);
		sub.setPath(&quot;/admin/temps_page_uses.jsp&quot;);
		sub.setWjVersions(modVersions.get(&quot;menu.templates&quot;));
		sub.setUserItem(false);
		setAvailable(sub);
		templates.addSubmenu(sub);*/

<span class="fc" id="L637">		loadModule(templates);</span>

		//pouzivatelia
<span class="fc" id="L640">		ModuleInfo users = new ModuleInfo(&quot;menu.users&quot;, &quot;menuUsers&quot;, &quot;/components/user&quot;, null, true, true, &quot;/admin/v9/users/user-list/&quot;, modVersions.get(&quot;menu.users&quot;), 30);</span>
<span class="fc" id="L641">		users.setGroup(&quot;users&quot;);</span>
<span class="fc" id="L642">		users.setLeftMenuNameKey(&quot;menu.users&quot;);</span>
<span class="fc" id="L643">		loadModule(users);</span>

		//toto je tu kvoli menu, aby sa vypisala moznost Zoznam pouzivatelov
		/*
		sub = new ModuleInfo().setGroup(&quot;users&quot;).setMenuOrder(10);
		sub.setNameKey(&quot;users.list&quot;);
		sub.setItemKey(&quot;users.list&quot;);
		sub.setPath(&quot;/admin/listusers.do&quot;);
		sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));
		sub.setUserItem(false);
		sub.setShowInLeftMenu(true);
		setAvailable(sub);
		*/

		//sub.addSubmenu(&quot;users.list&quot;, &quot;/admin/listusers.do&quot;);
		//sub.addSubmenu(&quot;users.newUser&quot;, &quot;javascript:openPopupDialogFromLeftMenu('/admin/edituser.do?userid=-1');&quot;);
		//sub.addSubmenu(&quot;users.importFromFile&quot;, &quot;javascript:openPopupDialogFromLeftMenu('/admin/listusers.do?import=true');&quot;);
		//loadModule(sub);

<span class="pc bpc" id="L662" title="1 of 2 branches missed.">		if (&quot;cloud&quot;.equals(Constants.getInstallName())==false)</span>
		{
<span class="fc" id="L664">			sub = new ModuleInfo().setMenuOrder(10);</span>
<span class="fc" id="L665">			sub.setNameKey(&quot;users.edit_admins&quot;);</span>
<span class="fc" id="L666">			sub.setItemKey(&quot;users.edit_admins&quot;);</span>
<span class="fc" id="L667">			sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L668">			sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));</span>
<span class="fc" id="L669">			sub.setDefaultDisabled(false);</span>
<span class="fc" id="L670">			sub.setUserItem(true);</span>
<span class="fc" id="L671">			sub.setShowInLeftMenu(false);</span>

<span class="fc" id="L673">			setAvailable(sub);</span>
<span class="fc" id="L674">			users.addSubmenu(sub);</span>

<span class="fc" id="L676">			sub = new ModuleInfo().setMenuOrder(20);</span>
<span class="fc" id="L677">			sub.setNameKey(&quot;users.edit_public_users&quot;);</span>
<span class="fc" id="L678">			sub.setItemKey(&quot;users.edit_public_users&quot;);</span>
<span class="fc" id="L679">			sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L680">			sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));</span>
<span class="fc" id="L681">			sub.setDefaultDisabled(false);</span>
<span class="fc" id="L682">			sub.setUserItem(true);</span>
<span class="fc" id="L683">			sub.setShowInLeftMenu(false);</span>

<span class="fc" id="L685">			setAvailable(sub);</span>
<span class="fc" id="L686">			users.addSubmenu(sub);</span>

<span class="fc" id="L688">			sub = new ModuleInfo().setGroup(&quot;users&quot;).setMenuOrder(30);</span>
<span class="fc" id="L689">			sub.setNameKey(&quot;user.admin.editUserGroups&quot;);</span>
<span class="fc" id="L690">			sub.setItemKey(&quot;user.admin.userGroups&quot;);</span>
<span class="fc" id="L691">			sub.setPath(&quot;/admin/listusers.do?groups=true&quot;);</span>
<span class="fc" id="L692">			sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));</span>
<span class="fc" id="L693">			sub.setUserItem(true);</span>
<span class="fc" id="L694">			sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L695">			sub.setGroup(&quot;users&quot;);</span>

<span class="fc" id="L697">			setAvailable(sub);</span>
<span class="fc" id="L698">			loadModule(sub);</span>

<span class="fc" id="L700">			sub = new ModuleInfo().setGroup(&quot;users&quot;).setMenuOrder(31);</span>
<span class="fc" id="L701">			sub.setNameKey(&quot;users.edit_perm_groups&quot;);</span>
<span class="fc" id="L702">			sub.setItemKey(&quot;users.perm_groups&quot;);</span>
<span class="fc" id="L703">			sub.setPath(&quot;/admin/v9/dist/views/users/permission-groups.html&quot;);</span>
<span class="fc" id="L704">			sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));</span>
<span class="fc" id="L705">			sub.setUserItem(true);</span>
<span class="fc" id="L706">			sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L707">			sub.setGroup(&quot;users&quot;);</span>

<span class="fc" id="L709">			setAvailable(sub);</span>
<span class="fc" id="L710">			loadModule(sub);</span>

<span class="fc" id="L712">			sub = new ModuleInfo().setMenuOrder(60);</span>
<span class="fc" id="L713">			sub.setNameKey(&quot;users.welcomeShowLoggedAdmins&quot;);</span>
<span class="fc" id="L714">			sub.setItemKey(&quot;welcomeShowLoggedAdmins&quot;);</span>
<span class="fc" id="L715">			sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L716">			sub.setWjVersions(modVersions.get(&quot;menu.users&quot;));</span>
<span class="fc" id="L717">			sub.setDefaultDisabled(false);</span>
<span class="fc" id="L718">			sub.setUserItem(true);</span>
<span class="fc" id="L719">			sub.setShowInLeftMenu(false);</span>
<span class="fc" id="L720">			sub.setGroup(&quot;welcome&quot;);</span>

<span class="fc" id="L722">			setAvailable(sub);</span>
<span class="fc" id="L723">			loadModule(sub);</span>
		}

<span class="fc" id="L726">		ModuleInfo files = new ModuleInfo(&quot;menu.fbrowser&quot;, &quot;menuFbrowser&quot;, &quot;/admin/v9/files/index/&quot;, null, true, true, &quot;/admin/elFinder/&quot;, modVersions.get(&quot;menu.fbrowser&quot;), 45).setGroup(&quot;files&quot;).setMenuIcon(&quot;folder&quot;);</span>

<span class="fc" id="L728">		sub = new ModuleInfo();</span>
<span class="fc" id="L729">		sub.setNameKey(&quot;menu.fbrowser.deleteDirectory&quot;);</span>
<span class="fc" id="L730">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L731">		sub.setWjVersions(modVersions.get(&quot;menu.fbrowser&quot;));</span>
<span class="fc" id="L732">		sub.setUserItem(true);</span>
<span class="fc" id="L733">		sub.setItemKey(&quot;fbrowser_delete_directory&quot;);</span>
<span class="fc" id="L734">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L735">		setAvailable(sub);</span>
<span class="fc" id="L736">		files.addSubmenu(sub);</span>

<span class="fc" id="L738">		loadModule(files);</span>



		// Konfiguracia
<span class="fc" id="L743">		sub = new ModuleInfo().setMenuOrder(7000);</span>
<span class="fc" id="L744">		sub.setLeftMenuNameKey(&quot;webjet.left_conf.konfiguracia&quot;);</span>
<span class="fc" id="L745">		sub.setNameKey(&quot;menu.config.rights.menu_config&quot;);</span>
<span class="fc" id="L746">		sub.setPath(&quot;/admin/v9/dist/views/settings/configuration.html&quot;);</span>
<span class="fc" id="L747">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L748">		sub.setUserItem(true);</span>
<span class="fc" id="L749">		sub.setItemKey(&quot;menuConfig&quot;);</span>
<span class="fc" id="L750">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L751">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L752">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L753">		sub.setMenuIcon(&quot;wrench&quot;);</span>
<span class="fc" id="L754">		loadModule(sub);</span>

<span class="fc" id="L756">		sub = new ModuleInfo().setMenuOrder(7001);</span>
<span class="fc" id="L757">		sub.setNameKey(&quot;admin.conf.showAllvariables&quot;);</span>
<span class="fc" id="L758">		sub.setItemKey(&quot;conf.show_all_variables&quot;);</span>
<span class="fc" id="L759">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L760">		sub.setWjVersions(&quot;BPECDIMO&quot;);</span>
<span class="fc" id="L761">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L762">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L763">		sub.setUserItem(true);</span>
<span class="fc" id="L764">		sub.setShowInLeftMenu(false);</span>
<span class="fc" id="L765">		loadModule(sub);</span>

		// Aktualizacia WebJETu
<span class="fc" id="L768">		sub = new ModuleInfo().setMenuOrder(7300);</span>
<span class="fc" id="L769">		sub.setLeftMenuNameKey(&quot;admin.conf_editor.update_system&quot;);</span>
<span class="fc" id="L770">		sub.setNameKey(&quot;menu.config.rights.modUpdate&quot;);</span>
<span class="fc" id="L771">		sub.setPath(&quot;/admin/v9/settings/update/&quot;);</span>
<span class="fc" id="L772">		sub.setWjVersions(&quot;BPECDIM&quot;);</span>
<span class="fc" id="L773">		sub.setUserItem(true);</span>
<span class="fc" id="L774">		sub.setItemKey(&quot;modUpdate&quot;);</span>
<span class="fc" id="L775">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L776">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L777">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L778">		sub.setMenuIcon(&quot;refresh&quot;);</span>
<span class="fc" id="L779">		loadModule(sub);</span>

		// Editacia textov
<span class="fc" id="L782">		sub = new ModuleInfo().setMenuOrder(7020);</span>
<span class="fc" id="L783">		sub.setLeftMenuNameKey(&quot;admin.conf_editor.edit_text&quot;);</span>
<span class="fc" id="L784">		sub.setNameKey(&quot;menu.config.rights.edit_text&quot;);</span>
<span class="fc" id="L785">		sub.setPath(&quot;/admin/v9/settings/translation-keys/&quot;);</span>
<span class="fc" id="L786">		sub.setWjVersions(&quot;BPECDIM&quot;);</span>
<span class="fc" id="L787">		sub.setUserItem(true);</span>
<span class="fc" id="L788">		sub.setItemKey(&quot;edit_text&quot;);</span>
<span class="fc" id="L789">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L790">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L791">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L792">		sub.setMenuIcon(&quot;speech&quot;);</span>
<span class="fc" id="L793">		setAvailable(sub);</span>
<span class="fc" id="L794">		sub.addSubmenu(&quot;groupslist.search.title&quot;, &quot;/admin/v9/dist/views/settings/translation-keys.html&quot;);</span>
		//sub.addSubmenu(&quot;admin.conf_editor.pridat_zaznam&quot;, &quot;javascript:openPopupDialogFromLeftMenu('/admin/prop_edit.jsp?key=&amp;lng=&quot;+Constants.getString(&quot;defaultLanguage&quot;)+&quot;&amp;value=');&quot;);
		//sub.addSubmenu(&quot;admin.conf_editor.export-import&quot;, &quot;/admin/prop_export-import.jsp&quot;);
<span class="fc" id="L797">		sub.addSubmenu(&quot;admin.conf_editor.missing&quot;, &quot;/admin/prop_missing.jsp&quot;);</span>
<span class="fc" id="L798">		loadModule(sub);</span>

<span class="fc" id="L800">		sub = new ModuleInfo().setMenuOrder(7021);</span>
<span class="fc" id="L801">		sub.setNameKey(&quot;admin.prop.showAllTexts&quot;);</span>
<span class="fc" id="L802">		sub.setItemKey(&quot;prop.show_all_texts&quot;);</span>
<span class="fc" id="L803">		sub.setPath(&quot;javascript:void()&quot;);</span>
<span class="fc" id="L804">		sub.setWjVersions(&quot;BPECDIM&quot;);</span>
<span class="fc" id="L805">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L806">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L807">		sub.setUserItem(true);</span>
<span class="fc" id="L808">		sub.setShowInLeftMenu(false);</span>
<span class="fc" id="L809">		loadModule(sub);</span>

		// Export do HTML
<span class="fc" id="L812">		sub = new ModuleInfo().setMenuOrder(7100);</span>
<span class="fc" id="L813">		sub.setLeftMenuNameKey(&quot;admin.offline.dialogTitle&quot;);</span>
<span class="fc" id="L814">		sub.setNameKey(&quot;menu.config.rights.export_offline&quot;);</span>
<span class="fc" id="L815">		sub.setPath(&quot;javascript:openPopupDialogFromLeftMenu('/admin/offline.jsp');&quot;);</span>
<span class="fc" id="L816">		sub.setWjVersions(&quot;BPECI&quot;);</span>
<span class="fc" id="L817">		sub.setUserItem(true);</span>
<span class="fc" id="L818">		sub.setItemKey(&quot;export_offline&quot;);</span>
<span class="fc" id="L819">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L820">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L821">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L822">		sub.setMenuIcon(&quot;disc&quot;);</span>
<span class="fc" id="L823">		loadModule(sub);</span>

		// Restartovat
<span class="fc" id="L826">		sub = new ModuleInfo().setMenuOrder(7310);</span>
<span class="fc" id="L827">		sub.setLeftMenuNameKey(&quot;admin.conf_editor.restart&quot;);</span>
<span class="fc" id="L828">		sub.setNameKey(&quot;menu.config.rights.modRestart&quot;);</span>
<span class="fc" id="L829">		sub.setPath(&quot;javascript:confirmRestart()&quot;);</span>
<span class="fc" id="L830">		sub.setWjVersions(&quot;BPECDIM&quot;);</span>
<span class="fc" id="L831">		sub.setUserItem(true);</span>
<span class="fc" id="L832">		sub.setItemKey(&quot;modRestart&quot;);</span>
<span class="fc" id="L833">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L834">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L835">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L836">		sub.setMenuIcon(&quot;refresh&quot;);</span>
<span class="fc" id="L837">		loadModule(sub);</span>

<span class="fc" id="L839">		sub = new ModuleInfo().setMenuOrder(7290);</span>
<span class="fc" id="L840">		sub.setLeftMenuNameKey(&quot;components.user.perms.replaceAll&quot;);</span>
<span class="fc" id="L841">		sub.setNameKey(&quot;components.user.perms.replaceAll&quot;);</span>
<span class="fc" id="L842">		sub.setPath(&quot;/admin/replaceall.jsp&quot;);</span>
<span class="fc" id="L843">		sub.setWjVersions(&quot;PEDI&quot;);</span>
<span class="fc" id="L844">		sub.setUserItem(true);</span>
<span class="fc" id="L845">		sub.setItemKey(&quot;replaceAll&quot;);</span>
<span class="fc" id="L846">		sub.setDefaultDisabled(true);</span>
<span class="fc" id="L847">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L848">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L849">		loadModule(sub);</span>

		// Vytvorit ZIP archiv
<span class="fc" id="L852">		sub = new ModuleInfo().setMenuOrder(7120);</span>
<span class="fc" id="L853">		sub.setLeftMenuNameKey(&quot;admin.make_zip_archive&quot;);</span>
<span class="fc" id="L854">		sub.setNameKey(&quot;menu.config.rights.make_zip_archive&quot;);</span>
<span class="fc" id="L855">		sub.setPath(&quot;javascript:openPopupDialogFromLeftMenu('/admin/archive.jsp');&quot;);</span>
<span class="fc" id="L856">		sub.setWjVersions(&quot;BPECI&quot;);</span>
<span class="fc" id="L857">		sub.setUserItem(true);</span>
<span class="fc" id="L858">		sub.setItemKey(&quot;make_zip_archive&quot;);</span>
<span class="fc" id="L859">		sub.setDefaultDisabled(false);</span>
<span class="fc" id="L860">		sub.setGroup(&quot;config&quot;);</span>
<span class="fc" id="L861">		sub.setShowInLeftMenu(true);</span>
<span class="fc" id="L862">		sub.setMenuIcon(&quot;size-actual&quot;);</span>
<span class="fc" id="L863">		loadModule(sub);</span>

<span class="fc" id="L865">		sub = new ModuleInfo(&quot;image_editor.title&quot;, &quot;imageEditor&quot;, &quot;/admin/v9/dist/views/apps/image-editor.html&quot;, null, true, false, null, modVersions.get(&quot;imageEditor&quot;), 50);</span>
<span class="fc" id="L866">		sub.setGroup(&quot;website&quot;);</span>
<span class="fc" id="L867">		loadModule(sub);</span>

<span class="fc" id="L869">		loadModule(new ModuleInfo(&quot;fbrowse.fileIndexer&quot;, &quot;fileIndexer&quot;, &quot;/admin/fbrowser_dirprop.jsp&quot;, null, false, false, null, modVersions.get(&quot;fileIndexer&quot;), 330));</span>

<span class="fc" id="L871">		loadModule(new ModuleInfo(&quot;multiDomain&quot;, &quot;multiDomain&quot;, &quot;/admin/v9/dist/views/webpages/web-pages-list.html&quot;, &quot;multiDomainEnabled&quot;, false, false, null, modVersions.get(&quot;multiDomain&quot;), 9999));</span>

		//natiahni moduly z databazy
<span class="fc" id="L874">		Connection db_conn = null;</span>
<span class="fc" id="L875">		PreparedStatement ps = null;</span>
<span class="fc" id="L876">		ResultSet rs = null;</span>
		try
		{
<span class="fc" id="L879">			db_conn = DBPool.getConnection();</span>
<span class="fc" id="L880">			ps = db_conn.prepareStatement(&quot;SELECT * FROM &quot;+ConfDB.MODULES_TABLE_NAME+&quot; ORDER BY module_id&quot;);</span>
<span class="fc" id="L881">			rs = ps.executeQuery();</span>
			ModuleInfo mi;
<span class="pc bpc" id="L883" title="1 of 2 branches missed.">			while (rs.next())</span>
			{
<span class="nc" id="L885">				mi = new ModuleInfo(DB.getDbString(rs, &quot;name_key&quot;), DB.getDbString(rs, &quot;item_key&quot;), DB.getDbString(rs, &quot;path&quot;), null, true, true, null, &quot;BPECDIO&quot;, rs.getInt(&quot;menu_order&quot;));</span>
<span class="nc" id="L886">				mi.setFromDatabase(true);</span>
				//kontrola, ci uz taky modul neexistuje
<span class="nc bnc" id="L888" title="All 2 branches missed.">				if (isModule(mi.getItemKey())==false)</span>
				{
<span class="nc" id="L890">					loadModule(mi);</span>
				}
			}
<span class="fc" id="L893">			rs.close();</span>
<span class="fc" id="L894">			ps.close();</span>
<span class="fc" id="L895">			rs = null;</span>
<span class="fc" id="L896">			ps = null;</span>
		}
<span class="nc" id="L898">		catch (Exception ex)</span>
		{
<span class="nc" id="L900">			Logger.error(Modules.class, ex);</span>
		}
		finally
		{
			try
			{
<span class="pc bpc" id="L906" title="1 of 2 branches missed.">				if (db_conn != null)</span>
<span class="fc" id="L907">					db_conn.close();</span>
<span class="pc bpc" id="L908" title="1 of 2 branches missed.">				if (rs != null)</span>
<span class="nc" id="L909">					rs.close();</span>
<span class="pc bpc" id="L910" title="1 of 2 branches missed.">				if (ps != null)</span>
<span class="nc" id="L911">					ps.close();</span>
			}
<span class="nc" id="L913">			catch (Exception ex2)</span>
			{
<span class="nc" id="L915">				Logger.error(Modules.class, ex2);</span>
<span class="fc" id="L916">			}</span>
		}

		//usortuj ich
		//skonvertuj array list na pole
		int i;
<span class="fc" id="L922">		int size = modules.size();</span>
<span class="fc" id="L923">		ModuleInfo[] modArray = new ModuleInfo[size];</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">		for (i=0; i&lt;size; i++)</span>
		{
<span class="fc" id="L926">			modArray[i] = modules.get(i);</span>
		}

<span class="fc" id="L929">		Arrays.sort(modArray,</span>
			new Comparator&lt;ModuleInfo&gt;()
<span class="fc" id="L931">			{</span>
				@Override
				public int compare(ModuleInfo m1, ModuleInfo m2)
				{
<span class="fc" id="L935">					int order = m1.getMenuOrder() - m2.getMenuOrder();</span>
<span class="fc bfc" id="L936" title="All 2 branches covered.">					if (order == 0)</span>
					{
<span class="fc" id="L938">					   order = m1.getNameKey().compareTo(m2.getNameKey());</span>
					}
<span class="fc" id="L940">					return (order);</span>
				}
			}
		);
		//skonvertuj na array
<span class="fc" id="L945">		modules = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L946">		modules.addAll(Arrays.asList(modArray));</span>

<span class="fc" id="L948">		Constants.getServletContext().removeAttribute(CONTEXT_KEY);</span>
<span class="fc" id="L949">		Constants.getServletContext().setAttribute(CONTEXT_KEY, this);</span>
<span class="fc" id="L950">	}</span>

	/**
	 * Skontroluje, ci je modul dostupny a prida ho do zoznamu
	 * @param mi
	 */
	private void loadModule(ModuleInfo mi)
	{
		//preiteruj a pripadne zmaz ak uz existuje
<span class="fc bfc" id="L959" title="All 2 branches covered.">		for (ModuleInfo mi2 : modules)</span>
		{
<span class="fc bfc" id="L961" title="All 2 branches covered.">			if (mi2.getItemKey().equals(mi.getItemKey()))</span>
			{
				//leftMenuLink je NULL ale getter vrati path, to je dodatocna kontrola
<span class="pc bpc" id="L964" title="1 of 4 branches missed.">				if (mi.getPath().startsWith(&quot;/apps&quot;) &amp;&amp; mi.getLeftMenuLink().equals(mi.getPath())) {</span>
					//toto je autoload /apps adresara, modul uz je definovany z components, pouzijeme ten, tento novy ignorujme
					//deje sa, ked nove aplikacie vo WJ9 su v /apps adresari, ktory sa tiez inicializuje
<span class="fc" id="L967">					return;</span>
				}

				//to co je z webjet9 adresara ma vyssiu prioritu, zachovame
<span class="pc bpc" id="L971" title="1 of 2 branches missed.">				if (mi2.getPath().startsWith(&quot;/components/webjet9&quot;)) {</span>
<span class="fc" id="L972">					return;</span>
				}

<span class="nc" id="L975">				Logger.debug(Modules.class, &quot;Removing module: &quot; + mi2.getItemKey()+&quot; &quot;+mi2.getPath());</span>
<span class="nc" id="L976">				modules.remove(mi2);</span>
<span class="nc" id="L977">				break;</span>
			}
<span class="fc" id="L979">		}</span>

<span class="fc" id="L981">		setAvailable(mi);</span>
<span class="fc" id="L982">		modules.add(mi);</span>
<span class="fc" id="L983">	}</span>

	/**
	 * Skontroluje, ci pozadovany subor je dostupny, pripadne skontroluje platnost konstanty
	 * @param mi
	 */
	private void setAvailable(ModuleInfo mi)
	{
<span class="pc bpc" id="L991" title="1 of 4 branches missed.">		if (Tools.isEmpty(mi.getPath()) || Tools.isEmpty(mi.getItemKey())) return;</span>

		//System.out.println(&quot;setAvailable, mi.path=&quot;+mi.getPath()+&quot; isFile=&quot;+FileTools.isFile(mi.getPath()));
		//System.out.println(&quot;setAvailable, real=&quot;+ Tools.getRealPath(mi.getPath()));

<span class="fc" id="L996">		mi.setAvailable(false);</span>
<span class="pc bpc" id="L997" title="2 of 10 branches missed.">		if ((FileTools.exists(mi.getPath())) || mi.getLeftMenuLink().startsWith(&quot;javascript:&quot;) || mi.getPath().startsWith(&quot;javascript:&quot;) || mi.getPath().indexOf(&quot;.do&quot;)!=-1 || mi.getPath().endsWith(&quot;/&quot;))</span>
		{
<span class="fc bfc" id="L999" title="All 2 branches covered.">			if (mi.getRequireConstantsKey()!=null)</span>
			{
<span class="pc bpc" id="L1001" title="2 of 4 branches missed.">				if (Tools.isNotEmpty(Constants.getString(mi.getRequireConstantsKey())) &amp;&amp; &quot;false&quot;.equals(Constants.getString(mi.getRequireConstantsKey()))==false)</span>
				{
<span class="fc" id="L1003">					mi.setAvailable(true);</span>
				}
			}
			else
			{
<span class="fc" id="L1008">				mi.setAvailable(true);</span>
			}
		}
<span class="fc bfc" id="L1011" title="All 2 branches covered.">		if (mi.isAvailable())</span>
		{
<span class="fc" id="L1013">			Logger.println(this,&quot;Loading module: &quot; + mi.getItemKey());</span>
		}
		else
		{
<span class="fc" id="L1017">			Logger.println(this,&quot;Unloading module: &quot;+mi.getItemKey()+&quot; mi.path=&quot;+mi.getPath()+&quot; const=&quot;+mi.getRequireConstantsKey());</span>
		}
<span class="fc" id="L1019">	}</span>

	/**
	 * Vrati zoznam vsetkych modulov
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getModules()
	{
<span class="fc" id="L1027">		return(modules);</span>
	}

	/**
	 * Vrati zoznam modulov, ktore su zakazane
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getDisabledModules()
	{
<span class="nc" id="L1036">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L1038" title="All 2 branches missed.">		for (ModuleInfo mi : modules)</span>
		{
<span class="nc bnc" id="L1040" title="All 2 branches missed.">			if (mi.isAvailable() == false)</span>
			{
<span class="nc" id="L1042">				ret.add(mi);</span>
			}
<span class="nc" id="L1044">		}</span>

<span class="nc" id="L1046">		return(ret);</span>
	}

	/**
	 * Vrati zoznam dostupnych modulov
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getAvailableModules()
	{
<span class="fc" id="L1055">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L1057" title="All 2 branches covered.">		for (ModuleInfo mi : modules)</span>
		{
<span class="fc bfc" id="L1059" title="All 2 branches covered.">			if (mi.isAvailable())</span>
			{
<span class="fc" id="L1061">				ret.add(mi);</span>
			}
<span class="fc" id="L1063">		}</span>

<span class="fc" id="L1065">		return(ret);</span>
	}

	/**
	 * Otestuje, ci zadany modul je dostupny (vseobecne pre cely server)
	 * @param itemKey
	 * @return
	 */
	public boolean isAvailable(String itemKey)
	{
<span class="fc bfc" id="L1075" title="All 2 branches covered.">		for (ModuleInfo mi : modules)</span>
		{
<span class="fc bfc" id="L1077" title="All 2 branches covered.">			if (mi.getItemKey().equals(itemKey))</span>
			{
<span class="fc" id="L1079">				return(mi.isAvailable());</span>
			}
			//skontroluj submenus
<span class="pc bpc" id="L1082" title="1 of 4 branches missed.">			if (mi.getSubmenus()!=null &amp;&amp; mi.getSubmenus().size()&gt;0)</span>
			{
<span class="fc bfc" id="L1084" title="All 2 branches covered.">				for (ModuleInfo subMi : mi.getSubmenus())</span>
				{
<span class="fc bfc" id="L1086" title="All 4 branches covered.">					if (subMi.getItemKey()!=null &amp;&amp; subMi.getItemKey().equals(itemKey))</span>
					{
<span class="fc" id="L1088">						return(subMi.isAvailable());</span>
					}
<span class="fc" id="L1090">				}</span>
			}
<span class="fc" id="L1092">		}</span>
		//vratim true, ak je to nazov modulu, ktory fyzicky nie je modul (neexistuje)
		//ako napr. editorMiniEdit
<span class="fc bfc" id="L1095" title="All 2 branches covered.">		if (itemKey.startsWith(&quot;cmp&quot;)) return(false);</span>
<span class="fc" id="L1096">		return(true);</span>
	}

	/**
	 * Skontroluje, ci zadany modul existuje
	 * @param itemKey
	 * @return
	 */
	public boolean isModule(String itemKey)
	{
<span class="nc bnc" id="L1106" title="All 2 branches missed.">		for (ModuleInfo mi : modules)</span>
		{
<span class="nc bnc" id="L1108" title="All 2 branches missed.">			if (mi.getItemKey().equals(itemKey))</span>
			{
<span class="nc" id="L1110">				return(true);</span>
			}
			//skontroluj submenus
<span class="nc bnc" id="L1113" title="All 4 branches missed.">			if (mi.getSubmenus()!=null &amp;&amp; mi.getSubmenus().size()&gt;0)</span>
			{
<span class="nc bnc" id="L1115" title="All 2 branches missed.">				for (ModuleInfo subMi : mi.getSubmenus())</span>
				{
<span class="nc bnc" id="L1117" title="All 4 branches missed.">					if (subMi.getItemKey()!=null &amp;&amp; subMi.getItemKey().equals(itemKey))</span>
					{
<span class="nc" id="L1119">						return true;</span>
					}
<span class="nc" id="L1121">				}</span>
			}
<span class="nc" id="L1123">		}</span>
<span class="nc" id="L1124">		return(false);</span>
	}

	/**
	 * Vrati true ak pre zadany modul sa maju v nastaveni pouzivatela zobrazovat sub kategorie
	 * @param itemKey
	 * @return
	 */
	public boolean isShowSubCategories(String itemKey)
	{
<span class="nc bnc" id="L1134" title="All 2 branches missed.">		for (ModuleInfo mi : modules)</span>
		{
<span class="nc bnc" id="L1136" title="All 2 branches missed.">			if (mi.getItemKey().equals(itemKey))</span>
			{
<span class="nc" id="L1138">				return(mi.isShowSubCategories());</span>
			}
<span class="nc" id="L1140">		}</span>
<span class="nc" id="L1141">		return(false);</span>
	}

	/**
	 * Nastavi zakazane moduly pouzivatelovi
	 * @param user
	 */
	public void disableModules(Identity user)
	{
<span class="fc bfc" id="L1150" title="All 2 branches covered.">		for (ModuleInfo mi : modules)</span>
		{
<span class="fc bfc" id="L1152" title="All 2 branches covered.">			if (mi.isAvailable() == false)</span>
			{
				//Logger.debug(Modules.class, &quot;disabling1: &quot;+mi.getItemKey());
<span class="fc" id="L1155">				user.addDisabledItem(mi.getItemKey());</span>
			}
			//skontroluj submenus
<span class="pc bpc" id="L1158" title="1 of 4 branches missed.">			if (mi.getSubmenus()!=null &amp;&amp; mi.getSubmenus().size()&gt;0)</span>
			{
<span class="fc bfc" id="L1160" title="All 2 branches covered.">				for (ModuleInfo subMi : mi.getSubmenus())</span>
				{
<span class="pc bpc" id="L1162" title="1 of 4 branches missed.">					if (subMi.getItemKey()!=null &amp;&amp; subMi.isAvailable() == false)</span>
					{
						//Logger.debug(Modules.class, &quot;disabling2: &quot;+mi.getItemKey());
<span class="nc" id="L1165">						user.addDisabledItem(subMi.getItemKey());</span>
					}
<span class="fc" id="L1167">				}</span>
			}
<span class="fc" id="L1169">		}</span>
<span class="fc" id="L1170">	}</span>

	/**
	 * Vrati zoznam modulov pre useredit.jsp
	 * @param prop
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getUserEditItems(Prop prop)
	{
<span class="fc" id="L1179">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>
		ModuleInfo miUser;
<span class="fc bfc" id="L1181" title="All 2 branches covered.">		for (ModuleInfo mi : modules)</span>
		{
<span class="fc bfc" id="L1183" title="All 2 branches covered.">			if (mi.isAvailable())</span>
			{
<span class="pc bpc" id="L1185" title="1 of 4 branches missed.">                if (mi.isUserItem() &amp;&amp; mi.getItemKey().length()&gt;2) {</span>
<span class="fc" id="L1186">                    miUser = new ModuleInfo(prop.getText(mi.getNameKey()), mi.getItemKey(), mi.getPath(), mi.getRequireConstantsKey(), true, mi.isShowInLeftMenu(), mi.getLeftMenuLink(), &quot;BPECDIO&quot;, mi.getMenuOrder());</span>
<span class="fc" id="L1187">                    miUser.setLeftMenuNameKey(mi.getLeftMenuNameKey());</span>
<span class="fc" id="L1188">                    miUser.setLeftMenuNameKey(prop.getText(miUser.getLeftMenuNameKey()));</span>
<span class="fc" id="L1189">                    miUser.setRootModule(mi.getItemKey());</span>
<span class="fc" id="L1190">                    miUser.setGroup(mi.getGroup());</span>
<span class="fc" id="L1191">                    ret.add(miUser);</span>
                }

				//pridaj submenus
<span class="pc bpc" id="L1195" title="1 of 4 branches missed.">				if (mi.getSubmenus()!=null &amp;&amp; mi.getSubmenus().size()&gt;0)</span>
				{
<span class="fc bfc" id="L1197" title="All 2 branches covered.">					for (ModuleInfo subMi : mi.getSubmenus())</span>
					{
<span class="pc bpc" id="L1199" title="2 of 8 branches missed.">						if (subMi.isAvailable() &amp;&amp; subMi.isUserItem() &amp;&amp; subMi.getItemKey()!=null &amp;&amp; subMi.getItemKey().length()&gt;2)</span>
						{
							//Logger.debug(Modules.class, &quot;Pridavam submenu &quot; + subMi.getLeftMenuNameKey());
<span class="fc" id="L1202">							miUser = new ModuleInfo(prop.getText(subMi.getNameKey()), subMi.getItemKey(), subMi.getPath(), subMi.getRequireConstantsKey(), true, subMi.isShowInLeftMenu(), subMi.getLeftMenuLink(), &quot;BPECDIO&quot;, subMi.getMenuOrder());</span>
<span class="fc" id="L1203">							miUser.setLeftMenuNameKey(subMi.getLeftMenuNameKey());</span>
<span class="fc" id="L1204">							miUser.setLeftMenuNameKey(prop.getText(mi.getLeftMenuNameKey()) + &quot; - &quot; + prop.getText(miUser.getLeftMenuNameKey()));</span>
<span class="fc" id="L1205">							miUser.setRootModule(mi.getItemKey());</span>
<span class="fc" id="L1206">							miUser.setGroup(mi.getGroup());</span>
<span class="fc" id="L1207">							ret.add(miUser);</span>
						}
<span class="fc" id="L1209">					}</span>
				}
			}
<span class="fc" id="L1212">		}</span>
<span class="fc" id="L1213">		return(ret);</span>
	}

	/**
	 * Vrati zoradeny zoznam modulov pre useredit.jsp podla optGroups
	 * @param prop
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getUserEditItemsSorted(Prop prop) {
<span class="nc" id="L1222">		String[] optGroups = {&quot;welcome&quot;, &quot;website&quot;, &quot;components&quot;, &quot;templates&quot;, &quot;files&quot;, &quot;users&quot;, &quot;config&quot;};</span>

<span class="nc" id="L1224">		Map&lt;String, HashMap&lt;String, ModuleInfo&gt;&gt; orderedOptGroups = new LinkedHashMap&lt;&gt;();</span>

<span class="nc bnc" id="L1226" title="All 2 branches missed.">		for (String str : optGroups) {</span>
<span class="nc" id="L1227">			orderedOptGroups.put(str, new HashMap&lt;&gt;());</span>
		}

<span class="nc bnc" id="L1230" title="All 2 branches missed.">		for (ModuleInfo moduleInfo : Modules.getInstance().getUserEditItems(prop)) {</span>
<span class="nc bnc" id="L1231" title="All 2 branches missed.">			if (orderedOptGroups.get(moduleInfo.getGroup()) == null) {</span>
<span class="nc" id="L1232">				continue;</span>
			}
<span class="nc" id="L1234">			orderedOptGroups.get(moduleInfo.getGroup()).put(moduleInfo.getItemKey(), moduleInfo);</span>
<span class="nc" id="L1235">		}</span>

<span class="nc" id="L1237">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L1239" title="All 2 branches missed.">		for (Map.Entry&lt;String, HashMap&lt;String, ModuleInfo&gt;&gt; entry : orderedOptGroups.entrySet()){</span>
<span class="nc" id="L1240">			ret.addAll(entry.getValue().values());</span>
<span class="nc" id="L1241">		}</span>
<span class="nc" id="L1242">		return ret;</span>
	}

	/**
	 * Ziska zoznam poloziek menu pre usera
	 * @param user
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getUserMenuItems(Identity user)
	{
<span class="fc" id="L1252">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L1253" title="All 2 branches covered.">		for (ModuleInfo mi : modules)</span>
		{
			//Logger.debug(this,&quot;checking: &quot; + mi.getItemKey() + &quot;a=&quot; + mi.isAvailable() + &quot; m=&quot; + mi.isShowInLeftMenu() + &quot; u=&quot; + user.isDisabledItem(mi.getItemKey()));
<span class="pc bpc" id="L1256" title="1 of 6 branches missed.">			if (mi.isAvailable() &amp;&amp; (mi.isFromDatabase() || mi.isShowInLeftMenu()))</span>
			{
				//musis overit aj submenu polozky
<span class="pc bpc" id="L1259" title="1 of 6 branches missed.">				if (user.isDisabledItem(mi.getItemKey()) &amp;&amp; (mi.getSubmenus(user)==null || mi.getSubmenus(user).size()&lt;1))</span>
				{
<span class="fc" id="L1261">					continue;</span>
				}

				//Logger.debug(this,&quot;Pridavam: &quot; + mi.getItemKey());
<span class="fc" id="L1265">				ret.add(mi);</span>
			}
<span class="fc" id="L1267">		}</span>
<span class="fc" id="L1268">		return(ret);</span>
	}

	/**
	 * Vrati zoznam vsetkych modulov, pouziva licencny server pri generovani licencie
	 * @return
	 */
	public List&lt;ModuleInfo&gt; getItems()
	{
<span class="nc" id="L1277">		List&lt;ModuleInfo&gt; ret = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L1279">		Map&lt;String, ModuleInfo&gt; modulesTable = new Hashtable&lt;&gt;();</span>
<span class="nc bnc" id="L1280" title="All 2 branches missed.">		for (ModuleInfo m : modules)</span>
		{
<span class="nc" id="L1282">			modulesTable.put(m.getItemKey().toLowerCase(), m);</span>
<span class="nc" id="L1283">		}</span>

		//	preiteruj moduly a povol
		String modName;
		String modPerms;
		int index;
<span class="nc bnc" id="L1289" title="All 2 branches missed.">		for (Map.Entry&lt;String, String&gt; entry : modVersions.entrySet())</span>
		{
<span class="nc" id="L1291">			modName = entry.getKey();</span>
<span class="nc" id="L1292">			modPerms = entry.getValue();</span>

<span class="nc" id="L1294">			ModuleInfo mi = new ModuleInfo();</span>
<span class="nc" id="L1295">			mi.setWjVersions(modPerms);</span>

			//Logger.println(this,&quot;--&gt; testujem: &quot; + key + &quot; &quot; + modName + &quot; &quot; + modPerms);
<span class="nc" id="L1298">			index = modPerms.indexOf(';');</span>
<span class="nc bnc" id="L1299" title="All 2 branches missed.">			if (index &gt; 0)</span>
			{
<span class="nc" id="L1301">				mi.setNameKey(&quot;webjet_&quot;+modName);</span>
<span class="nc" id="L1302">				mi.setItemKey(modPerms.substring(index+1));</span>

<span class="nc" id="L1304">				mi.setWjVersions(modPerms.substring(0, index));</span>

<span class="nc" id="L1306">				mi.setUserItem(false);</span>

<span class="nc" id="L1308">				ModuleInfo m = modulesTable.get(modName.toLowerCase());</span>
<span class="nc bnc" id="L1309" title="All 2 branches missed.">				if (m == null) m = modulesTable.get(Tools.replace(modName.toLowerCase(), &quot;cmp_&quot;, &quot;menu&quot;));</span>
<span class="nc bnc" id="L1310" title="All 2 branches missed.">				if (m != null)</span>
				{
<span class="nc" id="L1312">					mi.setUserItem(m.isUserItem());</span>
<span class="nc" id="L1313">					mi.setGroup(m.getGroup());</span>
				}

<span class="nc" id="L1316">				ret.add(mi);</span>
			}
<span class="nc" id="L1318">		}</span>
<span class="nc" id="L1319">		return(ret);</span>
	}

	/**
	 * Vrati zoznam submenu modulu podla prav daneho pouzivatela
	 * @param mi
	 * @param user
	 * @return
	 */
	public static List&lt;ModuleInfo&gt; getSubmenus(ModuleInfo mi, Identity user)
	{
<span class="fc" id="L1330">		List&lt;ModuleInfo&gt; userSubItems = new ArrayList&lt;&gt;();</span>

<span class="pc bpc" id="L1332" title="1 of 4 branches missed.">		if (mi.getSubmenus()==null || mi.getSubmenus().size()&lt;1) return userSubItems;</span>

<span class="fc bfc" id="L1334" title="All 2 branches covered.">		for (ModuleInfo subMi : mi.getSubmenus())</span>
		{
<span class="pc bpc" id="L1336" title="2 of 8 branches missed.">			if (Tools.isEmpty(subMi.getLeftMenuLink()) || &quot;javascript:&quot;.equals(subMi.getLeftMenuLink()) || &quot;javascript:void();&quot;.equals(subMi.getLeftMenuLink()) || &quot;javascript:void()&quot;.equals(subMi.getLeftMenuLink())) continue;</span>

			//pridam ak to nema itemKey, alebo ak ma pravo na dany itemKey
<span class="fc" id="L1339">			String subItemKey = subMi.getItemKey();</span>
<span class="fc bfc" id="L1340" title="All 2 branches covered.">			if (Tools.isEmpty(subItemKey)) subItemKey = mi.getItemKey();</span>
<span class="fc bfc" id="L1341" title="All 2 branches covered.">			if (user.isDisabledItem(subItemKey)==false)</span>
			{
<span class="fc" id="L1343">				userSubItems.add(subMi);</span>
			}
<span class="fc" id="L1345">		}</span>
<span class="fc" id="L1346">		return userSubItems;</span>
	}

	/**
	 * Odfiltruje zoznam modulov podla aktualnej domeny (nastavuje sa v modinfo.properties do atributu domainName)
	 * @param modules
	 * @param domain
	 * @return
	 */
	public static List&lt;ModuleInfo&gt; filterDomain(List&lt;ModuleInfo&gt; modules, String domain)
	{
<span class="pc bpc" id="L1357" title="1 of 2 branches missed.">		if (domain == null) return modules;</span>

<span class="fc" id="L1359">		domain = domain.toLowerCase();</span>
<span class="fc" id="L1360">		List&lt;ModuleInfo&gt; filtered = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L1361" title="All 2 branches covered.">		for (ModuleInfo module : modules)</span>
		{
<span class="pc bpc" id="L1363" title="3 of 4 branches missed.">			if (Tools.isNotEmpty(module.getDomainName()) &amp;&amp; module.getDomainName().contains(domain)==false) continue;</span>

<span class="fc" id="L1365">			filtered.add(module);</span>
<span class="fc" id="L1366">		}</span>
<span class="fc" id="L1367">		return filtered;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>