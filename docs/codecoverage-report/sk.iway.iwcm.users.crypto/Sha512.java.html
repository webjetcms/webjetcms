<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="sk"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Sha512.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">webjetcms</a> &gt; <a href="index.source.html" class="el_package">sk.iway.iwcm.users.crypto</a> &gt; <span class="el_source">Sha512.java</span></div><h1>Sha512.java</h1><pre class="source lang-java linenums">package sk.iway.iwcm.users.crypto;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.security.SecureRandom;

import com.google.crypto.tink.subtle.Hex;

import sk.iway.iwcm.Constants;
import sk.iway.iwcm.users.PasswordSecurityAlgorithm;
import sk.iway.iwcm.users.UnknownHashAlgorithm;

/**
 * Hashovanie hesiel pomocou Sha-512 algoritmu
 */
<span class="fc" id="L16">public class Sha512 implements PasswordSecurityAlgorithm {</span>

    /**
	 * Generates a random HEX string
	 * chars = [0-9a-f]{16}, lowercase only
	 *
	 * @return {@link String} random hex string
	 */
	public String generateSalt() {
<span class="fc" id="L25">		byte[] randomBytes = new byte[8];</span>
<span class="fc" id="L26">		new SecureRandom().nextBytes(randomBytes);</span>
<span class="fc" id="L27">		return Hex.encode(randomBytes).toLowerCase();</span>
	}

    /**
	 * Generates a hash combining password and a salt using concatenation.
	 *
	 * Algorithm employed: SHA-512
	 *
	 * @param password any String
	 * @param salt Generated by generateSalt, must match ^[0-9a-f]{16}$, otherwise rejected
	 * @return [0-9a-f]{128} String
	 */
	public String calculateHash(String password, String salt)
	{
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">		if (!salt.matches(&quot;^[0-9a-f]{16}$&quot;))</span>
<span class="nc" id="L42">			throw new IllegalArgumentException(&quot;Salt has invalid form, not matching [0-9a-f]{16}&quot;);</span>
		try {
<span class="fc" id="L44">			int passwordUseHashIterations = Constants.getInt(&quot;passwordUseHashIterations&quot;);</span>

<span class="pc bpc" id="L46" title="1 of 2 branches missed.">			if (passwordUseHashIterations &lt; 2) {</span>
				//povodna marosova implementacia
<span class="nc" id="L48">				MessageDigest hash = MessageDigest.getInstance(&quot;SHA-512&quot;);</span>
<span class="nc" id="L49">				byte bytesHash[] = hash.digest((password+salt).getBytes());</span>
<span class="nc" id="L50">				return Hex.encode(bytesHash).toLowerCase();</span>
			} else {
				//presne podla OWASP - https://www.owasp.org/index.php/Hashing_Java
<span class="fc" id="L53">				MessageDigest digest = MessageDigest.getInstance(&quot;SHA-512&quot;);</span>
<span class="fc" id="L54">				digest.reset();</span>
<span class="fc" id="L55">				digest.update(salt.getBytes());</span>
<span class="fc" id="L56">				byte[] input = digest.digest(password.getBytes());</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">				for (int i = 0; i &lt; passwordUseHashIterations; i++) {</span>
<span class="fc" id="L58">					digest.reset();</span>
<span class="fc" id="L59">					input = digest.digest(input);</span>
				}
<span class="fc" id="L61">				return Hex.encode(input).toLowerCase();</span>
			}
<span class="nc" id="L63">		} catch (NoSuchAlgorithmException e) { throw new UnknownHashAlgorithm(); }</span>
	}

    public boolean isPasswordCorrect(String password, String salt, String hash) {
<span class="fc" id="L67">        String calculated = calculateHash(password, salt);</span>
<span class="fc" id="L68">        return calculated.equals(hash);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>