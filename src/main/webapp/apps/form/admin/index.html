<script data-th-inline="javascript">
    let url = "/admin/rest/forms-list/";
    let columns = /*[(${layout.getDataTableColumns("sk.iway.iwcm.components.forms.FormsEntity")})]*/ '';
    const columnsToKeep = ["id", "preview", "formName", "count", "createDate"];
</script>

<script type="text/javascript">
    var formDetailTable;

    WJ.breadcrumb({
        id: "forms",
        tabs: [
            {
                url: "/apps/form/admin/",
                title: WJ.translate("forms.formsList.js"),
                active: true
            }
        ]
    });

    window.openFormHtml = function (formName) {
        if(formName == undefined || formName == null) return;
        window.location.href="/apps/form/admin/detail/?formName="+ formName;
    }

    let filteredColumns = columns.filter(col => columnsToKeep.includes(col.data));
    window.WJ.DataTable.mergeColumns(filteredColumns, { name: "createDate", title: '[[#{formslist.datum_posledneho}]]' });
    let columnsFetchPromise = Promise.resolve();

    window.domReady.add(function () {
        // !! hide form steps tab link !! - show only in form detail view
        //$("a.nav-link[href='/apps/form/admin/form-steps/']").hide();

        function initFormDetailTable() {
            formDetailTable = WJ.DataTable({
                url:  url,
                columns: filteredColumns,
                id: 'form-detail',
                serverSide: false,
                //
                idAutoOpener: true,
                onXhr: function( TABLE, e, settings, json, xhr ) {
                    json.data.forEach(j => {
                        if(j.columnNamesAndValues == undefined || j.columnNamesAndValues == null) return;

                        for (let [key, value] of Object.entries(j.columnNamesAndValues)) {
                            j["col_"+key] = value;
                        }
                        //set class for not confirmed double optin forms
                        if (typeof j.doubleOptinHash != "undefined" && j.doubleOptinHash != null && j.doubleOptinHash != "") {
                            if (typeof j.doubleOptinConfirmationDate != "undefined" && j.doubleOptinConfirmationDate == null) {
                                j.editorFields = {
                                    rowClass: "is-disabled"
                                }
                            }
                        }
                    });
                },
                lastExportColumnName: 'lastExportDate',
                byIdExportColumnName: 'id'
            });
        }

        //Initialize after potential dynamic column fetch
        columnsFetchPromise.finally(() => initFormDetailTable());

    });
</script>

<table id="form-detail" class="datatableInit table"></table>