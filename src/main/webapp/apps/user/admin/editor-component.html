<script>
	function appGetComponentPath(componentPath, datatable) {
		let field = $("#DTE_Field_field").val();
		if (field.indexOf("!") !== 0) return field;
		return componentPath;
	}

	function appGetComponentCode(componentPath, params, datatable) {
		let field = $("#DTE_Field_field").val();
		if (field.indexOf("!") == 0) return field;
		return null;
	}

	function appAfterInit(response, datatable) {
		const setFieldsVisibility = (fieldsToHide = [], fieldsToShow = []) => {
			fieldsToHide.forEach((name) => $(`.DTE_Field_Name_${name}`).hide());
			fieldsToShow.forEach((name) => $(`.DTE_Field_Name_${name}`).show());
		};

		window.addEventListener("WJ.DTE.opened", function (e) {
			const fieldElement = $("#DTE_Field_field");

			fieldElement.on("change", function () {
				let value = $(this).val();
				switch (value) {
					case "/components/user/newuser.jsp":
						setFieldsVisibility(
							["regToUserGroups"],
							[
								"groupIds",
								"show",
								"required",
								"groupIdsEditable",
								"emailUnique",
								"successDocId",
								"infoemail",
								"requireEmailVerification",
								"notAuthorizedEmailDocId",
								"loginNewUser",
								"useAjax",
								"useCustomFields",
							]
						);

						$("#pills-dt-component-datatable-showed-tab").show();
						$("#pills-dt-component-datatable-required-tab").show();

						break;
					case "/components/user/logon.jsp":
						setFieldsVisibility(
							[
								"groupIds",
								"show",
								"required",
								"groupIdsEditable",
								"emailUnique",
								"successDocId",
								"infoemail",
								"requireEmailVerification",
								"notAuthorizedEmailDocId",
								"loginNewUser",
								"useAjax",
								"useCustomFields",
							],
							["regToUserGroups"]
						);

						$("#pills-dt-component-datatable-showed-tab").hide();
						$("#pills-dt-component-datatable-required-tab").hide();

						break;
					default:
						setFieldsVisibility(
							[
								"userGroups",
								"show",
								"required",
								"groupIdsEditable",
								"emailUnique",
								"successDocId",
								"infoemail",
								"requireEmailVerification",
								"notAuthorizedEmailDocId",
								"loginNewUser",
								"useAjax",
								"useCustomFields",
								"regToUserGroups",
							],
							[]
						);

						$("#pills-dt-component-datatable-showed-tab").hide();
						$("#pills-dt-component-datatable-required-tab").hide();

						break;
				}
			});

			fieldElement.change();
		});
	}
</script>
