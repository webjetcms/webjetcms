CKEDITOR.dialog.add("svgiconDialog",function(e){function w(b){var a="all";0<l.length&&(a=b.getValueOf("icons","iconGroup"));var d=b.getValueOf("icons","iconSearch").toLowerCase();b=b.getContentElement("icons","iconGrid").getElement();for(var c=b.find(".wj-icon-item"),f=0,q=0;q<c.count();q++){var g=c.getItem(q),h=g.getAttribute("title"),k=p[h]||[],k="all"===a||-1!==k.indexOf(a),h=-1!==h.toLowerCase().indexOf(d);k&&h?(g.show(),f++):g.hide()}a=b.findOne(".wj-no-icons-message");0===f?a?a.show():(a=new CKEDITOR.dom.element("div"),
a.addClass("wj-no-icons-message"),a.setHtml(e.lang.webjetsvgicon.noIconsFound),a.setStyles({"text-align":"center",padding:"20px",color:"#666","font-style":"italic"}),b.append(a)):a&&a.hide()}function E(b){var a=b.getContentElement("icons","iconGrid").getElement();a.setHtml('\x3cdiv class\x3d"wj-loading-message" style\x3d"text-align: center; padding: 20px; color: #666;"\x3e'+e.lang.webjetsvgicon.loadingIcons+"\x3c/div\x3e");CKEDITOR.ajax.loadXml(x,function(d){if(d){var c=CKEDITOR.document.getById("wj-svg-sprite-container");
c||(c=new CKEDITOR.dom.element("div"),c.setAttributes({id:"wj-svg-sprite-container",style:"display: none; position: absolute; top: -9999px;"}),CKEDITOR.document.getBody().append(c),d=d.documentElement?d.documentElement.outerHTML:(new XMLSerializer).serializeToString(d.baseXml.childNodes[0]),c.setHtml(d));F(b,c.$)}else a.setHtml('\x3cdiv class\x3d"wj-error-message" style\x3d"text-align: center; padding: 20px; color: #d32f2f;"\x3e'+e.lang.webjetsvgicon.loadError+"\x3c/div\x3e")})}function F(b,a){for(var d=
b.getContentElement("icons","iconGrid").getElement(),c=a.getElementsByTagName("symbol"),f=[],e=0===m.length,g=0;g<c.length;g++){var h=c[g].getAttribute("id");!0===e&&m.push(h);-1!==m.indexOf(h)&&f.push(h)}var k='\x3cdiv class\x3d"wj-icon-grid" style\x3d"display: grid; grid-template-columns: repeat(auto-fit, minmax('+(n+2+8)+"px, 1fr)); gap: 4px; max-height: "+y+'px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fff;"\x3e';f.forEach(function(a){k+='\x3cdiv class\x3d"wj-icon-item" title\x3d"'+
a+'" style\x3d"display: flex; flex-direction: column; align-items: center; padding: 2px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.2s; width: '+n+"px; height: "+(r+26)+'px; justify-content: center;overflow: hidden;"\x3e\x3cdiv class\x3d"wj-icon-placeholder" style\x3d"width: '+n+"px; height: "+r+'px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;"\x3eLoading...\x3c/div\x3e\x3cdiv class\x3d"wj-icon-name" style\x3d"font-size: 10px; text-align: center; word-break: break-all; line-height: 1;width: '+
n+'px; height: 2em; white-space: normal;"\x3e'+a+"\x3c/div\x3e\x3c/div\x3e"});k+="\x3c/div\x3e";d.setHtml(k);G(b)}function G(b){var a=b.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item");if(window.IntersectionObserver)for(var d=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(z(a.target),d.unobserve(a.target))})}),c=0;c<a.count();c++){var f=a.getItem(c);d.observe(f.$);f.on("click",function(){A(b,this)});f.on("mouseenter",function(){this.hasClass("wj-selected")||
this.setStyle("background-color","#f5f5f5")});f.on("mouseleave",function(){this.hasClass("wj-selected")||this.setStyle("background-color","")})}else for(c=0;c<a.count();c++)f=a.getItem(c),z(f.$),f.on("click",function(){A(b,this)})}function z(b){var a=b.getAttribute("title");(b=b.querySelector(".wj-icon-placeholder"))&&a&&(b.innerHTML='\x3csvg width\x3d"'+n+'" height\x3d"'+r+'" style\x3d"max-width: 100%; max-height: 100%;"\x3e\x3cuse href\x3d"#'+a+'"\x3e\x3c/use\x3e\x3c/svg\x3e')}function A(b,a){for(var d=
b.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),c=0;c<d.count();c++){var f=d.getItem(c);f.removeClass("wj-selected");f.setStyles({"border-color":"transparent","background-color":""})}a.addClass("wj-selected");a.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});h=a.getAttribute("title")}function H(b){if(!b)return{size:"",color:"",withTextEnd:!1,custom:[]};var a={size:"",color:"",withTextEnd:!1,custom:[]};b.split(/\s+/).forEach(function(b){if("svg-icon-selected"!==
b)if("icon"===b||"icon--with-text-end"===b)"icon--with-text-end"===b&&(a.withTextEnd=!0);else if(b.startsWith("icon--")){var c=b.substring(6);-1!==t.indexOf(c)?a.size=c:-1!==u.indexOf(c)?a.color=c:a.custom.push(b)}else a.custom.push(b)});return a}function I(b,a,d,c){var f=["icon"];b&&f.push("icon--"+b);a&&f.push("icon--"+a);d&&f.push("icon--with-text-end");c&&(b=c.split(/\s+/).filter(function(a){return a&&"icon"!==a&&"icon--with-text-end"!==a?a.startsWith("icon--")?(a=a.substring(6),-1===t.indexOf(a)&&
-1===u.indexOf(a)):!0:!1}),f=f.concat(b));return f.join(" ")}var g=e.config.webjetsvgicon||{},x=g.spritePath||"/sprite.svg",v=g.icons||{},n=g.iconWidth||56,r=g.iconHeight||56,y=g.gridHeight||400,t=(g.sizes||"small,medium,large,xlarge,xxlarge,huge").split(","),u=(g.colors||"info,success,warning,danger,orange").split(","),m=[],l=[],p={};0<Object.keys(v).length&&(m=Object.keys(v),m.forEach(function(b){var a=v[b]||[];p[b]=a;a.forEach(function(a){-1===l.indexOf(a)&&l.push(a)})}));l.sort();var B=[[e.lang.webjetsvgicon.showAll,
"all"]];l.forEach(function(b){B.push([b,b])});var C=[[e.lang.webjetsvgicon.defaultSize,""]];t.forEach(function(b){C.push([b,b])});var D=[[e.lang.webjetsvgicon.defaultColor,""]];u.forEach(function(b){D.push([b,b])});var h="",g=[{type:"hbox",padding:0,widths:["49%","2%","49%"],children:[{type:"select",id:"iconGroup",label:e.lang.webjetsvgicon.iconGroup,items:B,"default":"all",onChange:function(){w(this.getDialog())}},{type:"html",html:"\x26nbsp;"},{type:"text",id:"iconSearch",label:e.lang.webjetsvgicon.iconSearch,
onKeyUp:function(){w(this.getDialog())}}]},{type:"html",id:"iconGrid",html:'\x3cdiv style\x3d"min-height: '+y+'px;"\x3e\x3c/div\x3e'}];1>=l.length&&(g[0].widths=["100%"],g[0].children=[g[0].children[2]]);return{title:e.lang.webjetsvgicon.title,minWidth:800,minHeight:500,contents:[{id:"icons",label:e.lang.webjetsvgicon.icons,elements:g},{id:"advanced",label:e.lang.webjetsvgicon.advanced,elements:[{type:"select",id:"iconSize",label:e.lang.webjetsvgicon.iconSize,items:C},{type:"select",id:"iconColor",
label:e.lang.webjetsvgicon.iconColor,items:D},{type:"checkbox",id:"withTextEnd",label:e.lang.webjetsvgicon.withTextEnd},{type:"text",id:"customClass",label:e.lang.webjetsvgicon.customClass}]}],onShow:function(){var b=this;h="";this.setValueOf("icons","iconSearch","");E(b);var a=e.document.find(".svg-icon-selected");if(a&&1==a.$.length){var d=a.$[0].getAttribute("class")||"",d=H(d);this.setValueOf("advanced","iconSize",d.size);this.setValueOf("advanced","iconColor",d.color);this.setValueOf("advanced",
"withTextEnd",d.withTextEnd);this.setValueOf("advanced","customClass",d.custom.join(" "));(a=a.$[0].children[0].getAttribute("xlink:href")||"")&&-1!==a.indexOf("#")&&(h=a.substring(a.indexOf("#")+1),this.setValueOf("icons","iconSearch",h));h&&p[h]&&(a=p[h],0<a.length&&this.setValueOf("icons","iconGroup",a[0]));setTimeout(function(){for(var a=b.getContentElement("icons","iconGrid").getElement().find(".wj-icon-grid .wj-icon-item"),d=0;d<a.count();d++){var e=a.getItem(d);if(e.getAttribute("title")===
h){e.addClass("wj-selected");e.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});break}}},500)}},onOk:function(){if(!h)return alert(e.lang.webjetsvgicon.noIconSelected),!1;var b=this.getValueOf("advanced","iconSize"),a=this.getValueOf("advanced","iconColor"),d=this.getValueOf("advanced","withTextEnd"),c=this.getValueOf("advanced","customClass"),b=I(b,a,d,c),b='\x3csvg class\x3d"'+CKEDITOR.tools.htmlEncode(b)+'" aria-hidden\x3d"true"\x3e',b=b+('\x3cuse xlink:href\x3d"'+CKEDITOR.tools.htmlEncode(x+
"#"+h)+'"\x3e\x3c/use\x3e'),b=b+"\x3c/svg\x3e";(a=e.document.find(".svg-icon-selected"))&&1==a.$.length?(a=a.$[0],a.outerHTML=b):(b=CKEDITOR.dom.element.createFromHtml(b),e.insertElement(b))}}});