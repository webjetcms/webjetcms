CKEDITOR.dialog.add("pictureDialog",function(e){var g=e.config.pictureDialogBreakpoints||[{name:"Desktop",minWidth:992,fallback:!0},{name:"Tablet",minWidth:768},{name:"Mobile",minWidth:0}],k=g.find(function(a){return!0===a.fallback})||g[0],l=[];g.forEach(function(a){l.push({type:"hbox",padding:0,widths:["95%","5%"],children:[{type:"text",id:"src"+a.name,label:a.name+e.lang.webjetpicture.imageUrl+(a.fallback?e.lang.webjetpicture.fallback:""),validate:a.fallback?CKEDITOR.dialog.validate.notEmpty(e.lang.webjetpicture.fallbackUrlRequired):
null,className:"wj-picture-url-input"},{type:"html",html:'\x3clabel class\x3d"cke_dialog_ui_labeled_label"\x3e\x26nbsp;\x3c/label\x3e\x3cdiv class\x3d"cke_dialog_ui_labeled_content cke_dialog_ui_labeled_content_append"\x3e\x3cdiv class\x3d"cke_dialog_ui_input_text"\x3e\x3ci onclick\x3d"openLinkDialogWindow(\'ckEditorDialog\', \'pictures:src'+a.name+'\');" class\x3d"wj-action-icon ti ti-focus-2"\x3e\x3c/i\x3e\x3c/div\x3e\x3c/div\x3e'}]})});return{title:e.lang.webjetpicture.title,minWidth:500,minHeight:400,
contents:[{id:"pictures",label:e.lang.webjetpicture.pictures,elements:l},{id:"advanced",label:e.lang.webjetpicture.advanced,elements:[{type:"text",id:"alt",label:e.lang.webjetpicture.altText},{type:"text",id:"pictureClass",label:e.lang.webjetpicture.pictureClass},{type:"text",id:"width",label:e.lang.webjetpicture.width},{type:"text",id:"height",label:e.lang.webjetpicture.height}]}],onShow:function(){var a=e.getSelection().getStartElement(),b=null;a&&"picture"===a.getName()?b=a:a&&"img"===a.getName()?
(b=a.getParent())&&"picture"!==b.getName()&&(b=null):a&&(b=a.getAscendant("picture",!0));if(b){this.setValueOf("advanced","pictureClass",b.getAttribute("class")||"");if(a=b.findOne("img"))this.setValueOf("advanced","alt",a.getAttribute("alt")||""),this.setValueOf("advanced","width",a.getAttribute("width")||""),this.setValueOf("advanced","height",a.getAttribute("height")||""),this.setValueOf("pictures","src"+k.name,a.getAttribute("src")||"");b=b.find("source");for(a=0;a<b.count();a++){var c=b.getItem(a),
h=c.getAttribute("media"),f=c.getAttribute("srcset");if(h&&f&&(c=h.match(/min-width:\s*(\d+)px/))){var d=parseInt(c[1]);g.forEach(function(a){a.minWidth===d&&this.setValueOf("pictures","src"+a.name,f)}.bind(this))}}}},onOk:function(){var a=this,b=a.getValueOf("advanced","alt"),c=a.getValueOf("advanced","width"),h=a.getValueOf("advanced","height"),f=a.getValueOf("advanced","pictureClass"),d="\x3cpicture";f&&""!==f.trim()&&(d+=' class\x3d"'+CKEDITOR.tools.htmlEncode(f)+'"');d+="\x3e";g.slice().sort(function(a,
b){return b.minWidth-a.minWidth}).forEach(function(b){if(!b.fallback){var c=a.getValueOf("pictures","src"+b.name);c&&""!==c.trim()&&(d+='\x3csource media\x3d"(min-width: '+b.minWidth+'px)" srcset\x3d"'+CKEDITOR.tools.htmlEncode(c)+'"\x3e')}});f=a.getValueOf("pictures","src"+k.name);d+='\x3cimg src\x3d"'+CKEDITOR.tools.htmlEncode(f)+'" alt\x3d"'+CKEDITOR.tools.htmlEncode(b)+'"';c&&(d+=' width\x3d"'+CKEDITOR.tools.htmlEncode(c)+'"');h&&(d+=' height\x3d"'+CKEDITOR.tools.htmlEncode(h)+'"');d+="\x3e";
d+="\x3c/picture\x3e";c=e.getSelection().getStartElement();b=null;c&&"picture"===c.getName()?b=c:c&&"img"===c.getName()?(b=c.getParent())&&"picture"!==b.getName()&&(b=null):c&&(b=c.getAscendant("picture",!0));c=CKEDITOR.dom.element.createFromHtml(d);b?c.replace(b):e.insertElement(c)}}});