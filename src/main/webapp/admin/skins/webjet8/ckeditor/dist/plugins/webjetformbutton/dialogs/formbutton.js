CKEDITOR.dialog.add("webjetformbuttonDialog",function(e){function v(a){if(!k){var b="all";0<l.length&&(b=a.getValueOf("icons","iconGroup"));var d=a.getValueOf("icons","iconSearch").toLowerCase();a=a.getContentElement("icons","iconGrid").getElement();for(var c=a.find(".wj-icon-item"),h=0,w=0;w<c.count();w++){var m=c.getItem(w),f=m.getAttribute("title"),g=E[f]||[],g="all"===b||-1!==g.indexOf(b),f=-1!==f.toLowerCase().indexOf(d);g&&f?(m.show(),h++):m.hide()}b=a.findOne(".wj-no-icons-message");0===h?
b?b.show():(b=new CKEDITOR.dom.element("div"),b.addClass("wj-no-icons-message"),b.setHtml(e.lang.webjetformbutton.noIconsFound),b.setStyles({"text-align":"center",padding:"20px",color:"#666","font-style":"italic"}),a.append(b)):b&&b.hide()}}function M(a){if(!k){var b=a.getContentElement("icons","iconGrid").getElement();b.setHtml('\x3cdiv class\x3d"wj-loading-message" style\x3d"text-align: center; padding: 20px; color: #666;"\x3e'+e.lang.webjetformbutton.loadingIcons+"\x3c/div\x3e");CKEDITOR.ajax.loadXml(u,
function(d){if(d){var c=CKEDITOR.document.getById("wj-svg-sprite-container");c||(c=new CKEDITOR.dom.element("div"),c.setAttributes({id:"wj-svg-sprite-container",style:"display: none; position: absolute; top: -9999px;"}),CKEDITOR.document.getBody().append(c),d=d.documentElement?d.documentElement.outerHTML:(new XMLSerializer).serializeToString(d.baseXml.childNodes[0]),c.setHtml(d));N(a,c.$)}else b.setHtml('\x3cdiv class\x3d"wj-error-message" style\x3d"text-align: center; padding: 20px; color: #d32f2f;"\x3e'+
e.lang.webjetformbutton.loadError+"\x3c/div\x3e")})}}function N(a,b){for(var d=a.getContentElement("icons","iconGrid").getElement(),c=b.getElementsByTagName("symbol"),h=[],e=0===r.length,f=0;f<c.length;f++){var g=c[f].getAttribute("id");!0===e&&r.push(g);-1!==r.indexOf(g)&&h.push(g)}var k='\x3cdiv class\x3d"wj-icon-grid" style\x3d"display: grid; grid-template-columns: repeat(auto-fit, minmax('+(q+2+8)+"px, 1fr)); gap: 4px; max-height: "+F+'px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fff;"\x3e';
h.forEach(function(a){k+='\x3cdiv class\x3d"wj-icon-item" title\x3d"'+a+'" style\x3d"display: flex; flex-direction: column; align-items: center; padding: 2px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.2s; width: '+q+"px; height: "+(x+26)+'px; justify-content: center;overflow: hidden;"\x3e\x3cdiv class\x3d"wj-icon-placeholder" style\x3d"width: '+q+"px; height: "+x+'px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;"\x3eLoading...\x3c/div\x3e\x3cdiv class\x3d"wj-icon-name" style\x3d"font-size: 10px; text-align: center; word-break: break-all; line-height: 1;width: '+
q+'px; height: 2em; white-space: normal;"\x3e'+a+"\x3c/div\x3e\x3c/div\x3e"});k+="\x3c/div\x3e";d.setHtml(k);O(a)}function O(a){var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item");if(window.IntersectionObserver)for(var d=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(G(a.target),d.unobserve(a.target))})}),c=0;c<b.count();c++){var h=b.getItem(c);d.observe(h.$);h.on("click",function(){H(a,this)});h.on("mouseenter",function(){this.hasClass("wj-selected")||
this.setStyle("background-color","#f5f5f5")});h.on("mouseleave",function(){this.hasClass("wj-selected")||this.setStyle("background-color","")})}else for(c=0;c<b.count();c++)h=b.getItem(c),G(h.$),h.on("click",function(){H(a,this)})}function G(a){var b=a.getAttribute("title");(a=a.querySelector(".wj-icon-placeholder"))&&b&&(a.innerHTML='\x3csvg width\x3d"'+q+'" height\x3d"'+x+'" style\x3d"max-width: 100%; max-height: 100%;"\x3e\x3cuse href\x3d"#'+b+'"\x3e\x3c/use\x3e\x3c/svg\x3e')}function H(a,b){for(var d=
a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),c=b.hasClass("wj-selected"),h=0;h<d.count();h++){var e=d.getItem(h);e.removeClass("wj-selected");e.setStyles({"border-color":"transparent","background-color":""})}c?g="":(b.addClass("wj-selected"),b.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"}),g=b.getAttribute("title"))}function y(a){var b={size:"",type:"",custom:[]};(a.getAttribute("class")||"").split(/\s+/).forEach(function(a){a!==z&&(-1!==A.indexOf(a)?
b.size=a:-1!==B.indexOf(a)?b.type=a:b.custom.push(a))});return b}function P(a,b,d){var c=[z];a&&c.push(a);b&&c.push(b);d&&(a=d.split(/\s+/).filter(function(a){return a&&a!==z&&-1===A.indexOf(a)&&-1===B.indexOf(a)?!0:!1}),c=c.concat(a));return c.join(" ")}var f=e.config.webjetsvgicon||{},u=f.spritePath||"",C=f.icons||{},q=f.iconWidth||56,x=f.iconHeight||56,F=f.gridHeight||400,f=e.config.webjetformbutton||{},A=(f.sizes||"btn-lg,btn-sm").split(","),D=f.textHiddenClass||"visually-hidden",z=f.baseClass||
"btn",B=f.types?f.types.split(","):"btn-primary btn-secondary btn-success btn-danger btn-warning btn-info btn-light btn-dark btn-link btn-outline-primary btn-outline-secondary btn-outline-success btn-outline-danger btn-outline-warning btn-outline-info btn-outline-light btn-outline-dark".split(" "),t=(f.attrs||"").split(",").filter(function(a){return a.trim()}).map(function(a){return a.trim()}),r=[],l=[],E={};0<Object.keys(C).length&&(r=Object.keys(C),r.forEach(function(a){var b=C[a]||[];E[a]=b;b.forEach(function(a){-1===
l.indexOf(a)&&l.push(a)})}));l.sort();var I=[[e.lang.webjetformbutton.showAll,"all"]];l.forEach(function(a){I.push([a,a])});var J=[[e.lang.webjetformbutton.defaultSize,""]];A.forEach(function(a){J.push([a,a])});var K=[[e.lang.webjetformbutton.defaultType,""]];B.forEach(function(a){K.push([a,a])});var g="",k=!u,p=[{type:"text",id:"text",label:e.lang.webjetformbutton.text,"default":"",setup:function(a){var b="";a=a.getChildren();for(var d=0;d<a.count();d++){var c=a.getItem(d);if(c.type===CKEDITOR.NODE_TEXT)b+=
c.getText();else if(c.is&&c.is("span")&&c.hasClass(D)){b=c.getText();break}else c.is&&(c.is("svg")||c.is("use"))||(b+=c.getText())}this.setValue(b.trim())}},{type:"text",id:"name",label:e.lang.webjetformbutton.name,setup:function(a){this.setValue(a.getAttribute("name")||"")}},{type:"text",id:"onclick",label:e.lang.webjetformbutton.onclick,setup:function(a){var b="",b=a.getAttribute("onclick")||"";!b&&a.$&&a.$.onclick&&(a=a.$.onclick.toString(),0===a.indexOf("function onclick(event)")?a=a.replace(/^function onclick\(event\)\s*\{\s*/,
"").replace(/\s*\}$/,""):0===a.indexOf("function anonymous(")&&(a=a.replace(/^function anonymous\([^)]*\)\s*\{\s*/,"").replace(/\s*\}$/,"")),b=a.trim());this.setValue(b)}},{type:"select",id:"buttonType",label:e.lang.webjetformbutton.buttonType,"default":"",items:K,setup:function(a){a=y(a);this.setValue(a.type)}},{type:"select",id:"size",label:e.lang.webjetformbutton.size,"default":"",items:J,setup:function(a){a=y(a);this.setValue(a.size)}},{type:"text",id:"customClass",label:e.lang.webjetformbutton.customClass,
setup:function(a){a=y(a);this.setValue(a.custom.join(" "))}},{type:"checkbox",id:"disabled",label:e.lang.webjetformbutton.disabled,setup:function(a){this.setValue(a.hasAttribute("disabled"))}}];k||p.push({type:"checkbox",id:"hideText",label:e.lang.webjetformbutton.hideText,setup:function(a){a=a.findOne("span."+D);this.setValue(!!a)}});var L=[];0<t.length&&t.forEach(function(a){var b=a.replace(/[^a-zA-Z0-9]/g,"_");L.push({type:"text",id:b,label:a,"default":"",setup:function(b){this.setValue(b.getAttribute(a)||
"")}})});f=[];k||(f=[{type:"hbox",padding:0,widths:1>=l.length?["100%"]:["49%","2%","49%"],children:1>=l.length?[{type:"text",id:"iconSearch",label:e.lang.webjetformbutton.iconSearch,onKeyUp:function(){v(this.getDialog())}}]:[{type:"select",id:"iconGroup",label:e.lang.webjetformbutton.iconGroup,items:I,"default":"all",onChange:function(){v(this.getDialog())}},{type:"html",html:"\x26nbsp;"},{type:"text",id:"iconSearch",label:e.lang.webjetformbutton.iconSearch,onKeyUp:function(){v(this.getDialog())}}]},
{type:"html",id:"iconGrid",html:'\x3cdiv style\x3d"min-height: '+F+'px;"\x3e\x3c/div\x3e'}]);p=[{id:"general",label:e.lang.webjetformbutton.general,elements:p}];0<t.length&&p.push({id:"attributes",label:e.lang.webjetformbutton.attributes,elements:L});k||p.push({id:"icons",label:e.lang.webjetformbutton.icons,elements:f});return{title:e.lang.webjetformbutton.title,minWidth:800,minHeight:400,contents:p,getModel:function(a){return a.getSelection().getSelectedElement()},onShow:function(){var a=this,b=
this.getModel(e);"undefined"!=typeof ckEditorInstance.lastWjButton&&null!=ckEditorInstance.lastWjButton&&(b=new CKEDITOR.dom.element(ckEditorInstance.lastWjButton),ckEditorInstance.lastWjButton=null);g="";k||(this.setValueOf("icons","iconSearch",""),M(a));if(b&&b.is("button")&&(this.setupContent(b),!k)){var d=b.findOne("svg use");d&&(d=d.getAttribute("xlink:href")||d.getAttribute("href")||"")&&-1!==d.indexOf("#")&&(g=d.substring(d.indexOf("#")+1),this.setValueOf("icons","iconSearch",g))}setTimeout(function(){if(g&&
!k)for(var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),d=0;d<b.count();d++){var e=b.getItem(d);if(e.getAttribute("title")===g){e.addClass("wj-selected");e.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});break}}},500);this.element=b},onOk:function(){var a=this,b=this.element,d=!b||!b.is("button"),c=a.getValueOf("general","text")||e.lang.webjetformbutton.defaultText,f=a.getValueOf("general","name"),l=a.getValueOf("general","onclick"),m=a.getValueOf("general",
"size"),p=a.getValueOf("general","buttonType"),r=a.getValueOf("general","customClass"),n=a.getValueOf("general","disabled"),q=!1;k||(q=a.getValueOf("general","hideText"));d&&(b=CKEDITOR.dom.element.createFromHtml("\x3cbutton\x3e\x3c/button\x3e",e.document));b.setAttribute("type","button");f?b.setAttribute("name",f):b.removeAttribute("name");l?(f=l.replace(/\\/g,"\\\\").replace(/"/g,"\x26quot;").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),b.setAttribute("onclick",f)):b.removeAttribute("onclick");p=P(m,
p,r);b.setAttribute("class",p);n?(b.setAttribute("disabled","disabled"),b.setAttribute("aria-disabled","true")):(b.removeAttribute("disabled"),b.removeAttribute("aria-disabled"));0<t.length&&t.forEach(function(c){var d=c.replace(/[^a-zA-Z0-9]/g,"_");(d=a.getValueOf("attributes",d))&&d.trim()?b.setAttribute(c,d):b.removeAttribute(c)});n="";g&&u&&(m="icon "+m.replace("btn","icon"),q&&g||(m+=" btn__icon-left"),n=n+('\x3csvg class\x3d"'+m+'" aria-hidden\x3d"true"\x3e')+('\x3cuse xlink:href\x3d"'+CKEDITOR.tools.htmlEncode(u+
"#"+g)+'"\x3e\x3c/use\x3e'),n+="\x3c/svg\x3e");n=q&&g?n+('\x3cspan class\x3d"'+D+'"\x3e'+CKEDITOR.tools.htmlEncode(c)+"\x3c/span\x3e"):n+CKEDITOR.tools.htmlEncode(c);b.setHtml(n);d?e.insertElement(b):e.getSelection().selectElement(b)}}});