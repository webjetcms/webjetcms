CKEDITOR.dialog.add("webjetformbuttonDialog",function(c){function t(a){if(!h){var b="all";0<l.length&&(b=a.getValueOf("icons","iconGroup"));var e=a.getValueOf("icons","iconSearch").toLowerCase();a=a.getContentElement("icons","iconGrid").getElement();for(var d=a.find(".wj-icon-item"),D=0,y=0;y<d.count();y++){var k=d.getItem(y),f=k.getAttribute("title"),g=E[f]||[],g="all"===b||-1!==g.indexOf(b),f=-1!==f.toLowerCase().indexOf(e);g&&f?(k.show(),D++):k.hide()}b=a.findOne(".wj-no-icons-message");0===D?
b?b.show():(b=new CKEDITOR.dom.element("div"),b.addClass("wj-no-icons-message"),b.setHtml(c.lang.webjetformbutton.noIconsFound),b.setStyles({"text-align":"center",padding:"20px",color:"#666","font-style":"italic"}),a.append(b)):b&&b.hide()}}function M(a){if(!h){var b=a.getContentElement("icons","iconGrid").getElement();b.setHtml('\x3cdiv class\x3d"wj-loading-message" style\x3d"text-align: center; padding: 20px; color: #666;"\x3e'+c.lang.webjetformbutton.loadingIcons+"\x3c/div\x3e");CKEDITOR.ajax.loadXml(x,
function(e){if(e){var d=CKEDITOR.document.getById("wj-svg-sprite-container");d||(d=new CKEDITOR.dom.element("div"),d.setAttributes({id:"wj-svg-sprite-container",style:"display: none; position: absolute; top: -9999px;"}),CKEDITOR.document.getBody().append(d),e=e.documentElement?e.documentElement.outerHTML:(new XMLSerializer).serializeToString(e.baseXml.childNodes[0]),d.setHtml(e));N(a,d.$)}else b.setHtml('\x3cdiv class\x3d"wj-error-message" style\x3d"text-align: center; padding: 20px; color: #d32f2f;"\x3e'+
c.lang.webjetformbutton.loadError+"\x3c/div\x3e")})}}function N(a,b){for(var e=a.getContentElement("icons","iconGrid").getElement(),d=b.getElementsByTagName("symbol"),c=[],f=0===q.length,k=0;k<d.length;k++){var g=d[k].getAttribute("id");!0===f&&q.push(g);-1!==q.indexOf(g)&&c.push(g)}var h='\x3cdiv class\x3d"wj-icon-grid" style\x3d"display: grid; grid-template-columns: repeat(auto-fit, minmax('+(p+2+8)+"px, 1fr)); gap: 4px; max-height: "+F+'px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fff;"\x3e';
c.forEach(function(a){h+='\x3cdiv class\x3d"wj-icon-item" title\x3d"'+a+'" style\x3d"display: flex; flex-direction: column; align-items: center; padding: 2px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.2s; width: '+p+"px; height: "+(u+26)+'px; justify-content: center;overflow: hidden;"\x3e\x3cdiv class\x3d"wj-icon-placeholder" style\x3d"width: '+p+"px; height: "+u+'px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;"\x3eLoading...\x3c/div\x3e\x3cdiv class\x3d"wj-icon-name" style\x3d"font-size: 10px; text-align: center; word-break: break-all; line-height: 1;width: '+
p+'px; height: 2em; white-space: normal;"\x3e'+a+"\x3c/div\x3e\x3c/div\x3e"});h+="\x3c/div\x3e";e.setHtml(h);O(a)}function O(a){var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item");if(window.IntersectionObserver)for(var e=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(G(a.target),e.unobserve(a.target))})}),d=0;d<b.count();d++){var c=b.getItem(d);e.observe(c.$);c.on("click",function(){H(a,this)});c.on("mouseenter",function(){this.hasClass("wj-selected")||
this.setStyle("background-color","#f5f5f5")});c.on("mouseleave",function(){this.hasClass("wj-selected")||this.setStyle("background-color","")})}else for(d=0;d<b.count();d++)c=b.getItem(d),G(c.$),c.on("click",function(){H(a,this)})}function G(a){var b=a.getAttribute("title");(a=a.querySelector(".wj-icon-placeholder"))&&b&&(a.innerHTML='\x3csvg width\x3d"'+p+'" height\x3d"'+u+'" style\x3d"max-width: 100%; max-height: 100%;"\x3e\x3cuse href\x3d"#'+b+'"\x3e\x3c/use\x3e\x3c/svg\x3e')}function H(a,b){for(var e=
a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),d=b.hasClass("wj-selected"),c=0;c<e.count();c++){var f=e.getItem(c);f.removeClass("wj-selected");f.setStyles({"border-color":"transparent","background-color":""})}d?g="":(b.addClass("wj-selected"),b.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"}),g=b.getAttribute("title"))}function v(a){var b={size:"",type:"",custom:[]};(a.getAttribute("class")||"").split(/\s+/).forEach(function(a){a!==r&&(-1!==z.indexOf(a)?
b.size=a:-1!==A.indexOf(a)?b.type=a:b.custom.push(a))});return b}function P(a,b,c){var d=[r];a&&d.push(a);b&&d.push(b);c&&(a=c.split(/\s+/).filter(function(a){return a&&a!==r&&-1===z.indexOf(a)&&-1===A.indexOf(a)?!0:!1}),d=d.concat(a));return d.join(" ")}var f=c.config.webjetsvgicon||{},x=f.spritePath||"",B=f.icons||{},p=f.iconWidth||56,u=f.iconHeight||56,F=f.gridHeight||400,f=c.config.webjetformbutton||{},z=(f.sizes||"btn-lg,btn-sm").split(","),C=f.textHiddenClass||"visually-hidden",r=f.baseClass||
"btn",A=f.types?f.types.split(","):"btn-primary btn-secondary btn-success btn-danger btn-warning btn-info btn-light btn-dark btn-link btn-outline-primary btn-outline-secondary btn-outline-success btn-outline-danger btn-outline-warning btn-outline-info btn-outline-light btn-outline-dark".split(" "),w=(f.attrs||"").split(",").filter(function(a){return a.trim()}).map(function(a){return a.trim()}),q=[],l=[],E={};0<Object.keys(B).length&&(q=Object.keys(B),q.forEach(function(a){var b=B[a]||[];E[a]=b;b.forEach(function(a){-1===
l.indexOf(a)&&l.push(a)})}));l.sort();var I=[[c.lang.webjetformbutton.showAll,"all"]];l.forEach(function(a){I.push([a,a])});var J=[[c.lang.webjetformbutton.defaultSize,""]];z.forEach(function(a){J.push([a,a])});var K=[[c.lang.webjetformbutton.defaultType,""]];A.forEach(function(a){K.push([a,a])});var g="",h=!x,n=[{type:"text",id:"text",label:c.lang.webjetformbutton.text,"default":"",setup:function(a){var b="";a=a.getChildren();for(var c=0;c<a.count();c++){var d=a.getItem(c);if(d.type===CKEDITOR.NODE_TEXT)b+=
d.getText();else if(d.is&&d.is("span")&&d.hasClass(C)){b=d.getText();break}else d.is&&(d.is("svg")||d.is("use"))||(b+=d.getText())}this.setValue(b.trim())}},{type:"text",id:"name",label:c.lang.webjetformbutton.name,setup:function(a){this.setValue(a.getAttribute("name")||"")}},{type:"text",id:"onclick",label:c.lang.webjetformbutton.onclick,setup:function(a){var b="",b=a.getAttribute("onclick")||"";!b&&a.$&&a.$.onclick&&(a=a.$.onclick.toString(),0===a.indexOf("function onclick(event)")?a=a.replace(/^function onclick\(event\)\s*\{\s*/,
"").replace(/\s*\}$/,""):0===a.indexOf("function anonymous(")&&(a=a.replace(/^function anonymous\([^)]*\)\s*\{\s*/,"").replace(/\s*\}$/,"")),b=a.trim());this.setValue(b)}},{type:"select",id:"buttonType",label:c.lang.webjetformbutton.buttonType,"default":"",items:K,setup:function(a){a=v(a);this.setValue(a.type)}},{type:"select",id:"size",label:c.lang.webjetformbutton.size,"default":"",items:J,setup:function(a){a=v(a);this.setValue(a.size)}}];h||n.push({type:"checkbox",id:"hideText",label:c.lang.webjetformbutton.hideText,
setup:function(a){a=a.findOne("span."+C);this.setValue(!!a)}});var Q=[{type:"text",id:"advId",label:c.lang.webjetformbutton.id,setup:function(a){this.setValue(a.getAttribute("id")||"")}},{type:"text",id:"customClass",label:c.lang.webjetformbutton.customClass,setup:function(a){a=v(a);this.setValue(a.custom.join(" "))}},{type:"text",id:"advTitle",label:c.lang.webjetformbutton.advisoryTitle,setup:function(a){this.setValue(a.getAttribute("title")||"")}},{type:"text",id:"advTabindex",label:c.lang.webjetformbutton.tabindex,
setup:function(a){this.setValue(a.getAttribute("tabindex")||"")}},{type:"text",id:"advAriaLabel",label:c.lang.webjetformbutton.ariaLabel,setup:function(a){this.setValue(a.getAttribute("aria-label")||"")}},{type:"checkbox",id:"disabled",label:c.lang.webjetformbutton.disabled,setup:function(a){this.setValue(a.hasAttribute("disabled"))}}],L=[];0<w.length&&w.forEach(function(a){var b=a.replace(/[^a-zA-Z0-9]/g,"_");L.push({type:"text",id:b,label:a,"default":"",setup:function(b){this.setValue(b.getAttribute(a)||
"")}})});f=[];h||(f=[{type:"hbox",padding:0,widths:1>=l.length?["100%"]:["49%","2%","49%"],children:1>=l.length?[{type:"text",id:"iconSearch",label:c.lang.webjetformbutton.iconSearch,onKeyUp:function(){t(this.getDialog())}}]:[{type:"select",id:"iconGroup",label:c.lang.webjetformbutton.iconGroup,items:I,"default":"all",onChange:function(){t(this.getDialog())}},{type:"html",html:"\x26nbsp;"},{type:"text",id:"iconSearch",label:c.lang.webjetformbutton.iconSearch,onKeyUp:function(){t(this.getDialog())}}]},
{type:"html",id:"iconGrid",html:'\x3cdiv style\x3d"min-height: '+F+'px;"\x3e\x3c/div\x3e'}]);n=[{id:"general",label:c.lang.webjetformbutton.general,elements:n},{id:"advanced",label:c.lang.webjetformbutton.advanced,elements:Q}];0<w.length&&n.push({id:"attributes",label:c.lang.webjetformbutton.attributes,elements:L});h||n.push({id:"icons",label:c.lang.webjetformbutton.icons,elements:f});return{title:c.lang.webjetformbutton.title,minWidth:800,minHeight:400,contents:n,getModel:function(a){return a.getSelection().getSelectedElement()},
onShow:function(){var a=this,b=this.getModel(c);"undefined"!=typeof ckEditorInstance.lastWjButton&&null!=ckEditorInstance.lastWjButton&&(b=new CKEDITOR.dom.element(ckEditorInstance.lastWjButton),ckEditorInstance.lastWjButton=null);g="";h||(this.setValueOf("icons","iconSearch",""),M(a));if(b&&b.is("button")&&(this.setupContent(b),!h)){var e=b.findOne("svg use");e&&(e=e.getAttribute("xlink:href")||e.getAttribute("href")||"")&&-1!==e.indexOf("#")&&(g=e.substring(e.indexOf("#")+1),this.setValueOf("icons",
"iconSearch",g))}setTimeout(function(){if(g&&!h)for(var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),c=0;c<b.count();c++){var e=b.getItem(c);if(e.getAttribute("title")===g){e.addClass("wj-selected");e.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});break}}},500);this.element=b},onOk:function(){var a=this,b=this.element,e=!b||!b.is("button"),d=a.getValueOf("general","text")||c.lang.webjetformbutton.defaultText,f=a.getValueOf("general","name"),l=a.getValueOf("general",
"onclick"),k=a.getValueOf("general","size"),n=a.getValueOf("general","buttonType"),q=a.getValueOf("advanced","customClass"),m=a.getValueOf("advanced","disabled"),p=a.getValueOf("advanced","advId"),t=a.getValueOf("advanced","advTitle"),u=a.getValueOf("advanced","advAriaLabel"),v=a.getValueOf("advanced","advTabindex"),r=!1;h||(r=a.getValueOf("general","hideText"));e&&(b=CKEDITOR.dom.element.createFromHtml("\x3cbutton\x3e\x3c/button\x3e",c.document));b.setAttribute("type","button");f?b.setAttribute("name",
f):b.removeAttribute("name");l?(f=l.replace(/\\/g,"\\\\").replace(/"/g,"\x26quot;").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),b.setAttribute("onclick",f)):b.removeAttribute("onclick");n=P(k,n,q);b.setAttribute("class",n);m?(b.setAttribute("disabled","disabled"),b.setAttribute("aria-disabled","true")):(b.removeAttribute("disabled"),b.removeAttribute("aria-disabled"));p?b.setAttribute("id",p):b.removeAttribute("id");t?b.setAttribute("title",t):b.removeAttribute("title");u?b.setAttribute("aria-label",
u):b.removeAttribute("aria-label");v?b.setAttribute("tabindex",v):b.removeAttribute("tabindex");0<w.length&&w.forEach(function(c){var d=c.replace(/[^a-zA-Z0-9]/g,"_");(d=a.getValueOf("attributes",d))&&d.trim()?b.setAttribute(c,d):b.removeAttribute(c)});m="";g&&x&&(k="icon "+k.replace("btn","icon"),r&&g||(k+=" btn__icon-left"),m=m+('\x3csvg class\x3d"'+k+'" aria-hidden\x3d"true"\x3e')+('\x3cuse xlink:href\x3d"'+CKEDITOR.tools.htmlEncode(x+"#"+g)+'"\x3e\x3c/use\x3e'),m+="\x3c/svg\x3e");m=r&&g?m+('\x3cspan class\x3d"'+
C+'"\x3e'+CKEDITOR.tools.htmlEncode(d)+"\x3c/span\x3e"):m+CKEDITOR.tools.htmlEncode(d);b.setHtml(m);e?c.insertElement(b):c.getSelection().selectElement(b)}}});