CKEDITOR.dialog.add("webjetformbuttonDialog",function(d){function u(a){if(!k){var b="all";0<l.length&&(b=a.getValueOf("icons","iconGroup"));var e=a.getValueOf("icons","iconSearch").toLowerCase();a=a.getContentElement("icons","iconGrid").getElement();for(var c=a.find(".wj-icon-item"),C=0,q=0;q<c.count();q++){var h=c.getItem(q),m=h.getAttribute("title"),g=D[m]||[],g="all"===b||-1!==g.indexOf(b),m=-1!==m.toLowerCase().indexOf(e);g&&m?(h.show(),C++):h.hide()}b=a.findOne(".wj-no-icons-message");0===C?
b?b.show():(b=new CKEDITOR.dom.element("div"),b.addClass("wj-no-icons-message"),b.setHtml(d.lang.webjetformbutton.noIconsFound),b.setStyles({"text-align":"center",padding:"20px",color:"#666","font-style":"italic"}),a.append(b)):b&&b.hide()}}function K(a){if(!k){var b=a.getContentElement("icons","iconGrid").getElement();b.setHtml('\x3cdiv class\x3d"wj-loading-message" style\x3d"text-align: center; padding: 20px; color: #666;"\x3e'+d.lang.webjetformbutton.loadingIcons+"\x3c/div\x3e");CKEDITOR.ajax.loadXml(t,
function(e){if(e){var c=CKEDITOR.document.getById("wj-svg-sprite-container");c||(c=new CKEDITOR.dom.element("div"),c.setAttributes({id:"wj-svg-sprite-container",style:"display: none; position: absolute; top: -9999px;"}),CKEDITOR.document.getBody().append(c),e=e.documentElement?e.documentElement.outerHTML:(new XMLSerializer).serializeToString(e.baseXml.childNodes[0]),c.setHtml(e));L(a,c.$)}else b.setHtml('\x3cdiv class\x3d"wj-error-message" style\x3d"text-align: center; padding: 20px; color: #d32f2f;"\x3e'+
d.lang.webjetformbutton.loadError+"\x3c/div\x3e")})}}function L(a,b){for(var e=a.getContentElement("icons","iconGrid").getElement(),c=b.getElementsByTagName("symbol"),d=[],q=0===p.length,h=0;h<c.length;h++){var g=c[h].getAttribute("id");!0===q&&p.push(g);-1!==p.indexOf(g)&&d.push(g)}var f='\x3cdiv class\x3d"wj-icon-grid" style\x3d"display: grid; grid-template-columns: repeat(auto-fit, minmax('+(n+2+8)+"px, 1fr)); gap: 4px; max-height: "+E+'px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fff;"\x3e';
d.forEach(function(a){f+='\x3cdiv class\x3d"wj-icon-item" title\x3d"'+a+'" style\x3d"display: flex; flex-direction: column; align-items: center; padding: 2px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.2s; width: '+n+"px; height: "+(v+26)+'px; justify-content: center;overflow: hidden;"\x3e\x3cdiv class\x3d"wj-icon-placeholder" style\x3d"width: '+n+"px; height: "+v+'px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;"\x3eLoading...\x3c/div\x3e\x3cdiv class\x3d"wj-icon-name" style\x3d"font-size: 10px; text-align: center; word-break: break-all; line-height: 1;width: '+
n+'px; height: 2em; white-space: normal;"\x3e'+a+"\x3c/div\x3e\x3c/div\x3e"});f+="\x3c/div\x3e";e.setHtml(f);M(a)}function M(a){var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item");if(window.IntersectionObserver)for(var e=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(F(a.target),e.unobserve(a.target))})}),c=0;c<b.count();c++){var d=b.getItem(c);e.observe(d.$);d.on("click",function(){G(a,this)});d.on("mouseenter",function(){this.hasClass("wj-selected")||
this.setStyle("background-color","#f5f5f5")});d.on("mouseleave",function(){this.hasClass("wj-selected")||this.setStyle("background-color","")})}else for(c=0;c<b.count();c++)d=b.getItem(c),F(d.$),d.on("click",function(){G(a,this)})}function F(a){var b=a.getAttribute("title");(a=a.querySelector(".wj-icon-placeholder"))&&b&&(a.innerHTML='\x3csvg width\x3d"'+n+'" height\x3d"'+v+'" style\x3d"max-width: 100%; max-height: 100%;"\x3e\x3cuse href\x3d"#'+b+'"\x3e\x3c/use\x3e\x3c/svg\x3e')}function G(a,b){for(var e=
a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),c=b.hasClass("wj-selected"),d=0;d<e.count();d++){var f=e.getItem(d);f.removeClass("wj-selected");f.setStyles({"border-color":"transparent","background-color":""})}c?g="":(b.addClass("wj-selected"),b.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"}),g=b.getAttribute("title"))}function w(a){a=a.getAttribute("class")||"";var b={size:"",type:"",custom:[]};a.split(/\s+/).forEach(function(a){a!==x&&(-1!==y.indexOf(a)?
b.size=a:-1!==z.indexOf(a)?b.type=a:b.custom.push(a))});console.log("parseExistingClasses cssClass\x3d",a,"result\x3d",b);return b}function N(a,b,d){var c=[x];a&&c.push(a);b&&c.push(b);d&&(a=d.split(/\s+/).filter(function(a){return a&&a!==x&&-1===y.indexOf(a)&&-1===z.indexOf(a)?!0:!1}),c=c.concat(a));return c.join(" ")}var f=d.config.webjetsvgicon||{},t=f.spritePath||"",A=f.icons||{},n=f.iconWidth||56,v=f.iconHeight||56,E=f.gridHeight||400,y=(f.sizes||"btn-lg,btn-sm").split(","),B=f.textHiddenClass||
"visually-hidden",x=d.config.webjetformbutton&&d.config.webjetformbutton.baseClass||"btn",z=d.config.webjetformbutton&&d.config.webjetformbutton.types?d.config.webjetformbutton.types.split(","):"btn-primary btn-secondary btn-success btn-danger btn-warning btn-info btn-light btn-dark btn-link btn-outline-primary btn-outline-secondary btn-outline-success btn-outline-danger btn-outline-warning btn-outline-info btn-outline-light btn-outline-dark".split(" "),p=[],l=[],D={};0<Object.keys(A).length&&(p=
Object.keys(A),p.forEach(function(a){var b=A[a]||[];D[a]=b;b.forEach(function(a){-1===l.indexOf(a)&&l.push(a)})}));l.sort();var H=[[d.lang.webjetformbutton.showAll,"all"]];l.forEach(function(a){H.push([a,a])});var I=[[d.lang.webjetformbutton.defaultSize,""]];y.forEach(function(a){I.push([a,a])});var J=[[d.lang.webjetformbutton.defaultType,""]];z.forEach(function(a){J.push([a,a])});var g="",k=!t,r=[{type:"text",id:"text",label:d.lang.webjetformbutton.text,"default":"",setup:function(a){var b="";a=
a.getChildren();for(var d=0;d<a.count();d++){var c=a.getItem(d);if(c.type===CKEDITOR.NODE_TEXT)b+=c.getText();else if(c.is&&c.is("span")&&c.hasClass(B)){b=c.getText();break}else c.is&&(c.is("svg")||c.is("use"))||(b+=c.getText())}this.setValue(b.trim())}},{type:"select",id:"type",label:d.lang.webjetformbutton.type,"default":"button",items:[[d.lang.webjetformbutton.typeButton,"button"],[d.lang.webjetformbutton.typeSubmit,"submit"],[d.lang.webjetformbutton.typeReset,"reset"]],setup:function(a){this.setValue(a.getAttribute("type")||
"button")}},{type:"text",id:"name",label:d.lang.webjetformbutton.name,setup:function(a){this.setValue(a.getAttribute("name")||"")}},{type:"text",id:"onclick",label:d.lang.webjetformbutton.onclick,setup:function(a){var b="",b=a.getAttribute("onclick")||"";!b&&a.$&&a.$.onclick&&(a=a.$.onclick.toString(),0===a.indexOf("function onclick(event)")?a=a.replace(/^function onclick\(event\)\s*\{\s*/,"").replace(/\s*\}$/,""):0===a.indexOf("function anonymous(")&&(a=a.replace(/^function anonymous\([^)]*\)\s*\{\s*/,
"").replace(/\s*\}$/,"")),b=a.trim());this.setValue(b)}},{type:"select",id:"size",label:d.lang.webjetformbutton.size,"default":"",items:I,setup:function(a){a=w(a);this.setValue(a.size)}},{type:"select",id:"buttonType",label:d.lang.webjetformbutton.buttonType,"default":"",items:J,setup:function(a){a=w(a);this.setValue(a.type)}},{type:"text",id:"customClass",label:d.lang.webjetformbutton.customClass,setup:function(a){a=w(a);this.setValue(a.custom.join(" "))}},{type:"checkbox",id:"disabled",label:d.lang.webjetformbutton.disabled,
setup:function(a){this.setValue(a.hasAttribute("disabled"))}}];k||r.push({type:"checkbox",id:"hideText",label:d.lang.webjetformbutton.hideText,setup:function(a){a=a.findOne("span."+B);this.setValue(!!a)}});f=[];k||(f=[{type:"hbox",padding:0,widths:1>=l.length?["100%"]:["49%","2%","49%"],children:1>=l.length?[{type:"text",id:"iconSearch",label:d.lang.webjetformbutton.iconSearch,onKeyUp:function(){u(this.getDialog())}}]:[{type:"select",id:"iconGroup",label:d.lang.webjetformbutton.iconGroup,items:H,
"default":"all",onChange:function(){u(this.getDialog())}},{type:"html",html:"\x26nbsp;"},{type:"text",id:"iconSearch",label:d.lang.webjetformbutton.iconSearch,onKeyUp:function(){u(this.getDialog())}}]},{type:"html",id:"iconGrid",html:'\x3cdiv style\x3d"min-height: '+E+'px;"\x3e\x3c/div\x3e'}]);r=[{id:"general",label:d.lang.webjetformbutton.general,elements:r}];k||r.push({id:"icons",label:d.lang.webjetformbutton.icons,elements:f});return{title:d.lang.webjetformbutton.title,minWidth:800,minHeight:400,
contents:r,getModel:function(a){return a.getSelection().getSelectedElement()},onShow:function(){var a=this,b=this.getModel(d);"undefined"!=typeof ckEditorInstance.lastWjButton&&null!=ckEditorInstance.lastWjButton&&(b=new CKEDITOR.dom.element(ckEditorInstance.lastWjButton),ckEditorInstance.lastWjButton=null);g="";k||(this.setValueOf("icons","iconSearch",""),K(a));if(b&&b.is("button")&&(this.setupContent(b),!k)){var e=b.findOne("svg use");e&&(e=e.getAttribute("xlink:href")||e.getAttribute("href")||
"")&&-1!==e.indexOf("#")&&(g=e.substring(e.indexOf("#")+1),this.setValueOf("icons","iconSearch",g))}setTimeout(function(){if(g&&!k)for(var c=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),b=0;b<c.count();b++){var d=c.getItem(b);if(d.getAttribute("title")===g){d.addClass("wj-selected");d.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});break}}},500);this.element=b},onOk:function(){var a=this.element,b=!a||!a.is("button"),e=this.getValueOf("general","text")||
d.lang.webjetformbutton.defaultText,c=this.getValueOf("general","type")||"button",f=this.getValueOf("general","name"),k=this.getValueOf("general","onclick"),h=this.getValueOf("general","size"),m=this.getValueOf("general","buttonType"),l=this.getValueOf("general","customClass"),p=this.getValueOf("general","disabled"),n=this.getValueOf("general","hideText"),c='\x3cbutton type\x3d"'+CKEDITOR.tools.htmlEncode(c)+'"';f&&(c+=' name\x3d"'+CKEDITOR.tools.htmlEncode(f)+'"');k&&(f=k.replace(/\\/g,"\\\\").replace(/"/g,
"\x26quot;").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),c+=' onclick\x3d"'+f+'"');m=N(h,m,l);c+=' class\x3d"'+CKEDITOR.tools.htmlEncode(m)+'"';p&&(c+=' disabled\x3d"disabled" aria-disabled\x3d"true"');c+="\x3e";g&&t&&(h="icon "+h.replace("btn","icon"),n&&g||(h+=" btn__icon-left"),c=c+('\x3csvg class\x3d"'+h+'" aria-hidden\x3d"true"\x3e')+('\x3cuse xlink:href\x3d"'+CKEDITOR.tools.htmlEncode(t+"#"+g)+'"\x3e\x3c/use\x3e'),c+="\x3c/svg\x3e");c=n&&g?c+('\x3cspan class\x3d"'+B+'"\x3e'+CKEDITOR.tools.htmlEncode(e)+
"\x3c/span\x3e"):c+CKEDITOR.tools.htmlEncode(e);c+="\x3c/button\x3e";e=CKEDITOR.dom.element.createFromHtml(c,d.document);b?d.insertElement(e):(e.replace(a),d.getSelection().selectElement(e))}}});