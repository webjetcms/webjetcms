CKEDITOR.dialog.add("webjetformbuttonDialog",function(c){function u(a){if(!n){var b="all";0<l.length&&(b=a.getValueOf("icons","iconGroup"));var e=a.getValueOf("icons","iconSearch").toLowerCase();a=a.getContentElement("icons","iconGrid").getElement();for(var d=a.find(".wj-icon-item"),D=0,k=0;k<d.count();k++){var v=d.getItem(k),f=v.getAttribute("title"),m=E[f]||[],m="all"===b||-1!==m.indexOf(b),f=-1!==f.toLowerCase().indexOf(e);m&&f?(v.show(),D++):v.hide()}b=a.findOne(".wj-no-icons-message");0===D?
b?b.show():(b=new CKEDITOR.dom.element("div"),b.addClass("wj-no-icons-message"),b.setHtml(c.lang.webjetformbutton.noIconsFound),b.setStyles({"text-align":"center",padding:"20px",color:"#666","font-style":"italic"}),a.append(b)):b&&b.hide()}}function L(a){if(!n){var b=a.getContentElement("icons","iconGrid").getElement();b.setHtml('\x3cdiv class\x3d"wj-loading-message" style\x3d"text-align: center; padding: 20px; color: #666;"\x3e'+c.lang.webjetformbutton.loadingIcons+"\x3c/div\x3e");CKEDITOR.ajax.loadXml(t,
function(e){if(e){var d=CKEDITOR.document.getById("wj-svg-sprite-container");d||(d=new CKEDITOR.dom.element("div"),d.setAttributes({id:"wj-svg-sprite-container",style:"display: none; position: absolute; top: -9999px;"}),CKEDITOR.document.getBody().append(d),e=e.documentElement?e.documentElement.outerHTML:(new XMLSerializer).serializeToString(e.baseXml.childNodes[0]),d.setHtml(e));M(a,d.$)}else b.setHtml('\x3cdiv class\x3d"wj-error-message" style\x3d"text-align: center; padding: 20px; color: #d32f2f;"\x3e'+
c.lang.webjetformbutton.loadError+"\x3c/div\x3e")})}}function M(a,b){for(var e=a.getContentElement("icons","iconGrid").getElement(),d=b.getElementsByTagName("symbol"),c=[],k=0===q.length,f=0;f<d.length;f++){var h=d[f].getAttribute("id");!0===k&&q.push(h);-1!==q.indexOf(h)&&c.push(h)}var m='\x3cdiv class\x3d"wj-icon-grid" style\x3d"display: grid; grid-template-columns: repeat(auto-fit, minmax('+(p+2+8)+"px, 1fr)); gap: 4px; max-height: "+F+'px; overflow-y: auto; padding: 10px; border: 1px solid #ccc; background: #fff;"\x3e';
c.forEach(function(a){m+='\x3cdiv class\x3d"wj-icon-item" title\x3d"'+a+'" style\x3d"display: flex; flex-direction: column; align-items: center; padding: 2px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.2s; width: '+p+"px; height: "+(w+26)+'px; justify-content: center;overflow: hidden;"\x3e\x3cdiv class\x3d"wj-icon-placeholder" style\x3d"width: '+p+"px; height: "+w+'px; border: 1px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-bottom: 4px;"\x3eLoading...\x3c/div\x3e\x3cdiv class\x3d"wj-icon-name" style\x3d"font-size: 10px; text-align: center; word-break: break-all; line-height: 1;width: '+
p+'px; height: 2em; white-space: normal;"\x3e'+a+"\x3c/div\x3e\x3c/div\x3e"});m+="\x3c/div\x3e";e.setHtml(m);N(a)}function N(a){var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item");if(window.IntersectionObserver)for(var e=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(G(a.target),e.unobserve(a.target))})}),d=0;d<b.count();d++){var c=b.getItem(d);e.observe(c.$);c.on("click",function(){H(a,this)});c.on("mouseenter",function(){this.hasClass("wj-selected")||
this.setStyle("background-color","#f5f5f5")});c.on("mouseleave",function(){this.hasClass("wj-selected")||this.setStyle("background-color","")})}else for(d=0;d<b.count();d++)c=b.getItem(d),G(c.$),c.on("click",function(){H(a,this)})}function G(a){var b=a.getAttribute("title");(a=a.querySelector(".wj-icon-placeholder"))&&b&&(a.innerHTML='\x3csvg width\x3d"'+p+'" height\x3d"'+w+'" style\x3d"max-width: 100%; max-height: 100%;"\x3e\x3cuse href\x3d"#'+b+'"\x3e\x3c/use\x3e\x3c/svg\x3e')}function H(a,b){for(var e=
a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),d=b.hasClass("wj-selected"),c=0;c<e.count();c++){var k=e.getItem(c);k.removeClass("wj-selected");k.setStyles({"border-color":"transparent","background-color":""})}d?f="":(b.addClass("wj-selected"),b.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"}),f=b.getAttribute("title"))}function x(a){var b={size:"",type:"",custom:[]};(a.getAttribute("class")||"").split(/\s+/).forEach(function(a){a!==y&&(-1!==z.indexOf(a)?
b.size=a:-1!==A.indexOf(a)?b.type=a:b.custom.push(a))});return b}function O(a,b,c){var d=[y];a&&d.push(a);b&&d.push(b);c&&(a=c.split(/\s+/).filter(function(a){return a&&a!==y&&-1===z.indexOf(a)&&-1===A.indexOf(a)?!0:!1}),d=d.concat(a));return d.join(" ")}var h=c.config.webjetsvgicon||{},t=h.spritePath||"",B=h.icons||{},p=h.iconWidth||56,w=h.iconHeight||56,F=h.gridHeight||400,z=(h.sizes||"btn-lg,btn-sm").split(","),C=h.textHiddenClass||"visually-hidden",y=c.config.webjetformbutton&&c.config.webjetformbutton.baseClass||
"btn",A=c.config.webjetformbutton&&c.config.webjetformbutton.types?c.config.webjetformbutton.types.split(","):"btn-primary btn-secondary btn-success btn-danger btn-warning btn-info btn-light btn-dark btn-link btn-outline-primary btn-outline-secondary btn-outline-success btn-outline-danger btn-outline-warning btn-outline-info btn-outline-light btn-outline-dark".split(" "),q=[],l=[],E={};0<Object.keys(B).length&&(q=Object.keys(B),q.forEach(function(a){var b=B[a]||[];E[a]=b;b.forEach(function(a){-1===
l.indexOf(a)&&l.push(a)})}));l.sort();var I=[[c.lang.webjetformbutton.showAll,"all"]];l.forEach(function(a){I.push([a,a])});var J=[[c.lang.webjetformbutton.defaultSize,""]];z.forEach(function(a){J.push([a,a])});var K=[[c.lang.webjetformbutton.defaultType,""]];A.forEach(function(a){K.push([a,a])});var f="",n=!t,r=[{type:"text",id:"text",label:c.lang.webjetformbutton.text,"default":"",setup:function(a){var b="";a=a.getChildren();for(var c=0;c<a.count();c++){var d=a.getItem(c);if(d.type===CKEDITOR.NODE_TEXT)b+=
d.getText();else if(d.is&&d.is("span")&&d.hasClass(C)){b=d.getText();break}else d.is&&(d.is("svg")||d.is("use"))||(b+=d.getText())}this.setValue(b.trim())}},{type:"text",id:"name",label:c.lang.webjetformbutton.name,setup:function(a){this.setValue(a.getAttribute("name")||"")}},{type:"text",id:"onclick",label:c.lang.webjetformbutton.onclick,setup:function(a){var b="",b=a.getAttribute("onclick")||"";!b&&a.$&&a.$.onclick&&(a=a.$.onclick.toString(),0===a.indexOf("function onclick(event)")?a=a.replace(/^function onclick\(event\)\s*\{\s*/,
"").replace(/\s*\}$/,""):0===a.indexOf("function anonymous(")&&(a=a.replace(/^function anonymous\([^)]*\)\s*\{\s*/,"").replace(/\s*\}$/,"")),b=a.trim());this.setValue(b)}},{type:"select",id:"buttonType",label:c.lang.webjetformbutton.buttonType,"default":"",items:K,setup:function(a){a=x(a);this.setValue(a.type)}},{type:"select",id:"size",label:c.lang.webjetformbutton.size,"default":"",items:J,setup:function(a){a=x(a);this.setValue(a.size)}},{type:"text",id:"customClass",label:c.lang.webjetformbutton.customClass,
setup:function(a){a=x(a);this.setValue(a.custom.join(" "))}},{type:"checkbox",id:"disabled",label:c.lang.webjetformbutton.disabled,setup:function(a){this.setValue(a.hasAttribute("disabled"))}}];n||r.push({type:"checkbox",id:"hideText",label:c.lang.webjetformbutton.hideText,setup:function(a){a=a.findOne("span."+C);this.setValue(!!a)}});h=[];n||(h=[{type:"hbox",padding:0,widths:1>=l.length?["100%"]:["49%","2%","49%"],children:1>=l.length?[{type:"text",id:"iconSearch",label:c.lang.webjetformbutton.iconSearch,
onKeyUp:function(){u(this.getDialog())}}]:[{type:"select",id:"iconGroup",label:c.lang.webjetformbutton.iconGroup,items:I,"default":"all",onChange:function(){u(this.getDialog())}},{type:"html",html:"\x26nbsp;"},{type:"text",id:"iconSearch",label:c.lang.webjetformbutton.iconSearch,onKeyUp:function(){u(this.getDialog())}}]},{type:"html",id:"iconGrid",html:'\x3cdiv style\x3d"min-height: '+F+'px;"\x3e\x3c/div\x3e'}]);r=[{id:"general",label:c.lang.webjetformbutton.general,elements:r}];n||r.push({id:"icons",
label:c.lang.webjetformbutton.icons,elements:h});return{title:c.lang.webjetformbutton.title,minWidth:800,minHeight:400,contents:r,getModel:function(a){return a.getSelection().getSelectedElement()},onShow:function(){var a=this,b=this.getModel(c);"undefined"!=typeof ckEditorInstance.lastWjButton&&null!=ckEditorInstance.lastWjButton&&(b=new CKEDITOR.dom.element(ckEditorInstance.lastWjButton),ckEditorInstance.lastWjButton=null);f="";n||(this.setValueOf("icons","iconSearch",""),L(a));if(b&&b.is("button")&&
(this.setupContent(b),!n)){var e=b.findOne("svg use");e&&(e=e.getAttribute("xlink:href")||e.getAttribute("href")||"")&&-1!==e.indexOf("#")&&(f=e.substring(e.indexOf("#")+1),this.setValueOf("icons","iconSearch",f))}setTimeout(function(){if(f&&!n)for(var b=a.getContentElement("icons","iconGrid").getElement().find(".wj-icon-item"),c=0;c<b.count();c++){var e=b.getItem(c);if(e.getAttribute("title")===f){e.addClass("wj-selected");e.setStyles({"border-color":"#2196f3","background-color":"#e3f2fd"});break}}},
500);this.element=b},onOk:function(){var a=this.element,b=!a||!a.is("button"),e=this.getValueOf("general","text")||c.lang.webjetformbutton.defaultText,d=this.getValueOf("general","name"),h=this.getValueOf("general","onclick"),k=this.getValueOf("general","size"),l=this.getValueOf("general","buttonType"),q=this.getValueOf("general","customClass"),m=this.getValueOf("general","disabled"),p=!1;n||(p=this.getValueOf("general","hideText"));var g='\x3cbutton type\x3d"'+CKEDITOR.tools.htmlEncode("button")+
'"';d&&(g+=' name\x3d"'+CKEDITOR.tools.htmlEncode(d)+'"');h&&(d=h.replace(/\\/g,"\\\\").replace(/"/g,"\x26quot;").replace(/\n/g,"\\n").replace(/\r/g,"\\r"),g+=' onclick\x3d"'+d+'"');l=O(k,l,q);g+=' class\x3d"'+CKEDITOR.tools.htmlEncode(l)+'"';m&&(g+=' disabled\x3d"disabled" aria-disabled\x3d"true"');g+="\x3e";f&&t&&(k="icon "+k.replace("btn","icon"),p&&f||(k+=" btn__icon-left"),g=g+('\x3csvg class\x3d"'+k+'" aria-hidden\x3d"true"\x3e')+('\x3cuse xlink:href\x3d"'+CKEDITOR.tools.htmlEncode(t+"#"+f)+
'"\x3e\x3c/use\x3e'),g+="\x3c/svg\x3e");g=p&&f?g+('\x3cspan class\x3d"'+C+'"\x3e'+CKEDITOR.tools.htmlEncode(e)+"\x3c/span\x3e"):g+CKEDITOR.tools.htmlEncode(e);g+="\x3c/button\x3e";e=CKEDITOR.dom.element.createFromHtml(g,c.document);b?c.insertElement(e):(e.replace(a),c.getSelection().selectElement(e))}}});